# ABACUS ä½¿ç”¨æ•™ç¨‹ï½œåˆ†å­åŠ¨åŠ›å­¦

<strong>ä½œè€…ï¼šåˆ˜è£•ï¼Œé‚®ç®±ï¼šliuyu@stu.pku.edu.cn</strong>

<strong>å®¡æ ¸ï¼šé™ˆé»˜æ¶µï¼Œé‚®ç®±ï¼šmohanchen@pku.edu.cn</strong>

## ä¸€ã€åˆ†å­åŠ¨åŠ›å­¦æ–¹æ³•ç®€ä»‹

<strong>åˆ†å­åŠ¨åŠ›å­¦ï¼ˆMolecular Dynamicsï¼Œç®€ç§° MDï¼‰ï¼š</strong>ä¸€ç§æ¨¡æ‹ŸåŸå­ä½“ç³»éšæ—¶é—´è¿åŠ¨çš„æ–¹æ³•ï¼Œè¢«å¹¿æ³›çš„ç”¨æ¥ç ”ç©¶ä¸åŸå­è¿åŠ¨è·¯å¾„ç›¸å…³çš„ä¸€äº›åŸºæœ¬è¿‡ç¨‹ï¼Œå¦‚ç›¸å˜ã€æ‰©æ•£ã€åŒ–å­¦ååº”ç­‰ç­‰ã€‚æœ¬æ•™ç¨‹æ—¨åœ¨ä»‹ç» ABACUS ä¸­çš„åˆ†å­åŠ¨åŠ›å­¦åŠŸèƒ½ï¼Œåˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿé‡è¦çš„ä¸€ä»¶äº‹æƒ…æ˜¯å¦‚ä½•é€‰å–ç²¾åº¦å’Œæ•ˆç‡çš„å¹³è¡¡ï¼Œå…¶ä¸­ç²¾åº¦é«˜ä½ä¸»è¦å–å†³äºåŠ¿å‡½æ•°çš„å‡†ç¡®ç¨‹åº¦ï¼Œè€Œæ•ˆç‡ä¸»è¦å—é™äºæ±‚å‡ºæ¯ä¸ªåŸå­çš„èƒ½é‡å’Œå—åŠ›çš„è®¡ç®—é‡ã€‚

<strong>ç»å…¸åˆ†å­åŠ¨åŠ›å­¦ï¼ˆClassical MDï¼Œç®€ç§° CMDï¼‰ï¼š</strong>é€šè¿‡æ„å»ºæè¿°åŸå­é—´ç›¸äº’ä½œç”¨çš„åŠ¿å‡½æ•°ï¼Œè·å¾—æ¯ä¸ªåŸå­çš„å—åŠ›ï¼ˆå—åŠ›ç­‰äºèƒ½é‡å¯¹åŸå­ä½ç½®çš„å¯¼æ•°ï¼‰ï¼Œå†é€šè¿‡ç§¯åˆ†è¿åŠ¨æ–¹ç¨‹æ¥è·å¾—æ¯ä¸ªåŸå­çš„ä¸‹ä¸€æ—¶åˆ»ä½ç½®ï¼Œä»è€Œè·å¾—éšæ—¶é—´æ¼”åŒ–çš„ç²’å­ä½ç½®å’Œé€Ÿåº¦ã€‚å½“ç³»ç»Ÿå¤„åœ¨ä¸€å®šçš„å¯†åº¦ã€æ¸©åº¦å’Œå‹å¼ºç­‰ç‰©ç†æ¡ä»¶é™åˆ¶ä¸‹ï¼Œå¯ä»¥ç»“åˆç»Ÿè®¡ç‰©ç†çš„æ–¹æ³•è®¡ç®—ç‰©è´¨çš„æ€§è´¨ã€‚å…·ä½“æ¥è¯´ï¼Œé‡‡å–æŸä¸ªç³»ç»¼åï¼Œå¯¹ç²’å­ä½ç½®å’Œé€Ÿåº¦é‡‡æ ·ï¼Œä¹‹åç»Ÿè®¡å‡ºä½“ç³»çš„çƒ­åŠ›å­¦å®è§‚æ€§è´¨ã€‚

<strong>ä»å¤´ç®—åˆ†å­åŠ¨åŠ›å­¦ï¼ˆab initio molecular dynamicsï¼Œç®€ç§° AIMDï¼‰ï¼š</strong>ä¹Ÿç§°ä¸ºç¬¬ä¸€æ€§åŸç†çš„åˆ†å­åŠ¨åŠ›å­¦æ–¹æ³•ï¼ˆfirst-principles molecular dynamicsï¼Œç®€ç§° FPMDï¼‰ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€æ€§åŸç†æ–¹æ³•ï¼ˆä¾‹å¦‚å¯†åº¦æ³›å‡½ç†è®ºï¼‰æ¥è®¡ç®—ä½“ç³»çš„åŠ¿èƒ½é¢ï¼Œå› æ­¤è®¡ç®—é‡ç›¸æ¯”äºç»å…¸åˆ†å­åŠ¨åŠ›å­¦æ–¹æ³•è¦æ˜‚è´µå¾ˆå¤šã€‚

<strong>ABACUS çš„åˆ†å­åŠ¨åŠ›å­¦åŠŸèƒ½ï¼š</strong>æ”¯æŒç¬¬ä¸€æ€§åŸç†åˆ†å­åŠ¨åŠ›å­¦ FPMD æ–¹æ³•ï¼Œä¹Ÿæ”¯æŒç»å…¸çš„ Lennard-Jonesï¼ˆLJ å¯¹åŠ¿ï¼‰çš„åˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿã€‚æ­¤å¤–ï¼ŒABACUS è¿˜æ”¯æŒæ·±åº¦åŠ¿èƒ½åˆ†å­åŠ¨åŠ›å­¦ï¼ˆDeep Potential Molecular Dynamicsï¼Œç®€ç§° DPMDï¼‰æ–¹æ³•ï¼Œæ­¤æ—¶éœ€è¦ç¼–è¯‘ [DeePMD-kit](https://github.com/deepmodeling/deepmd-kit) è½¯ä»¶åŒ…å¹¶åœ¨ç¼–è¯‘åŸå­ç®—ç­¹è½¯ä»¶æ—¶è¿›è¡ŒåŠ¨æ€åº“çš„é“¾æ¥ã€‚

## äºŒã€æ–‡æ¡£å’Œç®—ä¾‹è¿è¡Œ

ABACUS é‡Œå…³äºåˆ†å­åŠ¨åŠ›å­¦æ–¹æ³•çš„çº¿ä¸Šæ–‡æ¡£åœ°å€ä¸ºï¼š[http://abacus.deepmodeling.com/en/latest/advanced/md.html](http://abacus.deepmodeling.com/en/latest/advanced/md.html)

ABACUS é‡Œå…³äºåˆ†å­åŠ¨åŠ›å­¦å‚æ•°çš„çº¿ä¸Šæ–‡æ¡£åœ°å€ä¸ºï¼š

[http://abacus.deepmodeling.com/en/latest/advanced/input_files/input-main.html#molecular-dynamics](http://abacus.deepmodeling.com/en/latest/advanced/input_files/input-main.html#molecular-dynamics)

åœ¨ç¤ºä¾‹æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬ä¸ºä½ å‡†å¤‡å¥½äº† ABACUS MD è®¡ç®—çš„ç¤ºä¾‹æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®ï¼šï¼ˆä½ å¯ä»¥åœ¨å·¦ä¾§ç‚¹å‡»æ•°æ®é›†æŸ¥çœ‹ç›¸åº”æ–‡ä»¶ï¼‰ï¼š


```python
! tree /bohr/
```

    [01;34m/bohr/[0m
    â””â”€â”€ [01;34mabacus-md-o9mk[0m
        â””â”€â”€ [01;34mv1[0m
            â”œâ”€â”€ [01;34mPP_ORB[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mAl-SCAN.pb[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mAl_ONCV_PBE_sr.upf[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mC_ONCV_PBE-1.0.upf[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mC_gga_8au_100Ry_2s2p1d.orb[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mH_ONCV_PBE-1.0.upf[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mH_gga_8au_100Ry_2s1p.orb[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mSi.pz-vbc.UPF[0m
            â”‚Â Â  â”œâ”€â”€ [01;32mSi_ONCV_PBE-1.0.upf[0m
            â”‚Â Â  â””â”€â”€ [01;32mSi_gga_8au_60Ry_2s2p1d.orb[0m
            â””â”€â”€ [01;34mmd[0m
                â”œâ”€â”€ [01;34m1_AIMD[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_0[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_1[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_2[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_3[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_4[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_5[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_6[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT_7[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mKPT[0m
                â”‚Â Â  â””â”€â”€ [01;32mSTRU[0m
                â”œâ”€â”€ [01;34m2_LJMD[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT[0m
                â”‚Â Â  â””â”€â”€ [01;32mSTRU[0m
                â”œâ”€â”€ [01;34m3_DPMD[0m
                â”‚Â Â  â”œâ”€â”€ [01;32mINPUT[0m
                â”‚Â Â  â””â”€â”€ [01;32mSTRU[0m
                â””â”€â”€ [01;32mREADME.md[0m
    
    7 directories, 24 files
    


```python
# å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬æ²¡æœ‰æ•°æ®é›†æ‰€åœ¨æ–‡ä»¶å¤¹çš„å†™å…¥æƒé™ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶å¤åˆ¶åˆ° `/data/` ç›®å½•ä¸‹:
! cp -nr /bohr/ /data/

# æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰ä¸€äº›è·¯å¾„ï¼Œå¹¶åˆ‡æ¢åˆ°å·¥ä½œè·¯å¾„ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨ï¼š
import os

bohr_dataset_url = "/bohr/abacus-md-o9mk/v1/"  # url å¯ä»å·¦ä¾§æ•°æ®é›†å¤åˆ¶
work_path = os.path.join("/data", bohr_dataset_url[1:])
os.chdir(work_path)
print(f"å½“å‰è·¯å¾„ä¸ºï¼š{os.getcwd()}")
```

    å½“å‰è·¯å¾„ä¸ºï¼š/data/bohr/abacus-md-o9mk/v1
    

æ³¨ï¼šç®—ä¾‹ä»“åº“é‡Œé¢åŒ…å« `1_AIMD`ï¼Œ`2_LJMD`ï¼ˆé‡‡ç”¨ Lennard-Jones ç»å…¸åŠ¿åš MDï¼‰å’Œ `3_DPMD`ï¼ˆé‡‡ç”¨æ·±åº¦åŠ¿èƒ½æ–¹æ³•åš MDï¼‰ä¸‰ä¸ªç›®å½•ã€‚

æ³¨ï¼šä»¥ä¸Šç®—ä¾‹è¦åœ¨ ABACUS v3.2.1 ç‰ˆæœ¬åŠä»¥ä¸Šå¯ä»¥è¿è¡ŒæˆåŠŸï¼Œå¹¶ä¸”æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸‹è½½ä½¿ç”¨ ABACUS æœ€æ–°ç‰ˆæœ¬ï¼

### 1. ç¬¬ä¸€æ€§åŸç†åˆ†å­åŠ¨åŠ›å­¦ï¼ˆAIMDï¼‰

è¿›å…¥ `1_AIMD` ç›®å½•ï¼Œè¯¥ç›®å½•æä¾›äº† 8 ä¸ªè¾“å…¥æ–‡ä»¶ï¼Œä½¿ç”¨çš„æ—¶å€™å°† `INPUT_*` å¤åˆ¶ä¸º `INPUT` å³å¯ï¼ˆ`INPUT_*` ä»£è¡¨ä» `INPUT_0` åˆ° `INPUT_7` å…± 8 ä¸ªä¸åŒçš„ INPUT æ–‡ä»¶ï¼Œå¯¹åº” 8 ç§ä¸åŒçš„ MD ç®—æ³•ï¼‰ã€‚è¯¥ç®—ä¾‹é‡‡ç”¨ 8 åŸå­çš„é‡‘åˆšçŸ³ç»“æ„ Siï¼Œæ™¶æ ¼ç»“æ„æ”¾åœ¨ `STRU` æ–‡ä»¶é‡Œï¼Œå¸ƒé‡Œæ¸ŠåŒºçš„ k ç‚¹é‡‡æ ·æ”¾åœ¨ `KPT` æ–‡ä»¶é‡Œã€‚

8 ä¸ª INPUT æ–‡ä»¶å¯¹åº”çš„ MD æ–¹æ³•å¦‚ä¸‹ï¼š

`INPUT_0`ï¼šé‡‡ç”¨ NVE å¾®æ­£åˆ™ç³»ç»¼

`INPUT_1`ï¼šé‡‡ç”¨ NVT æ­£åˆ™ç³»ç»¼

`INPUT_2`ï¼šé‡‡ç”¨ Langevin çƒ­åº“

`INPUT_3`ï¼šé‡‡ç”¨ Anderson çƒ­åº“ï¼ŒNVT ç³»ç»¼

`INPUT_4`ï¼šé‡‡ç”¨ MSST æ–¹æ³•

`INPUT_5`ï¼šé‡‡ç”¨ Berendsen çƒ­åº“ï¼ŒNVT ç³»ç»¼

`INPUT_6`ï¼šé‡‡ç”¨ rescaling æ–¹æ³•ï¼ŒNVT ç³»ç»¼

`INPUT_7`ï¼šé‡‡ç”¨ rescale_v æ–¹æ³•ï¼ŒNVT ç³»ç»¼

ä»¥ `INPUT_0` ä¸ºä¾‹ï¼š


```python
! cat ./md/1_AIMD/INPUT_0
```

    INPUT_PARAMETERS
    #Parameters (1.General)
    suffix                 Si_nve
    calculation            md
    nbands                 20
    symmetry               0
    pseudo_dir             ../../PP_ORB
    orbital_dir            ../../PP_ORB
    
    #Parameters (2.Iteration)
    ecutwfc                30
    scf_thr                1e-5
    scf_nmax               100
    
    #Parameters (3.Basis)
    basis_type             lcao
    ks_solver              genelpa
    gamma_only             1
    
    #Parameters (4.Smearing)
    smearing_method        gaussian
    smearing_sigma         0.001
    
    #Parameters (5.Mixing)
    mixing_type            pulay
    mixing_beta            0.3
    chg_extrap             second-order
    
    #Parameters (6.MD)
    md_type                nve
    md_nstep               10
    md_dt                  1
    md_tfirst              300
    

```bash
INPUT_PARAMETERS
#Parameters (1.General)
suffix                 Si_nve
calculation            md
nbands                 20
symmetry               0
pseudo_dir             ../../../tests/PP_ORB
orbital_dir            ../../../tests/PP_ORB

#Parameters (2.Iteration)
ecutwfc                30
scf_thr                1e-5
scf_nmax               100

#Parameters (3.Basis)
basis_type             lcao
ks_solver              genelpa
gamma_only             1

#Parameters (4.Smearing)
smearing_method        gaussian
smearing_sigma         0.001

#Parameters (5.Mixing)
mixing_type            pulay
mixing_beta            0.3
chg_extrap             second-order

#Parameters (6.MD)
md_type                nve
md_nstep               10
md_dt                  1
md_tfirst              300
```

è¿™äº›å‚æ•°åœ¨ [ABACUS çº¿ä¸Šæ–‡æ¡£](http://abacus.deepmodeling.com/en/latest/advanced/input_files/input-main.html#molecular-dynamics)ä¸­å‡æœ‰è¯´æ˜ï¼Œåœ¨è¿™é‡Œå†è¿›è¡Œç®€å•æ¦‚è¿°ï¼š

- calculationï¼šè®¾ç½® ABACUS è®¡ç®—ç±»å‹ï¼Œåšåˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿè¯·è®¾ç½®ä¸º mdã€‚
- esolver_typeï¼šç»™å®šåŸå­ä½ç½®è¿›è¡Œç³»ç»Ÿèƒ½é‡çš„è®¡ç®—ï¼Œé»˜è®¤ Kohn-Sham å¯†åº¦æ³›å‡½ç†è®ºï¼ˆksdftï¼‰ï¼Œè¿˜å¯ä»¥è®¾ç½® LJ åŠ¿ï¼ˆljï¼‰æˆ–è€…æ·±åº¦åŠ¿èƒ½ï¼ˆdpï¼‰ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œæ‰€æœ‰çš„ esolver_type éƒ½å¯ä»¥ç”¨äº MD è®¡ç®—ã€‚
- chg_extrapï¼šç”µè·å¤–æ’æ³•ï¼Œåœ¨ relax å’Œ md è®¡ç®—ä¸­å¯ç”¨äºä¼˜åŒ–ç”µè·å¯†åº¦åˆå§‹åŒ–ï¼ŒåŠ é€Ÿç”µå­è¿­ä»£æ”¶æ•›ï¼ŒMD ä¸­å¯ä»¥è®¾ç½®ä¸º second-orderã€‚
- md_typeï¼šMD ç®—æ³•ç§ç±»ï¼Œé»˜è®¤æ˜¯æ­£åˆ™ç³»ç»Ÿ nvtï¼Œè¿™é‡Œçš„ä¾‹å­é€‰æ‹©çš„æ˜¯ nveï¼Œå³ NVE å¾®æ­£åˆ™ç³»ç»¼ã€‚
- md_nstepï¼šMD æ¨¡æ‹Ÿçš„æ€»æ­¥æ•°ã€‚
- md_dtï¼šMD è®¡ç®—æ¯ä¸€æ­¥çš„æ—¶é—´æ­¥é•¿ï¼ˆå•ä½æ˜¯ fsï¼‰ï¼Œä¸ md_nstep å…±åŒå†³å®š MD æ€»æ—¶é•¿ã€‚
- md_tfirstï¼šMD ç³»ç»Ÿçš„åˆå§‹æ¸©åº¦ï¼ˆå•ä½æ˜¯ Kï¼‰ã€‚

### 2. Lennard-Jones åŠ¿å‡½æ•°

è¿›å…¥ `2_LJMD` ç›®å½•ï¼ŒABACUS è½¯ä»¶åŒ…ä¸­æä¾›äº†ä¸€ä¸ªé‡‡ç”¨ Lennard-Jonesï¼ˆLJï¼‰ç»å…¸åŠ¿å‡½æ•°è¿›è¡Œ MD æ¨¡æ‹Ÿçš„ç®—ä¾‹ï¼Œè¯¥ç®—ä¾‹é‡‡ç”¨ LJ å¯¹åŠ¿ä½œä¸ºèƒ½é‡æ±‚è§£å™¨æ¥åšç»å…¸åˆ†å­åŠ¨åŠ›å­¦ï¼Œåˆå§‹ç»“æ„æ˜¯è¾¹é•¿ 20 åŸƒçš„æ­£æ–¹ä½“ç›’å­ä¸­çš„ 256 ä¸ªæ— åº He åŸå­ã€‚


```python
! tree ./md/2_LJMD/
```

    [01;34m./md/2_LJMD/[0m
    â”œâ”€â”€ [01;32mINPUT[0m
    â””â”€â”€ [01;32mSTRU[0m
    
    0 directories, 2 files
    

#### 2.1 LJ å¯¹åŠ¿

LJ å¯¹åŠ¿çš„è§£æå½¢å¼å¦‚ä¸‹ï¼š$u^{ij}$è¡¨ç¤ºåŸå­ i ä¸åŸå­ j ä¹‹é—´çš„ç›¸äº’ä½œç”¨èƒ½ï¼Œ$r^{ij}$è¡¨ç¤ºè¿™ä¸¤ä¸ªåŸå­ä¹‹é—´çš„è·ç¦»ï¼Œ$\epsilon$ï¼Œ$\sigma$å’Œ$r_{cut}$åˆ™æ˜¯ LJ åŠ¿éœ€è¦çš„ 3 ä¸ªå‚æ•°ã€‚LJ åŠ¿åªè€ƒè™‘æˆªæ–­åŠå¾„$r_{cut}$å†…çš„è¿‘é‚»åŸå­ j å¯¹ä¸­å¿ƒåŸå­ i çš„èƒ½é‡è´¡çŒ®ã€‚

$$
\begin{array}{c}
u^{i j}=4 \varepsilon\left[\left(\frac{\sigma}{r_{i j}}\right)^{12}-\left(\frac{\sigma}{r_{i j}}\right)^{6}\right] \\
\boldsymbol{F}_{i}=-\nabla_{i} U=\sum_{j} 4 \varepsilon\left[12\left(\frac{\sigma}{r_{i j}}\right)^{12}-6\left(\frac{\sigma}{r_{i j}}\right)^{6}\right] \frac{\boldsymbol{r}_{i}-\boldsymbol{r}_{j}}{r_{i j}^{2}} H\left(r_{c u t}-r_{i j}\right)
\end{array} \\
H(x)=\left\{\begin{array}{l}
0\ \ \ \ (x<0) \\
1\ \ \ \ (x>0)
\end{array}\right.\\
$$

#### 2.2 STRU

LJMD æ˜¯ç»å…¸åˆ†å­åŠ¨åŠ›å­¦ï¼Œä¸éœ€è¦æä¾› `KPT`ï¼ŒèµåŠ¿å’Œè½¨é“æ–‡ä»¶ï¼Œ`STRU` çš„å‰é¢å‡ éƒ¨åˆ†å¦‚ä¸‹ï¼š

```bash
ATOMIC_SPECIES
He 4.0026

LATTICE_CONSTANT
1.889727

LATTICE_VECTORS
20 0 0
0 20 0
0 0 20

ATOMIC_POSITIONS
Cartesian

He #label
0 #magnetism
256 #number of atoms
```

- ATOMIC_SPECIESï¼šä¸éœ€è¦æä¾›èµåŠ¿ä¿¡æ¯
- NUMERICAL_ORBITALï¼šä¸éœ€è¦æ·»åŠ è½¨é“ä¿¡æ¯

#### 2.3 INPUT

`INPUT` æ–‡ä»¶ä¸­çš„å‚æ•°ä¹Ÿéœ€è¦åšå°‘é‡ä¿®æ”¹ï¼š

```bash
INPUT_PARAMETERS
#Parameters (General)
suffix              autotest

calculation         md
pseudo_dir          ../../PP_ORB

#Parameters (esolver)
esolver_type        lj
lj_rcut             8.5
lj_epsilon          0.01032
lj_sigma            3.405

cal_force           1
cal_stress          1

#Parameters (MD)
md_nstep            5
md_type             nve
md_dt               1
md_tfirst           300

init_vel            1
```

- esolver_typeï¼šæŒ‡å®šä¸º lj å°±å¯ä»¥åš Lennard-Jones ç»å…¸åŠ¿å‡½æ•°ã€‚
- lj_rcutï¼šLJ å¯¹åŠ¿çš„å‚æ•°ï¼Œå³æˆªæ–­åŠå¾„$r_{cut}$ã€‚
- lj_epsilonï¼šLJ å¯¹åŠ¿çš„å‚æ•°ï¼Œå³$\epsilon$ã€‚
- lj_sigmaï¼šLJ å¯¹åŠ¿çš„å‚æ•°ï¼Œå³$\sigma$ã€‚
- init_velï¼šè¯»å– `STRU` ä¸­çš„åŸå­é€Ÿåº¦ä¿¡æ¯ï¼ŒåŸå­å•ä½åˆ¶ã€‚

### 3. æ·±åº¦åŠ¿èƒ½ï¼ˆDeep Potentialï¼‰

ABACUS è½¯ä»¶åŒ…ä¸­æä¾›äº†ä¸€ä¸ª DPMD çš„ç®—ä¾‹ï¼Œè¿›å…¥ `3_DPMD` ç›®å½•ã€‚è¯¥ç®—ä¾‹é‡‡ç”¨ DP æ¨¡å‹ï¼ˆDeePMD-kit äº§ç”Ÿçš„æ·±åº¦åŠ¿èƒ½æ¨¡å‹ï¼‰ä½œä¸ºèƒ½é‡æ±‚è§£å™¨æ¥åšåŸºäºæœºå™¨å­¦ä¹ çš„åˆ†å­åŠ¨åŠ›å­¦ï¼Œåˆå§‹ç»“æ„æ˜¯ 864 ä¸ªæ— åºé“åŸå­ã€‚

#### 3.1 DP æ¨¡å‹

[DeePMD-kit](https://github.com/deepmodeling/deepmd-kit) æ˜¯ä¸€ç§åŸºäºæœºå™¨å­¦ä¹ çš„åˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨ç¬¬ä¸€æ€§åŸç†è®¡ç®—æ•°æ®å¯¹æ·±åº¦ç¥ç»ç½‘ç»œæ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä»è€Œå¾—åˆ°é€šç”¨çš„å¤šä½“åŠ¿èƒ½æ¨¡å‹ï¼ˆDP æ¨¡å‹ï¼‰ã€‚

#### 3.2 ç¼–è¯‘æ–¹å¼

ABACUS é‡‡ç”¨ DP æ¨¡å‹åš MD è®¡ç®—éœ€è¦ç¼–è¯‘ä¸ DeePMD-kit çš„æ¥å£ï¼Œ[cmake](http://abacus.deepmodeling.com/en/latest/advanced/install.html#build-with-deepmd-kit) ä»¥åŠ [makefile](http://abacus.deepmodeling.com/en/latest/advanced/install.html#add-deepmd-kit-support) ç¼–è¯‘æ–¹å¼å¯ä»¥å‚è€ƒ ABACUS çº¿ä¸Šæ–‡æ¡£ã€‚

#### 3.3 INPUT æ–‡ä»¶è®¾ç½®

DPMD æ˜¯ç»å…¸åˆ†å­åŠ¨åŠ›å­¦ï¼Œä¸éœ€è¦æä¾› KPTï¼ŒèµåŠ¿å’Œè½¨é“æ–‡ä»¶

INPUT æ–‡ä»¶ä¸­çš„å‚æ•°éœ€è¦åšå°‘é‡ä¿®æ”¹ï¼š

```bash
INPUT_PARAMETERS
#Parameters        (General)
suffix              autotest
calculation         md

esolver_type        dp
pot_file            ../../PP_ORB/Al-SCAN.pb

cal_force           1
cal_stress          1

md_nstep            3
md_type             msst
md_dt               1
md_tfirst           200
md_dumpfreq         1
md_restartfreq      1

msst_qmass          200
msst_vel            0.028
msst_vis            0.3

init_vel            1
```

- esolver_typeï¼šè®¾ç½®ä¸º dp
- pot_fileï¼šDP æ¨¡å‹æ–‡ä»¶è·¯å¾„
- md_dumpfreqï¼šMD è¾“å‡ºæ–‡ä»¶ MD_dump ä¸­åŸå­ä»¥åŠæ™¶èƒä¿¡æ¯çš„è¾“å‡ºé¢‘ç‡
- md\_restartfreqï¼šç»“æ„æ–‡ä»¶ STRU\_MD\_\${istep} çš„è¾“å‡ºé¢‘ç‡ï¼ŒMD ç»­ç®—æ–‡ä»¶ Restart_md.dat çš„æ›´æ–°é¢‘ç‡

#### 3.4 STRU æ–‡ä»¶çš„è®¾ç½®

é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç¡®å®š DP åŠ¿æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨å…³é”®å­—â€œtype_mapâ€ï¼š


```python
! strings ./PP_ORB/Al-SCAN.pb | grep type_map
```

    {"model": {"type_map": ["Al"], "descriptor": {"type": "se_e2_a", "sel": [150], "rcut_smth": 0.5, "rcut": 6.0, "neuron": [25, 50, 100], "resnet_dt": false, "axis_neuron": 16, "seed": 1, "activation_function": "tanh", "type_one_side": false, "precision": "default", "trainable": true, "exclude_types": [], "set_davg_zero": false}, "fitting_net": {"neuron": [240, 240, 240], "resnet_dt": true, "seed": 1, "type": "ener", "numb_fparam": 0, "numb_aparam": 0, "activation_function": "tanh", "precision": "default", "trainable": true, "rcond": 0.001, "atom_ener": []}, "data_stat_nbatch": 10, "data_stat_protect": 0.01}, "learning_rate": {"type": "exp", "decay_steps": 5000, "start_lr": 0.001, "stop_lr": 3.51e-08, "scale_by_worker": "linear"}, "loss": {"type": "ener", "start_pref_e": 0.02, "limit_pref_e": 1, "start_pref_f": 1000, "limit_pref_f": 1, "start_pref_v": 0, "limit_pref_v": 0, "start_pref_ae": 0.0, "limit_pref_ae": 0.0, "start_pref_pf": 0.0, "limit_pref_pf": 0.0, "enable_atom_ener_coeff": false}, "training": {"training_data": {"systems": ["../deepmd_data/"], "batch_size": "auto", "set_prefix": "set", "auto_prob": "prob_sys_size", "sys_probs": null}, "validation_data": {"systems": ["../deepmd_validation"], "batch_size": 1, "numb_btch": 3, "set_prefix": "set", "auto_prob": "prob_sys_size", "sys_probs": null}, "numb_steps": 1000000, "seed": 10, "disp_file": "lcurve.out", "disp_freq": 100, "save_freq": 1000, "save_ckpt": "model.ckpt", "disp_training": true, "time_training": true, "profiling": false, "profiling_file": "timeline.json", "enable_profiler": false, "tensorboard": false, "tensorboard_log_dir": "log", "tensorboard_freq": 1}}
    

```bash
$ strings Al-SCAN.pb | grep type_map
{"model": {"type_map": ["Al"], "descriptor": {"type": "se_e2_a", "sel": [150], "rcut_smth": 0.5, "rcut": 6.0, "neuron": [25, 50, 100], "resnet_dt": false, "axis_neuron": 16, "seed": 1, "activation_function": "tanh", "type_one_side": false, "precision": "default", "trainable": true, "exclude_types": [], "set_davg_zero": false}, "fitting_net": {"neuron": [240, 240, 240], "resnet_dt": true, "seed": 1, "type": "ener", "numb_fparam": 0, "numb_aparam": 0, "activation_function": "tanh", "precision": "default", "trainable": true, "rcond": 0.001, "atom_ener": []}, "data_stat_nbatch": 10, "data_stat_protect": 0.01}, "learning_rate": {"type": "exp", "decay_steps": 5000, "start_lr": 0.001, "stop_lr": 3.51e-08, "scale_by_worker": "linear"}, "loss": {"type": "ener", "start_pref_e": 0.02, "limit_pref_e": 1, "start_pref_f": 1000, "limit_pref_f": 1, "start_pref_v": 0, "limit_pref_v": 0, "start_pref_ae": 0.0, "limit_pref_ae": 0.0, "start_pref_pf": 0.0, "limit_pref_pf": 0.0, "enable_atom_ener_coeff": false}, "training": {"training_data": {"systems": ["../deepmd_data/"], "batch_size": "auto", "set_prefix": "set", "auto_prob": "prob_sys_size", "sys_probs": null}, "validation_data": {"systems": ["../deepmd_validation"], "batch_size": 1, "numb_btch": 3, "set_prefix": "set", "auto_prob": "prob_sys_size", "sys_probs": null}, "numb_steps": 1000000, "seed": 10, "disp_file": "lcurve.out", "disp_freq": 100, "save_freq": 1000, "save_ckpt": "model.ckpt", "disp_training": true, "time_training": true, "profiling": false, "profiling_file": "timeline.json", "enable_profiler": false, "tensorboard": false, "tensorboard_log_dir": "log", "tensorboard_freq": 1}}
```

å¦‚æœå­˜åœ¨å…³é”®å­— type_mapï¼Œé‚£ä¹ˆ ABACUS ä¼šè‡ªåŠ¨åŒ¹é… STRU å’Œ DP åŠ¿æ–‡ä»¶ä¸­çš„åŸå­ç§ç±»é¡ºåºã€‚

å¦åˆ™ï¼ŒSTRU ä¸­çš„åŸå­ç§ç±»ä»¥åŠé¡ºåºå¿…é¡»ä¸ DP åŠ¿æ–‡ä»¶ä¸­çš„åŸå­ç§ç±»ä»¥åŠé¡ºåºä¸€è‡´ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ Al-Cu-Mg ä¸‰å…ƒåˆé‡‘çš„ DP åŠ¿æ–‡ä»¶æ¥è·‘ Al-Mg äºŒå…ƒåˆé‡‘çš„ MDï¼Œé‚£ä¹ˆ STRU åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š

```bash
ATOMIC_SPECIES
Al  26.982
Cu  63.546
Mg  24.305

LATTICE_CONSTANT
1.889727000000

LATTICE_VECTORS
4.0  0.0  0.0
0.0  4.0  0.0
0.0  0.0  4.0

ATOMIC_POSITIONS
Cartesian

Al
0
2
0.0  0.0  0.0
0.5  0.5  0.0

Cu
0
0

Mg
0
2
0.5  0.0  0.5
0.0  0.5  0.5
```

æ³¨ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿ Cu åŸå­çš„æ•°é‡ä¸º 0ï¼Œä¹Ÿå¿…é¡»åœ¨ STRU ä¸­ç»™å‡º Cu åŸå­ç›¸å…³ä¿¡æ¯ã€‚

## ä¸‰ã€MD è¾“å‡ºå’Œç»­ç®—åŠŸèƒ½

### 1. MD è¾“å‡ºæ–‡ä»¶

ABACUS çš„ MD æ¨¡æ‹Ÿä¼šäº§ç”Ÿ 3 ç±»è¾“å‡ºæ–‡ä»¶ï¼šç»“æ„æ–‡ä»¶ `STRU_MD_${istep}`ï¼Œç»­ç®—æ–‡ä»¶ `Restart_md.dat`ï¼Œä¿¡æ¯æ–‡ä»¶ `MD_dump`ã€‚

#### 1.1 ç»“æ„æ–‡ä»¶ STRU\_MD\_${istep}

å‚æ•° `md_restartfreq` æ§åˆ¶ `OUT.${suffix}/STRU/` æ–‡ä»¶å¤¹ä¸­ç»“æ„æ–‡ä»¶ `STRU_MD_${istep}` çš„è¾“å‡ºé¢‘ç‡ï¼Œè¯¥æ–‡ä»¶æ ¼å¼ä¸è¾“å…¥ç»“æ„æ–‡ä»¶ STRU ç›¸åŒï¼Œä¸»è¦ç”¨äº MD ç»­ç®—ã€‚è¿™é‡Œ istep ä»£è¡¨ç¦»å­æ­¥ï¼Œä» 0 å¼€å§‹è®¡æ•°ã€‚

#### 1.2 ç»­ç®—æ–‡ä»¶ Restart_md.dat

å‚æ•° `md_restartfreq` æ§åˆ¶ OUT.${suffix}/Restart_md.dat çš„æ›´æ–°é¢‘ç‡ï¼Œç”¨äº MD ç»­ç®—ã€‚

#### 1.3 ä¿¡æ¯æ–‡ä»¶ MD_dump

å‚æ•° `md_dumpfreq` æ§åˆ¶ OUT.${suffix}/MD_dump æ–‡ä»¶çš„è¿½åŠ è¾“å‡ºé¢‘ç‡ï¼Œè¯¥æ–‡ä»¶è¾“å‡ºæ¯ `md_dumpfreq` æ­¥çš„ MD ä¿¡æ¯ï¼ŒåŒ…æ‹¬ MD æ­¥æ•°ï¼Œæ™¶æ ¼å¸¸æ•°ï¼Œæ™¶æ ¼çŸ¢é‡ï¼Œæ™¶æ ¼ç»´é‡Œï¼ŒåŸå­ç¼–å·ï¼ŒåŸå­ä½ç½®ï¼ŒåŸå­å—åŠ›ï¼ŒåŸå­é€Ÿåº¦ã€‚å…¶ä¸­ï¼Œæ™¶æ ¼ç»´é‡Œï¼ŒåŸå­å—åŠ›ï¼ŒåŸå­é€Ÿåº¦å¯ä»¥é€šè¿‡è¾“å…¥å‚æ•° `dump_virial`ï¼Œ`dump_force`ï¼Œ`dump_vel` æ§åˆ¶æ˜¯å¦è¾“å‡ºã€‚

```bash
MDSTEP:  0
LATTICE_CONSTANT: 5.397605400000 Angstrom
LATTICE_VECTORS
  0.500000000000  0.500000000000  0.000000000000
  0.500000000000  0.000000000000  0.500000000000
  0.000000000000  0.500000000000  0.500000000000
VIRIAL (kbar)
  123.045275146001  -3.807535058112  -13.541439282961
  -3.807535058112  124.421300186299  24.047959743672
  -13.541439282961  24.047959743672  125.016024430342
INDEX    LABEL    POSITION (Angstrom)    FORCE (eV/Angstrom)    VELOCITY (Angstrom/fs)
  0  Si  0.000000000000  0.000000000000  0.000000000000  -0.885362725233  0.500467424348  0.150239620206  -0.003506076235  0.000412570794  0.000094403053
  1  Si  1.300822817264  1.376389287977  1.354798867769  0.885362725233  -0.500467424348  -0.150239620206  0.003506076235  -0.000412570794  -0.000094403053

MDSTEP:  1
LATTICE_CONSTANT: 5.397605400000 Angstrom
LATTICE_VECTORS
  0.500000000000  0.500000000000  0.000000000000
  0.500000000000  0.000000000000  0.500000000000
  0.000000000000  0.500000000000  0.500000000000
VIRIAL (kbar)
  123.051574098220  -2.465332696362  -10.608474638302
  -2.465332696362  123.587154919736  16.307187552709
  -10.608474638302  16.307187552709  123.960669810770
INDEX    LABEL    POSITION (Angstrom)    FORCE (eV/Angstrom)    VELOCITY (Angstrom/fs)
  0  Si  5.389827754452  2.701629481339  2.699621723525  -0.602062173578  0.391990779819  0.096323485153  -0.010548689866  0.004659227844  0.001267888485
  1  Si  1.308600113700  1.373562332082  1.353979669688  0.602062173578  -0.391990779819  -0.096323485153  0.010548689866  -0.004659227844  -0.001267888485

MDSTEP:  2
LATTICE_CONSTANT: 5.397605400000 Angstrom
LATTICE_VECTORS
  0.500000000000  0.500000000000  0.000000000000
  0.500000000000  0.000000000000  0.500000000000
  0.000000000000  0.500000000000  0.500000000000
VIRIAL (kbar)
  122.953007762375  -0.240072876170  -4.211946086929
  -0.240072876170  122.930693852071  3.378536464243
  -4.211946086929  3.378536464243  122.992607262385
INDEX    LABEL    POSITION (Angstrom)    FORCE (eV/Angstrom)    VELOCITY (Angstrom/fs)
  0  Si  5.376757913710  2.708010452044  2.701308224779  -0.124946902346  0.155367961328  0.009378252255  -0.012739769308  0.006644009927  0.001613591879
  1  Si  1.321669954442  1.367181361377  1.352293168434  0.124946902346  -0.155367961328  -0.009378252255  0.012739769308  -0.006644009927  -0.001613591879

MDSTEP:  3
LATTICE_CONSTANT: 5.397605400000 Angstrom
LATTICE_VECTORS
  0.500000000000  0.500000000000  0.000000000000
  0.500000000000  0.000000000000  0.500000000000
  0.000000000000  0.500000000000  0.500000000000
VIRIAL (kbar)
  122.881221914392  1.206247195689  2.345023988024
  1.206247195689  123.110079832453  -8.436042066928
  2.345023988024  -8.436042066928  123.123976300784
INDEX    LABEL    POSITION (Angstrom)    FORCE (eV/Angstrom)    VELOCITY (Angstrom/fs)
  0  Si  5.364727401370  2.714719749381  2.702800880457  0.310711926370  -0.086233730382  -0.043760493686  -0.009222308089  0.005510922784  0.001122226311
  1  Si  1.333700466782  1.360472064040  1.350800512757  -0.310711926370  0.086233730382  0.043760493686  0.009222308089  -0.005510922784  -0.001122226311
```

### 2 MD ç»­ç®—åŠŸèƒ½

å¦‚æœ ABACUS è¿è¡Œè¾¾åˆ°æŒ‡å®šçš„ MD æ­¥æ•°ï¼Œæˆ–è€…è®¡ç®—ä¸­æ–­ï¼Œå¯ä»¥é€šè¿‡ MD ç»­ç®—åŠŸèƒ½ç»§ç»­ä¹‹å‰çš„ MD è®¡ç®—ã€‚

ä»¥ä¸Šä¸€ä¸ª `INPUT` æ–‡ä»¶ä¸ºä¾‹ï¼š

```bash
INPUT_PARAMETERS
#Parameters        (General)
suffix              autotest
calculation         md
pseudo_dir          ../../PP_ORB

esolver_type        dp
pot_file            ../../PP_ORB/Al-SCAN.pb

cal_force           1
cal_stress          1

md_nstep            3
md_type             msst
md_dt               1
md_tfirst           200
md_dumpfreq         1
md_restartfreq      1
md_restart          1

msst_qmass          200
msst_vel            0.028
msst_vis            0.3

init_vel            1
```

- `md_restart`ï¼šæ§åˆ¶ç»­ç®—çš„å¼€å…³ï¼Œåœ¨ MD ç»­ç®—æ—¶å°†è¿™ä¸ªå‚æ•°è®¾ä¸º 1ï¼Œå…¶ä»–å‚æ•°ä¸å˜ã€‚å½“ `md_restart` è®¾ä¸º 1ï¼ŒABACUS ä¼šè¯»å–`${read_file_dir}/Restart_md.dat`æ–‡ä»¶ï¼Œä»ä¸­è·å–å½“å‰MDæ­¥æ•°istepä»¥åŠç»­ç®—æ‰€éœ€çš„å…¶ä»–å‚æ•°å¦‚æ’æ¸©å™¨ä»¥åŠæ’å‹å™¨çš„ä¿¡æ¯ï¼Œæ ¹æ®istepä»`OUT.${suffix}/STRU/` æ–‡ä»¶å¤¹ä¸­è¯»å–ç›¸åº”çš„ç»“æ„æ–‡ä»¶ `STRU_MD_${istep}`ï¼Œä¹‹åå°±å¯ä»¥è¿›è¡Œ MD ç»­ç®—äº†ã€‚

## å››ã€MD åå¤„ç†

ç›®å‰ä¸»æµçš„å¯è§†åŒ–è½¯ä»¶å¦‚ [VESTA](https://jp-minerals.org/vesta/en/)ã€[VMD](https://www.ks.uiuc.edu/Research/vmd/)ã€[OVITO](https://www.ovito.org/) å¹¶ä¸æ”¯æŒ ABACUS çš„æ–‡ä»¶æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›åå¤„ç†è½¯ä»¶å®ç° ABACUS çš„ STRUã€MD_dump æ–‡ä»¶ä¸å¸¸ç”¨æ–‡ä»¶æ ¼å¼çš„è½¬åŒ–ã€‚æˆ‘ä»¬æ¯”è¾ƒæ¨èçš„åå¤„ç†è½¯ä»¶æœ‰ï¼š

### 1 ASE

- å®˜ç½‘ï¼šhttps://wiki.fysik.dtu.dk/ase/
- ç”¨æ³•å‚è€ƒ ABACUS çº¿ä¸Šæ–‡æ¡£ï¼š[http://abacus.deepmodeling.com/en/latest/advanced/interface/ase.html](http://abacus.deepmodeling.com/en/latest/advanced/interface/ase.html)

### 2 dpdata

- github ç½‘å€ï¼š[https://github.com/deepmodeling/dpdata](https://github.com/deepmodeling/dpdata)
- gitee ç½‘å€ï¼š[https://gitee.com/deepmodeling/dpdata](https://gitee.com/deepmodeling/dpdata)

### 3 æ¡ˆä¾‹

ç°åœ¨æˆ‘ä»¬ç”¨ LJMD ç®—ä¾‹æ¥æ¼”ç¤ºå¦‚ä½•é‡‡ç”¨<strong>dpdata+OVITO</strong>çš„æ–¹å¼åœ¨ MD è®¡ç®—å®Œæˆååˆ¶ä½œåˆ†å­åŠ¨åŠ›å­¦è½¨è¿¹åŠ¨ç”»ã€‚

#### 3.1 MD è®¡ç®—

ä¸‹è½½æ¡ˆä¾‹æ–‡ä»¶

```bash
$ git clone https://gitee.com/mcresearch/abacus-user-guide
```

è¿›å…¥ LJMD æ–‡ä»¶å¤¹

```bash
$ cd abacus-user-guide/examples/md/2_LJMD
```

ä¿®æ”¹ INPUT å‚æ•°ï¼ŒæŠŠ md_nstep æ”¹ä¸º 100

```bash
INPUT_PARAMETERS
#Parameters (General)
suffix              autotest

calculation         md
pseudo_dir          ../../PP_ORB

#Parameters (esolver)
esolver_type        lj
lj_rcut             8.5
lj_epsilon          0.01032
lj_sigma            3.405

cal_force           1
cal_stress          1

#Parameters (MD)
md_nstep            100
md_type             nve
md_dt               1
md_tfirst           300

init_vel            1
```

è¿è¡Œ abacus

```bash
$ abacus
```

#### 3.2 dpdata è½¬åŒ–æ ¼å¼

å®‰è£… dpdata

```bash
$ git clone https://github.com/deepmodeling/dpdata.git dpdata
$ cd dpdata
$ pip install .
```

è¿è¡Œ dpdataï¼Œå°† MD_dump æ–‡ä»¶è½¬åŒ–ä¸º GROMACS çš„ gro æ ¼å¼çš„æ–‡ä»¶ data.gro

```bash
$ python3
>>> import dpdata
>>> data = dpdata.LabeledSystem("./", fmt="abacus/md")
>>> data.to_gro("data.gro")
```

#### 3.3 OVITO åˆ¶ä½œåŠ¨ç”»

æ‰“å¼€ OVITOï¼Œç‚¹å‡»å·¦ä¸Šè§’ load fileï¼Œé€‰æ‹©ä¸Šä¸€æ­¥çš„ data.gro æ–‡ä»¶


```python
from IPython.display import Image

pic1 = "/bohr/abacus-md-o9mk/v2/picture/fig_md-1.png"
image1 = Image(pic1)
display(image1)
```



å³ä¸Šè§’ rendering settings


```python
from IPython.display import Image

pic2 = "/bohr/abacus-md-o9mk/v2/picture/fig_md-2.png"
image2 = Image(pic2)
display(image2)
```



ç‚¹å‡» Render active viewport å³å¯ä¿å­˜åŠ¨ç”»æ–‡ä»¶


```python
from IPython.display import Image

pic3 = "/bohr/abacus-md-o9mk/v2/picture/fig_md-3.png"
image3 = Image(pic3)
display(image3)
```


