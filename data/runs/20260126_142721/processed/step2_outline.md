<!-- META_START -->
# 《ABACUS 核心教程：电荷混合 (Mixing) 原理与调优指南》

## 前言
- **本书逻辑**: 本教程旨在解决 Kohn-Sham DFT 计算中最为核心的收敛性问题。我们将从自洽场（SCF）迭代的物理本质出发，由浅入深地介绍 ABACUS 中的电荷混合机制。逻辑上遵循“物理原理 -> 基础参数 -> 体系分类策略 -> 疑难杂症处理”的路径，帮助用户建立直觉，从而能够针对不同材料体系快速制定最优参数方案。
- **核心知识点**: SCF 不动点问题、Broyden/Pulay 算法选择、混合步长 (`mixing_beta`) 调节、Kerker 预处理 (`mixing_gg0`) 的物理意义、以及针对金属、绝缘体及强关联体系的差异化调试策略。

<!-- CHAPTER_START -->
## 第一章：混合算法的物理基础与通用配置
**本章逻辑**: 在动手调节参数之前，必须理解“为什么要混合”。本章阐述 SCF 迭代的数学本质，并介绍 ABACUS 中最常用的通用参数，适用于 80% 的常规计算场景。

### Section 1.1: 自洽场迭代与不动点问题
- **内容**: 解释 Kohn-Sham 密度泛函理论计算中输入电荷密度 ($\rho_{in}$) 与输出电荷密度 ($\rho_{out}$) 的不一致性。阐述 Mixing 算法如何通过历史信息构造新的 $\rho_{in}$ 以驱动体系向基态收敛，以及“收敛路径”与“基态能量”的关系。
- **关键参数**: 无

### Section 1.2: 混合算法的选择 (Type)
- **内容**: 对比线性混合 (Plain)、Pulay (DIIS) 混合与 Broyden (拟牛顿法) 混合的效率差异。解释为何 Broyden 是 ABACUS 的默认及推荐选择，以及在何种极端情况下可能需要回退到更简单的算法。
- **关键参数**: `mixing_type`

### Section 1.3: 核心步长控制 (Beta)
- **内容**: 详解混合参数中最敏感的“步长”控制。分析 `mixing_beta` 的物理含义：如何在“快速收敛”（大 Beta）与“数值稳定性”（小 Beta）之间寻找平衡。强调该参数仅影响收敛速度，不改变最终物理结果。
- **关键参数**: `mixing_beta`

<!-- CHAPTER_START -->
## 第二章：基于材料体系的定制化策略
**本章逻辑**: “一套参数走天下”在 DFT 计算中是行不通的。本章是本教程的核心，根据材料的电子结构特征（能隙大小、金属丰度、维度），给出分门别类的参数预设建议，直接指导实战。

### Section 2.1: 宽带隙体系（绝缘体与半导体）
- **内容**: 针对能隙 > 1 eV 的体系（如 Si, SiO2），介绍其相对容易收敛的特性。推荐使用较大的混合步长以减少迭代步数，并说明为何此类体系通常不需要 Kerker 预处理。
- **关键参数**: `mixing_beta` (推荐 0.7), `mixing_gg0` (推荐 0.0)

### Section 2.2: 金属与窄带隙体系（Kerker 预处理）
- **内容**: 深入探讨金属体系中费米面附近的电荷震荡（Charge Sloshing）现象。引入 Kerker Scaling 方法，解释其如何在倒空间抑制长波震荡。详细指导如何配合减小 Beta 值来确保存储了历史信息的迭代能够稳定进行。
- **关键参数**: `mixing_gg0` (推荐 > 0, 如 1.0), `mixing_beta` (推荐 0.2)

### Section 2.3: 孤立体系（原子与分子）
- **内容**: 特别警示在计算孤立原子或分子时可能遇到的陷阱。强调为何 Kerker 预处理在此类体系中往往是“负优化”，以及如何设置参数以避免不必要的收敛停滞。
- **关键参数**: `mixing_gg0` (必须为 0.0)

<!-- CHAPTER_START -->
## 第三章：进阶调试与难收敛体系处理
**本章逻辑**: 当标准策略失效，或者涉及复杂的物理泛函（如 DFT+U, Meta-GGA）时，需要更精细的控制。本章介绍如何利用历史步数、密度矩阵混合等高级功能解决“硬骨头”。

### Section 3.1: 历史信息的利用与重置 (Dimension & Restart)
- **内容**: 解释 Pulay/Broyden 算法中“历史维度”的概念。指导在收敛停滞（震荡不减）时如何通过增加历史步数来利用更多信息，或通过定期重置历史来清除累积的数值误差。
- **关键参数**: `mixing_ndim`, `mixing_restart`

### Section 3.2: 复杂泛函的特殊混合 (DFT+U & Meta-GGA)
- **内容**: 针对强关联体系（DFT+U）和 Meta-GGA 计算，介绍除了电荷密度外，还需要对“密度矩阵”或“动能密度”进行混合的必要性。这是提升此类复杂计算收敛性的关键技巧。
- **关键参数**: `mixing_dmr`, `mixing_tau`

<!-- APPENDIX_START -->
## 附录：调试速查表与常见报错
- **调试流程图 (文本版)**: "如果不收敛怎么办"的 step-by-step 检查清单（检查 Beta -> 检查 Ndim -> 检查 Metal/Kerker -> 检查 DMR）。
- **常见陷阱**: 能量大幅震荡的处理、Kerker 误用的后果、内存消耗提示（`mixing_ndim` 与内存的关系）。
- **参数默认值速查**: 汇总 `mixing_type`, `mixing_beta` 等参数在 ABACUS 中的默认行为。