# 第一章：磁性计算基石——共线自旋极化

在进入复杂的自旋轨道耦合（SOC）和非共线磁性计算之前，我们必须先掌握 ABACUS 中最基础的磁性处理方式——**共线自旋极化（Collinear Spin Polarization）**。

本章将确立“磁性”在 ABACUS 中的基本定义方式，并明确共线磁性的物理假设，为后续章节奠定坚实的参数设置基础。

---

## 1.1 电子自旋自由度的开启

在标准的密度泛函理论（DFT）计算中，默认情况是不考虑电子自旋极化的（即 `nspin=1`）。这意味着对于每个空间轨道，自旋向上（Spin-up）和自旋向下（Spin-down）的电子占据数是相等的，体系被强制为非磁性。

要模拟铁磁、反铁磁或亚铁磁体系，我们必须打破这种对称性，允许不同自旋方向的电子密度独立演化。在 ABACUS 中，这是通过 `INPUT` 文件中的 `nspin` 参数控制的。

### 1.1.1 核心参数：`nspin`
- **参数名**: `nspin`
- **类型**: Integer
- **物理意义**: 电子自旋的自由度。
- **取值说明**:
    - `1`: **无自旋极化（Non-magnetic）**。默认值。适用于非磁性体系（如 Si, Al）。
    - `2`: **共线自旋极化（Collinear Spin-polarized）**。适用于铁磁、反铁磁等磁矩沿单一轴向分布的体系（如 bcc-Fe, NiO）。
    - `4`: **非共线自旋极化（Non-collinear Spin-polarized）**。通常涉及自旋轨道耦合（SOC）或复杂的磁结构（如斯格明子）。

### 1.1.2 关键逻辑：参数组合陷阱
**（Critical Warning）**
新手在进行磁性计算时，极易混淆 `nspin`、`lspinorb`（SOC开关）和 `noncolin`（非共线开关）的关系。请务必熟记下表，这是 ABACUS 磁性计算的**参数组合逻辑表**：

| 计算类型 | nspin | lspinorb | noncolin | 物理含义 |
| :--- | :---: | :---: | :---: | :--- |
| **无磁** | `1` | `0` | `0` | 电子成对，无净磁矩 |
| **共线磁性** | **`2`** | `0` | `0` | **本章重点**：磁矩仅分 Up/Down，默认沿 Z 轴 |
| **共线 + SOC** | `4` | `1` | `0` | **易错点**：开启 SOC 必须将 nspin 设为 4 |
| **非共线磁性** | `4` | `0` | `1` | 磁矩可在三维空间任意旋转 |
| **非共线 + SOC** | `4` | `1` | `1` | 最通用的磁性计算形式（如拓扑磁性材料） |

> **注意**：在 ABACUS 的某些版本中，当设置 `lspinorb = 1` 或 `noncolin = 1` 时，`nspin` 会自动默认为 4，但为了输入文件的清晰和兼容性，**强烈建议显式指定 `nspin = 4`**。

---

## 1.2 初始磁矩与默认方向

开启 `nspin = 2` 仅仅是告诉软件“允许”磁性的存在。由于 DFT 是迭代求解过程，如果初始猜测的电子密度没有磁性（即磁矩为 0），自洽循环（SCF）很有可能会收敛到一个非磁性的亚稳态解。

因此，我们必须给体系一个“初始推力”，即在结构文件 `STRU` 中指定初始磁矩。

### 1.2.1 物理假设：Z 轴锁定与各向同性
在 `nspin = 2`（共线磁性）的计算中，ABACUS 采用了一个重要的物理假设：
- **标量磁性**：电子密度仅分为 $\rho_{up}(\mathbf{r})$ 和 $\rho_{down}(\mathbf{r})$。
- **方向锁定**：虽然物理上磁矩可以指向任意方向，但在**不开启 SOC 和非共线计算**的情况下，体系的能量与磁矩的绝对方向无关（磁各向同性）。为了计算方便，ABACUS 默认将量子化轴（Quantization Axis）**锁定在 Z 轴**。
- **结果解读**：输出文件中的磁矩正值（+）代表沿 +Z 方向，负值（-）代表沿 -Z 方向。

### 1.2.2 在 STRU 文件中设置初始磁矩
我们需要在 `STRU` 文件中为磁性原子指定初始磁矩的大小。这通常在原子位置部分进行设置。

**STRUCT 文件示例（片段）：**
```text
ATOMIC_POSITIONS
Direct
Fe
1.0
0.0 0.0 0.0 m=2.2  <-- 这里的 "m" 或具体数值位置代表初始磁矩
0.5 0.5 0.5 m=2.2
```
*(注：不同版本的 ABACUS 对 `STRU` 文件中磁矩定义的具体语法（如是否需要 `mag=` 关键字或仅需数值）可能有所不同，请务必参考您所使用版本的官方文档中关于 `ATOMIC_POSITIONS` 的说明。)*

**设置原则：**
1.  **宁大勿小**：一般建议设置比实验值或预期值稍大的初始磁矩（例如 Fe 设为 3.0 或 4.0 $\mu_B$），以防止 SCF 掉入非磁基态。
2.  **反铁磁设置**：对于反铁磁体系，必须手动将一半原子的磁矩设为正值，另一半设为负值（例如 `m=2.0` 和 `m=-2.0`）。

---

## 1.3 进阶视野：通往非共线与拓扑磁性

虽然本章聚焦于共线磁性，但理解其局限性对于进阶研究至关重要。

### 1.3.1 为什么需要非共线计算？
当 `nspin=2` 时，我们假设所有原子的磁矩都平行或反平行（共线）。然而，在许多前沿材料中，这一假设失效：
- **阻挫磁性（Frustrated Magnetism）**：如三角晶格上的 120 度磁结构。
- **拓扑磁结构**：如斯格明子（Skyrmions），其磁矩在实空间形成涡旋状结构。
- **强 SOC 体系**：在拓扑绝缘体或外尔半金属中，自旋方向与晶体动量强关联（Spin-Momentum Locking）。

对于上述情况，必须切换到 `nspin=4` 并开启 `noncolin = 1`。

### 1.3.2 风险提示：非共线磁矩的初始化
**（Risk Warning: Missing Info）**
在进行非共线计算（`noncolin=1`）时，`STRU` 文件中对磁矩的定义将不再是一个简单的标量（大小），而是一个**矢量**（需要指定 x, y, z 分量或欧拉角）。
> **特别提醒**：ABACUS 不同版本对于非共线磁矩初始化的输入格式（如是使用三个数值 `mx my mz` 还是欧拉角 `theta phi`）有严格规定。**请务必查阅 ABACUS 官方文档中关于 `STRU` 文件原子磁矩方向设置的章节**，以确保磁结构初始化正确。错误的初始化会导致 SCF 难以收敛或收敛到错误的磁构型。

---

## 1.4 锦囊妙计：连接 TB2J 计算磁性相互作用

如果你进行磁性计算的目的是为了通过海森堡模型研究居里温度或磁振子（Magnon），ABACUS 提供了与 **TB2J** 软件的无缝接口。

**实战技巧**：
在 `INPUT` 文件中，如果你使用的是 LCAO 基组，可以关注以下参数（具体参数名请查阅最新文档，通常涉及哈密顿量输出）：
- **功能**：输出局域轨道下的哈密顿量和重叠矩阵。
- **参数线索**：`out_mat_hs2` (需确认具体版本支持情况)。
- **作用**：TB2J 可以直接读取 ABACUS 生成的这些矩阵，利用格林函数方法快速计算磁性交换相互作用参数（$J_{ij}$）、Dzyaloshinskii-Moriya 相互作用（DMI）以及磁各向异性（MAE）。

这使得 ABACUS + TB2J 成为处理复杂磁性体系（如多磁性原子、低维磁性材料）的强力工具组合。

---

**下一章预告**：
掌握了共线磁性后，下一章我们将深入探讨**自旋轨道耦合（SOC）**的计算，这是理解磁各向异性（MAE）和拓扑能带结构的关键。