# 第一章：弹性力学基础与计算原理

在正式启动 ABACUS 进行计算之前，我们需要先建立清晰的物理图像。很多初学者容易陷入“只知道运行脚本，不知道算出了什么”的误区。本章不涉及具体的代码操作，旨在明确“算什么”和“怎么算”，特别是解释清楚为什么通过施加微小的晶格形变并计算应力响应，就能推导出材料的弹性常数。

## 1.1 广义胡克定律与弹性张量

### 1.1.1 从弹簧到晶体
我们在中学物理中学过胡克定律 $F = -k \Delta x$，描述了弹簧受力与伸长量的线性关系。在三维晶体材料中，这一关系被推广为**广义胡克定律**。

*   **应变（Strain, $\varepsilon$）**：描述晶体形状的微小变化（相当于 $\Delta x$）。
*   **应力（Stress, $\sigma$）**：描述晶体内部为了抵抗形变而产生的单位面积内力（相当于 $F$）。

在弹性极限内（即形变足够小，撤去外力后材料能恢复原状），应力与应变呈线性关系：

$$ \sigma_{ij} = \sum_{kl} C_{ijkl} \varepsilon_{kl} $$

这里的 $C_{ijkl}$ 就是我们要计算的主角——**弹性刚度张量（Elastic Stiffness Tensor）**。

### 1.1.2 Voigt 记号：将 81 个分量简化为 $6 \times 6$ 矩阵
从数学上看，$C_{ijkl}$ 是一个四阶张量，拥有 $3 \times 3 \times 3 \times 3 = 81$ 个分量。直接计算这 81 个数既困难又无必要。利用应力和应变的对称性（$\sigma_{ij}=\sigma_{ji}$，$\varepsilon_{ij}=\varepsilon_{ji}$），我们可以使用 **Voigt 记号** 将下标简化：

*   $xx \rightarrow 1$
*   $yy \rightarrow 2$
*   $zz \rightarrow 3$
*   $yz \rightarrow 4$
*   $xz \rightarrow 5$
*   $xy \rightarrow 6$

通过这种映射，四阶张量被“降维”为一个 $6 \times 6$ 的对称矩阵 $C_{ij}$：

$$
\begin{pmatrix}
\sigma_1 \\ \sigma_2 \\ \sigma_3 \\ \sigma_4 \\ \sigma_5 \\ \sigma_6
\end{pmatrix}
=
\begin{pmatrix}
C_{11} & C_{12} & C_{13} & C_{14} & C_{15} & C_{16} \\
C_{12} & C_{22} & C_{23} & C_{24} & C_{25} & C_{26} \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
C_{16} & C_{26} & C_{36} & C_{46} & C_{56} & C_{66}
\end{pmatrix}
\begin{pmatrix}
\varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \varepsilon_4 \\ \varepsilon_5 \\ \varepsilon_6
\end{pmatrix}
$$

> **教授提示**：对于立方晶系（如硅 Si、铜 Cu），由于高度的晶体对称性，这个矩阵中只有三个独立的非零分量：$C_{11}$（抗轴向拉伸）、$C_{12}$（泊松效应）、$C_{44}$（抗剪切）。这大大减少了我们需要计算的工作量。

---

## 1.2 第一性原理计算中的应力-应变法

在实验中，我们通常施加力测量形变。而在基于密度泛函理论（DFT）的 ABACUS 计算中，我们采用逆向思维的**应力-应变法（Stress-Strain Method）**。

### 1.2.1 核心计算逻辑
1.  **施加应变**：人为地将晶胞产生微小的变形（例如将晶格矢量 $a$ 拉长 1%）。
2.  **计算应力**：固定变形后的晶胞形状，让电子和离子弛豫到能量最低态，利用 DFT 计算出此时晶胞内部的柯西应力（Cauchy Stress）。
3.  **线性拟合**：对不同大小的应变（如 $\pm 0.5\%, \pm 1.0\%$）重复上述步骤，通过应力-应变曲线的斜率求出 $C_{ij}$。

### 1.2.2 关键参数：`cal_stress`
为了实现上述逻辑，必须要求 ABACUS 在输出文件中打印出应力张量。在 `INPUT` 文件中，这是由以下参数控制的：

```bash
cal_stress   1    # 开启应力计算，这对弹性常数计算至关重要
cal_force    1    # 开启受力计算，用于原子弛豫
```

### 1.2.3 核心难点一：惯用胞 vs 原胞 (Conventional vs. Primitive Cell)
这是新手最容易“翻车”的地方。

*   **问题背景**：以硅（Si）为例，其**原胞（Primitive Cell）**只包含 2 个原子，晶格矢量是非正交的（面心立方基矢）；而**惯用胞（Conventional Cell）**包含 8 个原子，晶格矢量是正交的立方体。
*   **计算选择**：**强烈建议使用惯用胞进行弹性常数计算**。
*   **原因解析**：
    *   弹性常数 $C_{11}, C_{12}, \dots$ 的物理定义通常是基于笛卡尔坐标系（x, y, z）的。
    *   如果你使用 2 原子的原胞，施加的应变是沿着原胞基矢方向的，计算出的 $C$ 矩阵也是基于原胞基矢定义的。得到的矩阵是非对角的，且数值无法直接与实验值（如 $C_{11}=165$ GPa）对应。
    *   虽然可以通过张量旋转变换将原胞结果转为笛卡尔坐标系结果，但这增加了极大的复杂度和出错概率。
    *   **结论**：为了物理直观和后续处理方便，请牺牲一点计算时间，使用 8 原子的立方惯用胞，并确保晶格矢量与坐标轴平行。

### 1.2.4 核心难点二：原子弛豫的重要性 (Relaxed-ion vs. Clamped-ion)
当我们把晶胞拉长（施加应变）后，原子该怎么办？

1.  **Clamped-ion（钳制离子）**：晶胞变了，但原子在晶胞内的相对分数坐标保持不变。这相当于把原子“冻”住了。
2.  **Relaxed-ion（松弛离子）**：晶胞变了，允许原子在新的晶胞形状下移动，寻找新的受力平衡位置。

**物理事实**：在真实的宏观弹性测量中，原子的响应速度远快于宏观形变，它们总是在平衡位置附近。因此，我们需要计算的是**松弛离子弹性常数**。

**ABACUS 操作指南**：
在对变形后的结构进行计算时，`INPUT` 文件中的 `calculation` 类型必须设置为 `relax`（固定晶胞，优化原子位置），而不是 `scf`（静态计算）或 `cell-relax`（变胞优化）。

*   **错误做法**：使用 `scf`。这会得到 Clamped-ion 模量，通常会高估材料的硬度。
*   **错误做法**：使用 `cell-relax`。这会让晶胞变回无应变的状态，导致前功尽弃。
*   **正确做法**：使用 `relax`。固定我们施加的应变形状，让原子去适应这个形状。

### 1.2.5 标准工作流 (Workflow)
基于上述原理，一个完整的计算流程应包含三个阶段：

1.  **Pre-process（预处理）**：
    *   对初始结构进行彻底的 `cell-relax`。必须保证初始结构处于无应力（Zero Stress）状态，否则后续计算的应力会包含初始残余应力，导致拟合误差。
2.  **Process（计算执行）**：
    *   使用脚本（如 `abacustest`）生成一系列变形结构（$\pm \delta$）。
    *   生成对应的 `INPUT` 文件，确保开启 `cal_stress 1` 和 `calculation relax`。
    *   批量提交任务。
3.  **Post-process（后处理）**：
    *   从输出文件中提取应力数据。
    *   进行线性拟合，输出 $C_{ij}$ 矩阵及体模量（Bulk Modulus）、剪切模量（Shear Modulus）等衍生量。

> **锦囊妙计 (Risk Warning)**：
> 在使用 `abacustest elastic` 命令准备输入文件时，请务必注意：**该命令会删除目标目录下已存在的 `deform` 文件夹**。
> 如果你已经算了一半，想补充几个点或重新生成某个文件，**切勿**直接在原目录重复运行该命令，否则你辛苦计算的数据将被瞬间清空。请务必备份或在在不同路径下操作。