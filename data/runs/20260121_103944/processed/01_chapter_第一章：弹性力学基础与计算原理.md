# 第一章：弹性力学基础与计算原理

欢迎来到《ABACUS 实战教程》。在开始编写输入文件和提交任务之前，我们必须先建立清晰的物理图像。计算材料的弹性性质，本质上是在探究材料在微小形变下原子间的相互作用力响应。

本章将从广义胡克定律出发，推导弹性张量的数学形式，并重点阐述如何通过第一性原理计算（DFT）中的“应力-应变法（Stress-Strain Method）”来获取这些关键参数。我们将结合 ABACUS 的辅助工具 `abacustest`，梳理出一套标准化的工作流。

---

## 1.1 广义胡克定律与弹性张量

在宏观力学中，弹簧的胡克定律 $F = kx$ 描述了力与位移的线性关系。在连续介质力学和晶体物理中，这一关系被推广为**广义胡克定律**。

### 1.1.1 应力与应变的张量性质
当材料受到外部载荷时，其内部会产生**应力（Stress, $\sigma$）**，同时形状发生变化产生**应变（Strain, $\varepsilon$）**。
*   **应力 $\sigma_{ij}$**：描述单位面积上的内力，是一个二阶对称张量（$3 \times 3$ 矩阵）。
*   **应变 $\varepsilon_{kl}$**：描述材料的相对形变，同样是一个二阶对称张量。

### 1.1.2 弹性张量 $C_{ijkl}$
在小形变（线性弹性）范围内，应力与应变通过一个四阶张量联系起来：

$$ \sigma_{ij} = \sum_{k,l} C_{ijkl} \varepsilon_{kl} $$

这里的 $C_{ijkl}$ 即为我们试图计算的**弹性张量（Stiffness Tensor）**。
*   **数学维度**：由于 $i, j, k, l$ 各有 3 个分量（x, y, z），$C_{ijkl}$ 理论上有 $3^4 = 81$ 个分量。
*   **物理降维**：由于应力和应变本身是对称张量（$\sigma_{ij} = \sigma_{ji}$，$\varepsilon_{kl} = \varepsilon_{lk}$），以及热力学势函数的存在，这 81 个分量并非全部独立。

---

## 1.2 Voigt 记号与对称性约化

为了便于数值计算和书写，我们通常使用 **Voigt 记号** 将张量降维。这是阅读 ABACUS 输出结果和理解 `abacustest` 数据格式的基础。

### 1.2.1 索引映射规则
Voigt 记号将二阶张量的双下标 $(ij)$ 映射为单下标 $(m)$：

| 张量下标 $(ij)$ | $xx$ | $yy$ | $zz$ | $yz$ | $xz$ | $xy$ |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: |
| **Voigt 下标** | **1** | **2** | **3** | **4** | **5** | **6** |

基于此映射：
*   **应力/应变**：从 $3 \times 3$ 矩阵变为 6 维向量。
    $$ \boldsymbol{\sigma} = (\sigma_1, \sigma_2, \sigma_3, \sigma_4, \sigma_5, \sigma_6)^T $$
*   **弹性张量**：从 $3 \times 3 \times 3 \times 3$ 变为 $6 \times 6$ 的对称矩阵 $C_{mn}$。

$$ 
\begin{pmatrix} \sigma_1 \\ \sigma_2 \\ \sigma_3 \\ \sigma_4 \\ \sigma_5 \\ \sigma_6 \end{pmatrix} 
= 
\begin{pmatrix} 
C_{11} & C_{12} & C_{13} & C_{14} & C_{15} & C_{16} \\
C_{12} & C_{22} & C_{23} & C_{24} & C_{25} & C_{26} \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
C_{16} & C_{26} & C_{36} & C_{46} & C_{56} & C_{66} 
\end{pmatrix}
\begin{pmatrix} \varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \varepsilon_4 \\ \varepsilon_5 \\ \varepsilon_6 \end{pmatrix}
$$

### 1.2.2 晶体对称性的影响
晶体的对称性会进一步迫使矩阵中某些元素为 0 或相互相等。
*   **以立方晶系（如 Si, Cu）为例**：
    独立弹性常数仅剩 3 个：$C_{11}$（纵向压缩），$C_{12}$（横向膨胀），$C_{44}$（剪切）。
    矩阵形式简化为：
    $$ 
    \begin{pmatrix} 
    C_{11} & C_{12} & C_{12} & 0 & 0 & 0 \\
    C_{12} & C_{11} & C_{12} & 0 & 0 & 0 \\
    C_{12} & C_{12} & C_{11} & 0 & 0 & 0 \\
    0 & 0 & 0 & C_{44} & 0 & 0 \\
    0 & 0 & 0 & 0 & C_{44} & 0 \\
    0 & 0 & 0 & 0 & 0 & C_{44} 
    \end{pmatrix}
    $$

> **教授的特别提示：坐标系对齐（Alignment）**
> 很多初学者会忽略的一点是：**弹性常数是有方向的**。
> 在准备 ABACUS 的 `STRU` 文件时，**务必确保晶格矢量与笛卡尔坐标轴对齐**（例如，晶格矢量 a 沿 x 轴）。
> *   如果你随意旋转了晶体结构，计算出的 $C_{ij}$ 也是旋转后的结果，无法直接与文献中的标准值（通常基于 IEEE 标准取向）对比。
> *   `abacustest` 在处理如 Si 这种惯用胞时，通常假设你已经做好了对齐。

---

## 1.3 第一性原理计算方法：应力-应变法

ABACUS 无法直接输出弹性常数。我们采用**应力-应变法（Stress-Strain Method）**，其核心是通过 DFT 计算“数值导数”。

### 1.3.1 计算原理
1.  **构造形变**：对平衡态晶体施加一系列微小的应变 $\varepsilon$（例如 $\pm 0.5\%, \pm 1\%$）。这通常包括正应变（改变体积/轴长）和剪切应变（改变角度）。
2.  **计算响应**：使用 ABACUS 对每一个形变后的结构进行自洽计算，得到对应的应力 $\sigma$。
3.  **拟合求解**：利用 $\sigma = C \varepsilon$，通过最小二乘法拟合出 $C_{ij}$ 矩阵元。

### 1.3.2 标准工作流 (Workflow)
在接下来的实战章节中，我们将严格遵循由 `abacustest` 定义的标准化工作流：

1.  **Pre-process (预处理)**：
    *   生成初始结构（如 `POSCAR` 或 `STRU`）。
    *   **重要**：进行 `cell-relax`（变胞弛豫），确保初始结构处于无应力状态（Stress $\approx$ 0）。这是计算准确的前提。

2.  **Deformation (施加形变)**：
    *   使用 `abacustest` 自动生成包含不同应变模式的文件夹（如 `deform-001`, `deform-002`...）。
    *   **警告**：`abacustest` 的核心案例指出，**重复执行准备命令会直接删除当前目录下已有的准备结果**。请务必小心，不要在计算完成后误删数据！

3.  **Calculation (批量计算)**：
    *   对所有形变文件夹提交 ABACUS 任务。
    *   **核心参数**：必须在 `INPUT` 文件中设置 `cal_stress = 1`，否则 ABACUS 不会输出应力张量，后续无法拟合。

4.  **Post-process (后处理)**：
    *   收集所有算例的应力数据，拟合得到弹性模量（Bulk Modulus $B$, Shear Modulus $G$, Young's Modulus $E$ 等）。

### 1.3.3 固定离子 vs. 松弛离子 (Clamped vs. Relaxed Ion)
在施加应变后，原子在晶胞内部的位置是否允许调整？这对应两种不同的物理情形：

*   **固定离子 (Clamped-ion)**：
    *   原子仅随晶格矢量做均匀仿射变换，内部坐标（Direct coordinates）保持不变。
    *   对应 DFT 计算中的 `calculation = scf`。
    *   这通常对应于高频响应。

*   **松弛离子 (Relaxed-ion)**：
    *   固定变形后的晶胞形状，但允许原子受力移动到新的能量极小值位置。
    *   对应 DFT 计算中的 `calculation = relax`（固定晶胞优化原子）。
    *   **推荐设置**：这是通常意义下与实验值（静态或低频测量）更接近的结果。`abacustest` 默认会对变形结构进行原子弛豫（除非指定 `--norelax`）。

通过本章的学习，你应该已经明确了“算什么”（$C_{ij}$ 矩阵）以及“怎么算”（施加应变->算应力->拟合）。下一章，我们将进入实战环节，手把手教你计算硅（Si）的弹性常数。