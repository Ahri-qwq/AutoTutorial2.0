<!-- META_START -->
# ABACUS 实战教程：布里渊区采样与 K 点设置全解

## 前言
- **本书逻辑**: 本教程旨在引导用户从物理原理出发，掌握 ABACUS 中布里渊区采样（K点）的设置方法。逻辑上遵循“由静到动”的顺序：先掌握用于基态计算（SCF/结构优化）的**均匀网格模式**，再进阶到用于能带分析的**高对称路径模式**，最后探讨提升计算效率与准确性的**高级技巧**。
- **核心知识点**: 布里渊区积分、Monkhorst-Pack 网格、能带路径 (Band Path)、KPT 文件格式详解、`kspacing` 自动设置、`gamma_only` 加速技术。

<!-- CHAPTER_START -->
## 第一章：基态计算中的均匀采样 (Mesh Mode)
**本章逻辑**: 任何材料计算的起点都是自洽场 (SCF) 计算或结构优化。这要求在布里渊区进行均匀的积分采样。本章重点讲解最常用的 Monkhorst-Pack 方法及其在 ABACUS 中的两种实现方式（手动文件 vs 自动参数），为后续所有计算打下基础。

### Section 1.1: 物理基础与 KPT 文件结构
- **内容**: 介绍布里渊区采样的物理意义（积分近似），详解 `KPT` 文件的标准格式。重点阐述如何通过“自动网格模式”定义 $k$ 点，包括设置标志位 `0`、选择 `Gamma` 或 `mp` 方案的区别（是否包含原点），以及网格密度 `nx ny nz` 的定义。
- **关键参数**: 
    - KPT文件参数: `0` (自动生成标志), `Gamma` (Gamma-centered), `mp` (Monkhorst-Pack), `nx ny nz` (网格划分), `sx sy sz` (平移量)。

### Section 1.2: 极简方案：使用 kspacing 自动生成
- **内容**: 介绍 ABACUS 的易用性功能 `kspacing`。说明在不提供 `KPT` 文件的情况下，如何仅通过 `INPUT` 参数控制 $k$ 点密度。对比手动设置 `KPT` 文件与使用 `kspacing` 的优劣（灵活性 vs 便捷性），并说明其适用的场景。
- **关键参数**: 
    - INPUT参数: `kspacing` (最小K点间距)。

### Section 1.3: 收敛性测试实战
- **内容**: 讲解如何确定“足够好”的 $k$ 点密度。介绍收敛性测试的方法论（能量 vs K点密度），以及针对不同晶系（如立方体系）和超胞（Supercell）计算时的 $k$ 点折叠规则（扩胞 $N$ 倍，$k$ 点缩减 $1/N$）。
- **关键参数**: 无（主要涉及改变 `KPT` 网格数值进行多次测试）。

<!-- CHAPTER_START -->
## 第二章：能带结构计算中的路径设置 (Line Mode)
**本章逻辑**: 在获得收敛的基态电荷密度后，研究者通常需要分析电子能带结构。这需要沿着高对称点进行非均匀采样。本章核心在于区分“计算流程”：明确能带计算必须基于 SCF 结果，并详解专用的线模式 (Line Mode) 设置及文件管理技巧。

### Section 2.1: 高对称路径与 Line 模式格式
- **内容**: 介绍能带计算的物理目标（色散关系）。详解 `KPT` 文件在“线模式”下的特殊格式：高对称点数量 `N`、标志位 `Line`、以及坐标与插值点数 `n` 的设置。强调坐标必须为倒空间分数坐标，且需与 `STRU` 文件匹配。
- **关键参数**: 
    - KPT文件参数: `N` (高对称点总数), `Line` (线模式标志), `x y z` (分数坐标), `n` (插值点数)。

### Section 2.2: 关键流程：从 SCF 到 Non-SCF
- **内容**: 阐述能带计算的标准“两步走”流程：(1) 使用均匀网格进行 SCF 计算得到电荷密度；(2) 读取电荷密度进行 Non-SCF 能带计算。**重点强调**不要直接用 Line 模式做 SCF 计算的错误操作。
- **关键参数**: 无（涉及流程控制）。

### Section 2.3: 文件管理与多文件协作
- **内容**: 解决实际操作中的文件名冲突问题。演示如何在不覆盖原 `KPT`（用于 SCF）的情况下，创建专用的能带 K 点文件（如命名为 `KLINES`），并通过 `INPUT` 文件中的 `kpoint_file` 参数指定读取路径。
- **关键参数**: 
    - INPUT参数: `kpoint_file` (指定K点文件名)。

<!-- CHAPTER_START -->
## 第三章：大体系与特殊场景优化
**本章逻辑**: 随着体系增大，K 点计算量呈爆炸式增长。本章面向进阶用户，介绍针对大体系（如表面、团簇、大超胞）的特殊采样策略，特别是 Gamma 点单点计算技术，以解决内存和时间瓶颈。

### Section 3.1: Gamma-Only 技术
- **内容**: 针对原子数较多（$N$ 大）的大体系，介绍 `gamma_only` 算法。解释为什么大超胞可以用 $\Gamma$ 点近似全布里渊区积分，以及开启该功能后对内存和速度的显著提升。
- **关键参数**: 
    - INPUT参数: `gamma_only` (仅Gamma点计算开关)。

### Section 3.2: 常见报错与避坑指南
- **内容**: 总结新手常犯错误，包括：Mesh 模式下第二行误填非零值导致模式识别错误、能带计算未读取电荷密度、以及 `kspacing` 与 `KPT` 文件共存时的优先级问题。
- **关键参数**: 无。

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **外部工具**: 推荐使用 SeekPath 等工具辅助寻找高对称点坐标。
- **单位说明**: 补充说明 `kspacing` 的具体单位（1/Bohr 或 1/Angstrom，建议查阅最新文档确认）。
- **FAQ**: 为什么我的能带是平的？（检查是否误用了 SCF 流程）。