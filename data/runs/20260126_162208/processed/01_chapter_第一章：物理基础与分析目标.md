# 第一章：物理基础与分析目标

在启动 ABACUS 进行昂贵的分子动力学（MD）计算之前，我们必须建立清晰的物理图像：我们到底在算什么？对于液态、非晶或高温固态体系，**结构有序性**和**原子扩散行为**是两个最核心的描述符。

本章将从物理原理出发，明确径向分布函数（RDF）和均方差位移（MSD）的定义，并深入讲解如何在 ABACUS 的生产运行（Production Run）与后续分析（Analysis）中正确设置关键参数。

---

## 1.1 结构有序性的度量——RDF

### 1.1.1 物理意义
径向分布函数（Radial Distribution Function, RDF），通常记为 $g(r)$，描述了在以任意原子为中心、半径为 $r$ 的球壳内找到另一个原子的概率，相对于理想气体（完全无序分布）的归一化值。

*   **$g(r) = 0$**: 由于原子核斥力（泡利不相容原理和库仑斥力），在极短距离内不可能存在其他原子。
*   **$g(r) \to 1$**: 在长程极限下（$r \to \infty$），原子分布趋于均匀，关联消失。
*   **峰值特征**:
    *   **晶体**: 表现为一系列尖锐的、长程有序的峰。
    *   **液体/非晶**: 仅在短程（第一、第二配位层）有明显的峰，长程迅速衰减为 1。这是判断体系是否熔化或形成玻璃态的“金标准”。

### 1.1.2 配位数（Coordination Number, CN）
RDF 的另一个重要用途是计算配位数。通过对 $g(r)$ 的第一峰进行积分，我们可以得到中心原子周围第一近邻原子的平均数量 $N_{coord}$：

$$ N_{coord} = 4\pi \rho \int_{0}^{r_{min}} r^2 g(r) dr $$

其中 $\rho$ 是体系的数密度，$r_{min}$ 是第一峰后的第一个极小值位置。

---

## 1.2 扩散行为的表征——MSD

### 1.2.1 物理意义
均方差位移（Mean Squared Displacement, MSD）描述了粒子随时间推移偏离其初始位置的程度。其定义为：

$$ \text{MSD}(t) = \langle | \mathbf{r}(t) - \mathbf{r}(0) |^2 \rangle $$

### 1.2.2 时间演化规律
在 MD 模拟中，MSD 随时间的变化通常分为两个阶段：
1.  **弹道区 (Ballistic Regime)**: 在极短时间内（飞秒级），原子做惯性运动，$\text{MSD} \propto t^2$。
2.  **扩散区 (Diffusive Regime)**: 经过多次碰撞后，原子运动表现为随机行走，$\text{MSD} \propto t$。

### 1.2.3 爱因斯坦关系式 (Einstein Relation)
对于各向同性的三维液体，当系统进入扩散区后，MSD 的斜率与自扩散系数 $D$ 直接相关：

$$ D = \lim_{t \to \infty} \frac{1}{6t} \text{MSD}(t) $$

这意味着，我们需要通过线性拟合 MSD 曲线长时段的斜率来获取扩散系数。

---

## 1.3 ABACUS 实战工作流：从计算到分析

理解了物理概念后，我们需要将其落实到具体的 ABACUS 操作流程中。一个完整的动力学分析必须包含两个严格区分的阶段：**生产阶段**和**分析阶段**。

### 阶段一：生产阶段 (Production Run)

在这一阶段，ABACUS 负责求解牛顿运动方程并生成轨迹。为了后续能计算 RDF 和 MSD，必须确保轨迹文件包含足够的信息。

#### 关键 INPUT 参数设置

在 `INPUT` 文件中，除了常规的 DFT 参数（如 `ecutwfc`, `scf_thr`）外，动力学相关的设置至关重要：

```bash
INPUT_PARAMETERS
# ... (电子结构参数省略) ...

# 动力学控制参数
calculation     md          # 计算类型：分子动力学
md_type         nvt         # 系综类型：正则系综 (或 npt, nve)
md_nstep        10000       # 总步数：决定模拟总时长
md_dt           2.0         # 时间步长：单位 fs (通常设为 1.0~2.0)

# 关键：轨迹输出频率
md_dumpfreq     10          # 每 10 步输出一次结构到轨迹文件
md_restartfreq  1000        # 每 1000 步输出一次重启文件
```

> **参数详解：**
> *   **`md_dt`**: 时间步长。对于含氢体系通常取 0.5-1.0 fs，重原子体系可取 2.0-3.0 fs。
> *   **`md_dumpfreq` (至关重要)**: 此参数决定了轨迹文件（`MD_dump` 或类似文件）的时间分辨率。
>     *   如果设得太大（如 1000），MSD 曲线的点会非常稀疏，导致短时动力学特征丢失。
>     *   如果设得太小（如 1），轨迹文件会极其庞大，I/O 成为瓶颈。
>     *   **推荐值**: 通常 10 到 50 之间是较好的平衡。

---

### 阶段二：平衡性检查 (Pre-Analysis Check)

**这是新手最容易跳过的一步，也是导致结果错误的根源。**

在计算 RDF 或 MSD 之前，**必须**检查系统的能量和温度随时间的变化曲线。
*   **判据**: 能量和温度应在某个平均值附近波动，无明显的漂移（Drift）。
*   **操作**: 只有当系统达到热力学平衡后的轨迹，才有统计物理意义。平衡之前的过程称为“弛豫（Relaxation）”或“预平衡（Equilibration）”，这段数据必须剔除。

---

### 阶段三：分析阶段 (Analysis with Candela)

假设我们使用 **Candela**（一款常用于 ABACUS 后处理的工具）来分析轨迹。此阶段的核心是将 ABACUS 的原始轨迹转换为物理图谱。

#### 1. 剔除预平衡轨迹 (`geo_ignore`)
基于阶段二的检查，假设前 2000 步是弛豫过程，我们需要告诉分析程序跳过这些帧。

*   **Candela 参数**: `geo_ignore`
*   **作用**: 指定在计算 RDF/MSD 时忽略轨迹文件开头的前 N 帧。

> **风险提示**:
> Candela 文档中可能存在 `geo_1` (起始帧) 和 `geo_2` (结束帧) 参数。
> *   `geo_ignore` 通常用于逻辑上“跳过”不平衡的帧数。
> *   `geo_1`/`geo_2` 有时用于指定读取分段轨迹文件的**文件编号索引**（如果 ABACUS 输出了多个分段文件）。
> *   **建议**: 优先使用 `geo_ignore` 来去除弛豫部分。如果使用 `geo_1`，请务必确认其定义是“帧索引”还是“文件索引”。

#### 2. 正确设置时间基准 (`msd_dt`)

这是计算扩散系数最容易出错的地方。分析软件需要知道轨迹中两帧之间真实的物理时间间隔。

> **锦囊妙计：如何计算 `msd_dt`**
>
> Candela 中的 `msd_dt` 通常单位为 **皮秒 (ps)**，而 ABACUS 的 `md_dt` 单位为 **飞秒 (fs)**。
>
> 计算公式如下：
> $$ \text{msd\_dt (ps)} = \frac{\text{md\_dt (fs)} \times \text{md\_dumpfreq}}{1000} $$
>
> **示例**:
> 如果 ABACUS 设置 `md_dt = 2.0` 且 `md_dumpfreq = 10`：
> $$ \text{msd\_dt} = \frac{2.0 \times 10}{1000} = 0.02 \text{ ps} $$
>
> **后果**: 如果填错（例如填成 2.0），算出的扩散系数将会有几个数量级的误差！

### 总结
1.  **算什么**: RDF 看结构（有序/无序），MSD 看动力学（扩散快慢）。
2.  **怎么算**: ABACUS 跑轨迹 (`md_dumpfreq`) -> 检查平衡 -> Candela 分析 (`geo_ignore`, `msd_dt`)。

下一章，我们将进入具体的 ABACUS 输入文件构建环节，从零开始搭建一个液态金属的模拟案例。