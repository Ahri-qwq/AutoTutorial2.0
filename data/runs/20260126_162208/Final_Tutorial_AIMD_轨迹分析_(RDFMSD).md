# ABACUS 第一性原理分子动力学实战：从轨迹生产到性质分析全流程指南

## 前言

欢迎开启 ABACUS 第一性原理分子动力学（AIMD）的学习之旅。在计算材料学领域，ABACUS 作为一款优秀的国产密度泛函理论（DFT）软件，凭借其高效的数值原子轨道基组和良好的并行扩展性，已成为研究大规模体系动力学行为的利器。相比于传统的静态计算，AIMD 能够捕捉原子在有限温度下的瞬时运动，是研究液态结构、离子输运及相变过程的关键手段。

**本书路线图**
为了帮助读者跨越从“运行软件”到“发表论文”之间的鸿沟，本书构建了完整的学习闭环：
1.  **物理图景（第1章）**：明确 RDF 和 MSD 等核心物理量的定义，建立分析目标。
2.  **生产运行（第2章）**：深入 ABACUS 的 `INPUT` 参数设置，掌握不同系综（NVE/NVT）与热库（Langevin/Berendsen 等）的选择。
3.  **质量控制（第3章）**：践行“Garbage In, Garbage Out”原则，学习如何判别平衡态与数据清洗。
4.  **标准化分析（第4-5章）**：利用 Candela 工具高效提取 RDF 和 MSD 等关键指标。
5.  **进阶定制（第6章）**：通过 Python 与 MDTraj 扩展分析边界，实现出版级绘图。

**知识体系定位**
本教程位于 ABACUS 知识体系的高阶应用模块。在掌握了基础的结构弛豫（Relax）和静态自洽计算（SCF）后，分子动力学是通往复杂真实体系模拟的必经之路。它不仅是对 DFT 能量与受力计算的动态延伸，更是连接微观电子结构与宏观热力学性质的桥梁。

**前置知识要求**
在开始本教程前，建议读者已具备：
- 基础的 Linux 命令行操作能力。
- ABACUS 的基本使用经验（熟悉 `INPUT`、`STRU`、`KPT` 文件格式）。
- 大学物理化学或统计力学的基础知识。

---

# 第一章：物理基础与分析目标

在启动 ABACUS 进行昂贵的分子动力学（MD）计算之前，我们必须建立清晰的物理图像：我们到底在算什么？对于液态、非晶或高温固态体系，**结构有序性**和**原子扩散行为**是两个最核心的描述符。

本章将从物理原理出发，明确径向分布函数（RDF）和均方差位移（MSD）的定义，并深入讲解如何在 ABACUS 的生产运行（Production Run）与后续分析（Analysis）中正确设置关键参数。

---

## 1.1 结构有序性的度量——RDF

### 1.1.1 物理意义
径向分布函数（Radial Distribution Function, RDF），通常记为 $g(r)$，描述了在以任意原子为中心、半径为 $r$ 的球壳内找到另一个原子的概率，相对于理想气体（完全无序分布）的归一化值。

*   **$g(r) = 0$**: 由于原子核斥力（泡利不相容原理和库仑斥力），在极短距离内不可能存在其他原子。
*   **$g(r) \to 1$**: 在长程极限下（$r \to \infty$），原子分布趋于均匀，关联消失。
*   **峰值特征**:
    *   **晶体**: 表现为一系列尖锐的、长程有序的峰。
    *   **液体/非晶**: 仅在短程（第一、第二配位层）有明显的峰，长程迅速衰减为 1。这是判断体系是否熔化或形成玻璃态的“金标准”。

### 1.1.2 配位数（Coordination Number, CN）
RDF 的另一个重要用途是计算配位数。通过对 $g(r)$ 的第一峰进行积分，我们可以得到中心原子周围第一近邻原子的平均数量 $N_{coord}$：

$$ N_{coord} = 4\pi \rho \int_{0}^{r_{min}} r^2 g(r) dr $$

其中 $\rho$ 是体系的数密度，$r_{min}$ 是第一峰后的第一个极小值位置。

---

## 1.2 扩散行为的表征——MSD

### 1.2.1 物理意义
均方差位移（Mean Squared Displacement, MSD）描述了粒子随时间推移偏离其初始位置的程度。其定义为：

$$ \text{MSD}(t) = \langle | \mathbf{r}(t) - \mathbf{r}(0) |^2 \rangle $$

### 1.2.2 时间演化规律
在 MD 模拟中，MSD 随时间的变化通常分为两个阶段：
1.  **弹道区 (Ballistic Regime)**: 在极短时间内（飞秒级），原子做惯性运动，$\text{MSD} \propto t^2$。
2.  **扩散区 (Diffusive Regime)**: 经过多次碰撞后，原子运动表现为随机行走，$\text{MSD} \propto t$。

### 1.2.3 爱因斯坦关系式 (Einstein Relation)
对于各向同性的三维液体，当系统进入扩散区后，MSD 的斜率与自扩散系数 $D$ 直接相关：

$$ D = \lim_{t \to \infty} \frac{1}{6t} \text{MSD}(t) $$

这意味着，我们需要通过线性拟合 MSD 曲线长时段的斜率来获取扩散系数。

---

## 1.3 ABACUS 实战工作流：从计算到分析

理解了物理概念后，我们需要将其落实到具体的 ABACUS 操作流程中。一个完整的动力学分析必须包含两个严格区分的阶段：**生产阶段**和**分析阶段**。

### 阶段一：生产阶段 (Production Run)

在这一阶段，ABACUS 负责求解牛顿运动方程并生成轨迹。为了后续能计算 RDF 和 MSD，必须确保轨迹文件包含足够的信息。

#### 关键 INPUT 参数设置

在 `INPUT` 文件中，除了常规的 DFT 参数（如 `ecutwfc`, `scf_thr`）外，动力学相关的设置至关重要：

```bash
INPUT_PARAMETERS
# ... (电子结构参数省略) ...

# 动力学控制参数
calculation     md          # 计算类型：分子动力学
md_type         nvt         # 系综类型：正则系综 (或 npt, nve)
md_nstep        10000       # 总步数：决定模拟总时长
md_dt           2.0         # 时间步长：单位 fs (通常设为 1.0~2.0)

# 关键：轨迹输出频率
md_dumpfreq     10          # 每 10 步输出一次结构到轨迹文件
md_restartfreq  1000        # 每 1000 步输出一次重启文件
```

> **参数详解：**
> *   **`md_dt`**: 时间步长。对于含氢体系通常取 0.5-1.0 fs，重原子体系可取 2.0-3.0 fs。
> *   **`md_dumpfreq` (至关重要)**: 此参数决定了轨迹文件（`MD_dump` 或类似文件）的时间分辨率。
>     *   如果设得太大（如 1000），MSD 曲线的点会非常稀疏，导致短时动力学特征丢失。
>     *   如果设得太小（如 1），轨迹文件会极其庞大，I/O 成为瓶颈。
>     *   **推荐值**: 通常 10 到 50 之间是较好的平衡。

---

### 阶段二：平衡性检查 (Pre-Analysis Check)

**这是新手最容易跳过的一步，也是导致结果错误的根源。**

在计算 RDF 或 MSD 之前，**必须**检查系统的能量和温度随时间的变化曲线。
*   **判据**: 能量和温度应在某个平均值附近波动，无明显的漂移（Drift）。
*   **操作**: 只有当系统达到热力学平衡后的轨迹，才有统计物理意义。平衡之前的过程称为“弛豫（Relaxation）”或“预平衡（Equilibration）”，这段数据必须剔除。

---

### 阶段三：分析阶段 (Analysis with Candela)

假设我们使用 **Candela**（一款常用于 ABACUS 后处理的工具）来分析轨迹。此阶段的核心是将 ABACUS 的原始轨迹转换为物理图谱。

#### 1. 剔除预平衡轨迹 (`geo_ignore`)
基于阶段二的检查，假设前 2000 步是弛豫过程，我们需要告诉分析程序跳过这些帧。

*   **Candela 参数**: `geo_ignore`
*   **作用**: 指定在计算 RDF/MSD 时忽略轨迹文件开头的前 N 帧。

> **风险提示**:
> Candela 文档中可能存在 `geo_1` (起始帧) 和 `geo_2` (结束帧) 参数。
> *   `geo_ignore` 通常用于逻辑上“跳过”不平衡的帧数。
> *   `geo_1`/`geo_2` 有时用于指定读取分段轨迹文件的**文件编号索引**（如果 ABACUS 输出了多个分段文件）。
> *   **建议**: 优先使用 `geo_ignore` 来去除弛豫部分。如果使用 `geo_1`，请务必确认其定义是“帧索引”还是“文件索引”。

#### 2. 正确设置时间基准 (`msd_dt`)

这是计算扩散系数最容易出错的地方。分析软件需要知道轨迹中两帧之间真实的物理时间间隔。

> **锦囊妙计：如何计算 `msd_dt`**
>
> Candela 中的 `msd_dt` 通常单位为 **皮秒 (ps)**，而 ABACUS 的 `md_dt` 单位为 **飞秒 (fs)**。
>
> 计算公式如下：
> $$ \text{msd\_dt (ps)} = \frac{\text{md\_dt (fs)} \times \text{md\_dumpfreq}}{1000} $$
>
> **示例**:
> 如果 ABACUS 设置 `md_dt = 2.0` 且 `md_dumpfreq = 10`：
> $$ \text{msd\_dt} = \frac{2.0 \times 10}{1000} = 0.02 \text{ ps} $$
>
> **后果**: 如果填错（例如填成 2.0），算出的扩散系数将会有几个数量级的误差！

### 总结
1.  **算什么**: RDF 看结构（有序/无序），MSD 看动力学（扩散快慢）。
2.  **怎么算**: ABACUS 跑轨迹 (`md_dumpfreq`) -> 检查平衡 -> Candela 分析 (`geo_ignore`, `msd_dt`)。

下一章，我们将进入具体的 ABACUS 输入文件构建环节，从零开始搭建一个液态金属的模拟案例。

# 第二章：AIMD 轨迹生产 (ABACUS)

在第一章完成了结构弛豫与静态计算的准备后，本章我们将正式进入从头算分子动力学（Ab Initio Molecular Dynamics, AIMD）的实战环节。

**本章核心逻辑**：高质量的分析始于正确的模拟。AIMD 计算极其昂贵，错误的参数设置不仅浪费机时，更会导致产生的轨迹无法用于后续的扩散系数（Diffusivity）或径向分布函数（RDF）分析。本章将聚焦于如何在 ABACUS 中设置 MD 参数，特别是如何平衡“采样精度”与“存储开销”。

---

## 2.1 基础 MD 参数设置

在 ABACUS 的 `INPUT` 文件中，通过修改 `calculation` 参数即可将任务模式从自洽场计算（scf）或结构优化（relax）切换为分子动力学（md）。

### 2.1.1 核心参数概览

以下是一个标准的 NVT 系综 AIMD `INPUT` 参数块示例：

```bash
INPUT_PARAMETERS
# -------------------------------------------
# 1. 基础计算模式
# -------------------------------------------
calculation     md          # 开启分子动力学模式
esolver_type    ksdft       # 使用 Kohn-Sham DFT 求解器

# -------------------------------------------
# 2. MD 系综与热浴设置
# -------------------------------------------
md_type         nvt         # 系综类型: nvt (恒温), nve (恒能量)
md_thermostat   nhc         # 热浴算法: nhc (Nose-Hoover Chain), andersen 等
md_tfirst       300         # 初始温度 (K)
md_tlast        300         # 目标温度 (K)

# -------------------------------------------
# 3. 时间步长与总步数
# -------------------------------------------
md_dt           1.0         # 时间步长 (fs)，推荐 0.5-2.0
md_nstep        10000       # 总模拟步数
```

### 2.1.2 参数详解与实战建议

1.  **`md_dt` (时间步长)**：
    *   **物理含义**：积分运动方程的时间间隔。
    *   **推荐值**：通常设为 **1.0 fs** 或 **2.0 fs**。
    *   **教授建议**：如果体系中包含轻元素（如氢 H, 锂 Li），原子振动频率高，建议使用较小的步长（如 0.5 - 1.0 fs）以保证能量守恒；对于重原子体系，可适当放宽至 2.0 fs。过大的步长会导致积分误差，使系统能量漂移（Energy Drift）。

2.  **`md_nstep` (总步数)**：
    *   **物理含义**：模拟的总时长 = `md_nstep` $\times$ `md_dt`。
    *   **实战策略**：
        *   **平衡期 (Equilibration)**：通常需要 1000~3000 步让体系从初始结构达到设定温度并稳定。
        *   **生产期 (Production)**：用于统计分析的轨迹。对于扩散系数计算，通常需要至少 5 ps ~ 20 ps（即 5000 ~ 20000 步）以上的有效数据，具体取决于扩散速率。

---

## 2.2 关键采样策略：输出频率控制

这是新手最容易忽视，却对后续分析至关重要的部分。我们不能保存每一步的波函数和电荷密度（太慢且太占空间），甚至不需要保存每一步的原子坐标。

### 2.2.1 轨迹输出频率 (`md_dumpfreq`)

*   **参数名**：`md_dumpfreq`
*   **默认值**：1 (即每步都输出)
*   **推荐设置**：**5 ~ 10**

**物理权衡**：
*   **过稀疏采样 (如 > 50)**：虽然节省了硬盘空间，但丢失了原子运动的高频信息。在计算均方位移（MSD）时，如果数据点太少，拟合出的扩散系数误差极大。
*   **过密集采样 (如 1)**：对于数万步的 AIMD，会生成巨大的 `MD_dump` 文件，导致后续分析工具（如 Candela 或 Ovito）读取缓慢甚至内存溢出。

### 2.2.2 断点续算频率 (`md_restartfreq`)

*   **参数名**：`md_restartfreq`
*   **推荐设置**：**1000**
*   **作用**：每隔多少步输出一次重启文件（包含波函数和电荷密度）。AIMD 计算周期长，极易因断电或超时中断。设置合理的 `md_restartfreq` 可以让你从最近的断点继续计算，而不是从头开始。

### 2.2.3 完整的 INPUT 推荐配置

针对一个需要运行 20 ps 的生产任务，建议配置如下：

```bash
# INPUT 文件片段
md_dt           2.0         # 2 fs 步长
md_nstep        10000       # 总时长 20 ps
md_dumpfreq     10          # 每 20 fs (2.0 * 10) 记录一次坐标
md_restartfreq  1000        # 每 2 ps 备份一次波函数
```

---

## 2.3 分析前的关键检查与准备

在将 ABACUS 产生的轨迹（通常位于 `OUT.suffix/MD_dump` 或 `MOVEMENT` 文件中）导入分析工具（如 Candela）之前，必须进行以下检查。

### 2.3.1 检查平衡性 (Equilibrium Check)

**切勿直接分析全段轨迹！**
AIMD 的初始阶段，体系温度会剧烈震荡，能量在通过恒温器调整。这段“平衡期”的数据**必须**在分析时剔除，否则会严重污染统计结果。

*   **操作**：绘制 `OUT.suffix/running_md.log` 中的温度（Temperature）和势能（Potential Energy）随步数变化的曲线。
*   **判据**：当温度在设定值附近波动且无明显漂移，势能也趋于收敛时，体系才算达到平衡。

### 2.3.2 衔接分析工具：Candela 参数预设

在后续使用 Candela 进行分析时，我们需要根据 ABACUS 的 `INPUT` 设置来调整分析参数。这里有一个极易出错的换算关系。

#### 锦囊妙计：MSD 时间步长换算

在 Candela 或其他分析软件中计算 MSD 时，软件通常需要知道“两帧轨迹之间的时间间隔”（我们记为 `msd_dt`）。

> **公式**：
> $$ \text{Analysis\_dt (ps)} = \frac{\text{md\_dt (fs)} \times \text{md\_dumpfreq}}{1000} $$

**实战示例**：
如果你在 ABACUS `INPUT` 中设置了：
*   `md_dt = 2.0` (fs)
*   `md_dumpfreq = 10`

那么，你的轨迹文件中，每两帧之间实际跨越了 20 fs。
在 Candela 的配置文件中，你必须设置：
*   `msd_dt = 0.02` (ps)

**警告**：如果这里填错（例如填成了 2.0），计算出的扩散系数将产生 100 倍的错误！

#### 风险提示：关于轨迹去除 (`geo_ignore`)

在分析阶段，我们通常使用 `geo_ignore` 参数来去除平衡期的数据。

*   **ABACUS 生产阶段**：我们倾向于连续跑完平衡和生产过程（或者分段续算）。
*   **Candela 分析阶段**：
    *   `geo_ignore`: 设置为忽略前 N 帧。例如，如果前 2000 步是平衡期，且 `md_dumpfreq=10`，则前 200 帧数据应被忽略，设置 `geo_ignore = 200`。
    *   **易混淆点**：注意区分 `geo_ignore`（跳过帧数）与 `geo_1`/`geo_2`（指定读取的文件索引范围）。通常对于单次完整的 MD 任务，使用 `geo_ignore` 剔除未平衡轨迹是最标准的做法。

---

**本章小结**：
本章我们完成了 AIMD 的核心参数配置。你已经学会了如何开启 MD 模式，设置合理的时间步长，并利用 `md_dumpfreq` 平衡数据精度与存储压力。下一章，我们将进入**分析阶段**，使用 Candela 读取这些轨迹并计算扩散性质。

# 第三章：预分析与质量控制 (Quality Control)

在上一章中，我们成功运行了 ABACUS 的分子动力学（MD）模拟。看着输出文件夹里不断增加的 `STRU` 文件，你可能迫不及待地想计算径向分布函数（RDF）或均方位移（MSD）。

**请停下来。**

计算材料学界有一句名言：“**Garbage In, Garbage Out**”。如果你的轨迹数据包含未弛豫的非平衡态结构，或者时间步长换算错误，那么后续所有的分析结果都将是错误的。

本章将带你完成从“生产运行”到“数据清洗”的关键步骤。我们将学习如何判断体系是否达到热力学平衡，以及如何在分析工具 Candela 中正确截断“垃圾数据”。

---

## 3.0 生产阶段：确保有数据可分析 (Production Run)

在进入分析之前，我们必须回顾一下 ABACUS 的 `INPUT` 文件设置。很多初学者在分析阶段遇到困难，往往是因为生产阶段的参数设置不当。

### 关键参数：`md_dumpfreq`
在 ABACUS 进行 AIMD 生产运行时，`md_dumpfreq` 决定了轨迹文件的输出频率。

*   **如果设为 1 (默认)**：每一步都输出结构。对于长轨迹，这会产生巨大的 I/O 开销和硬盘占用。
*   **如果设太大 (如 1000)**：采样点太稀疏，导致 MSD 曲线不够平滑，统计误差大。

**推荐设置**：
```bash
# INPUT 文件片段
calculation     md
md_type         nvt      # 或 nve, npt
md_nstep        10000    # 总步数
md_dt           1.0      # 时间步长 (fs)
md_dumpfreq     10       # 每 10 步输出一帧结构
```

> **注意**：请记住这里的 `md_dt` (1.0 fs) 和 `md_dumpfreq` (10)，它们是后续设置分析参数的基石。

---

## 3.1 热力学平衡判定

拿到轨迹后的第一件事，**绝对不是**直接扔进分析软件，而是绘制能量和温度随时间的变化曲线。

### 为什么需要判定平衡？
MD 模拟通常从一个静态结构（如晶体或随机堆积）开始。在模拟的初期，体系会经历一个剧烈的**弛豫过程（Relaxation）**，此时的结构、压力和能量都在快速漂移，不代表体系在目标温度下的真实状态。这段时间的数据必须被剔除。

### 如何判定？
你需要提取 ABACUS 输出目录（通常为 `OUT.suffix`）中的能量信息。

1.  **查看日志文件**：
    通常信息位于 `OUT.suffix/running_md.log` (或 `running_scf.log`) 中。关注 `E_Fermi`, `E_KohnSham`, `Kinetic Energy`, `Temperature` 等关键词。

2.  **判定标准**：
    *   **温度 (Temperature)**：在设定温度（如 300 K）上下波动，且没有明显的长期上升或下降趋势。
    *   **势能 (Potential Energy)**：能量应在一个常数值附近波动（Fluctuation）。如果能量还在持续下降，说明体系仍在寻找稳态，尚未平衡。

### 实战操作
你可以使用简单的 `grep` 命令提取数据并绘图（使用 Python 或 Gnuplot）：

```bash
# 提取温度 (假设在 OUT.ABACUS/running_md.log 中)
grep "Temperature" OUT.ABACUS/running_md.log | awk '{print $2}' > temp.dat

# 提取总能
grep "total energy" OUT.ABACUS/running_md.log | awk '{print $NF}' > etot.dat
```

**观察结论**：
*   如果前 1000 步温度剧烈震荡，从第 1001 步开始稳定在 300K ± 20K，那么**前 1000 步就是必须被截断的“预平衡期”**。

---

## 3.2 轨迹截断与 Candela 设置

确认了平衡点后，我们进入分析阶段。我们将使用 **Candela** (一款高效的 MD 后处理工具) 来读取 ABACUS 的轨迹。

### 核心策略：平衡期截断 (Burn-in Truncation)

假设你的总步数 (`md_nstep`) 为 10000，`md_dumpfreq` 为 10，那么你总共拥有 1000 帧结构。
根据 3.1 节的分析，体系在第 2 ps（即第 2000 步，对应第 200 帧）达到平衡。

我们需要告诉 Candela：**忽略前 200 帧**。

### Candela 参数详解

在 Candela 的配置文件（通常是 `.toml` 或 Python 脚本）中，有几个极易混淆的参数用于控制读取范围。

#### 1. `geo_ignore`: 忽略初始帧（**最常用**）
这是实现平衡期截断的标准参数。它表示在读取轨迹时，跳过开头的多少帧。

*   **物理含义**：剔除未弛豫的非平衡态数据。
*   **设置示例**：如果前 200 帧未平衡，则设置 `geo_ignore = 200`。

#### 2. `geo_1` 和 `geo_2`: 文件索引范围（**风险提示**）
ABACUS 在长时间模拟时，可能会将轨迹拆分为多个文件（取决于版本和设置）。
*   `geo_1`: 起始文件索引。
*   `geo_2`: 结束文件索引。
*   **区别**：`geo_ignore` 是丢弃帧数（Frame），而 `geo_1/2` 是选择读取哪些文件（File）。通常情况下，我们读取所有文件，但丢弃第一个文件中的前几百帧，因此主要使用 `geo_ignore`。

---

## 3.3 锦囊妙计：MSD 时间步长的正确换算

这是新手在计算扩散系数（Diffusion Coefficient）时最容易犯错的地方，直接导致结果差 1000 倍甚至更多。

### 问题背景
ABACUS 的 `md_dt` 单位是 **飞秒 (fs)**。
Candela (以及大多数分析软件) 计算 MSD 时，需要知道两帧之间的时间间隔，通常单位要求为 **皮秒 (ps)**。

### 计算公式
你需要设置 Candela 中的 `msd_dt` 参数。

$$ \text{msd\_dt (ps)} = \frac{\text{md\_dt (fs)} \times \text{md\_dumpfreq}}{1000} $$

### 示例
*   **ABACUS 设置**:
    *   `md_dt = 2.0` (fs)
    *   `md_dumpfreq = 10` (每 10 步存一次)
*   **物理间隔**: 实际上每 $2.0 \times 10 = 20$ fs 存储一帧。
*   **Candela 设置**:
    *   `msd_dt = 0.02` (ps)

**代码示例 (Candela 配置)**：

```toml
[input]
# 假设 ABACUS 输出了 STRU_MD_0, STRU_MD_1...
fmt = "abacus"
path = "./OUT.ABACUS"

# 质量控制：截断前 200 帧不平衡轨迹
geo_ignore = 200  

[calc]
# 必须开启 MSD 计算
do_msd = true

# 关键：时间步长换算 (2.0 fs * 10 / 1000)
msd_dt = 0.02 

# 平滑处理
msd_smooth = true
```

---

## 本章总结

1.  **先检查，后分析**：拿到轨迹先画温度/能量曲线，确认体系已达到热力学平衡。
2.  **舍得丢弃**：未平衡的轨迹是噪声，必须通过 `geo_ignore` 剔除。
3.  **算对时间**：严格按照公式 $\text{md\_dt} \times \text{dumpfreq} / 1000$ 设置分析软件的时间步长。

做好了这些质量控制，你的 RDF 和 MSD 曲线才具有物理意义。下一章，我们将正式进入**结构特性分析**，解读径向分布函数背后的微观结构。

# 第四章：结构分析实战 (Candela RDF)

在完成了分子动力学（MD）模拟的“跑分”环节后，我们面对的是海量的原子轨迹数据。如何从这些看似杂乱无章的原子运动中提取出有序的物理规律？这就是后处理（Post-processing）的核心任务。

本章我们将使用 **Candela** 工具进行结构分析。Candela 是专为大规模原子模拟设计的分析工具集，能够高效处理 ABACUS 的输出轨迹。我们将以最基础也最重要的**径向分布函数（RDF）**为例，打通从“生产”到“分析”的全流程。

---

## 4.1 生产与准备：从 ABACUS 到 Candela

很多初学者容易犯的一个错误是：直接拿跑完的 MD 轨迹去计算性质，而忽略了数据的有效性和采样频率。为了确保分析结果的物理意义，我们必须严格遵守 **“生产-检查-分析”** 的三步走流程。

### 第一阶段：生产运行 (Production Run)

在 ABACUS 的 `INPUT` 文件中，有两个参数直接决定了你是否有“粮”可分析。如果设置不当，后续 Candela 将无数据可读。

**ABACUS `INPUT` 关键设置：**

```bash
# ABACUS INPUT file snippet
calculation     md
md_nstep        10000    # 总步数
md_dt           1.0      # 时间步长 (fs)

# --- 关键参数 ---
md_dumpfreq     10       # 轨迹输出频率 (每10步输出一帧)
# ----------------
```

*   **`md_dumpfreq`**: 这是重中之重。如果设为 0 或过大，你将无法获得足够的轨迹帧用于统计。
    *   **推荐值**: 对于 RDF 计算，通常每 10~100 步输出一帧即可。过密会浪费磁盘空间，过疏会导致采样不足。

### 第二阶段：平衡性检查 (Equilibrium Check)

**在运行 Candela 之前，必须进行平衡性检查！**
MD 模拟的前半段通常是系统从初始结构向平衡态弛豫的过程（Equilibration），这段数据**必须被剔除**，否则会污染统计结果。

1.  **检查能量/温度曲线**: 使用 Python 脚本或 Gnuplot 绘制 `OUT.suffix/running_md.log` 中的温度和能量随时间的变化。
2.  **确定截断点**: 找到系统能量和温度开始在均值附近波动的时刻。假设系统在第 2000 步（即第 200 帧，如果 `md_dumpfreq=10`）达到平衡，那么前 200 帧数据必须丢弃。

### 第三阶段：Candela 输入文件配置

进入分析阶段，我们需要配置 Candela 的 `INPUT` 文件。假设你的 ABACUS 输出目录为 `OUT.ABACUS/MD_dump`。

**Candela `INPUT` 示例 (计算 RDF):**

```bash
calculation     pdf            # 计算径向分布函数 (RDF)
geo_in_type     ABACUS         # 指定读取 ABACUS 格式轨迹
geo_directory   ../OUT.ABACUS/MD_dump  # 轨迹文件所在路径

# --- 轨迹筛选与截断 (核心) ---
geo_1           0              # 起始文件索引
geo_2           1000           # 结束文件索引
geo_interval    1              # 读取间隔 (每隔多少个文件读一次)
geo_ignore      200            # 【高亮】忽略前200帧 (平衡期)

# --- RDF 物理参数 ---
rcut            8.0            # 截断半径 (Angstrom)
dr              0.05           # 直方图的分辨率 (Angstrom)

# --- 体系信息 ---
ntype           1              # 元素种类数量
natom           64             # 总原子数
```

#### 关键参数详解

1.  **`calculation pdf`**:
    *   虽然我们要算的是 RDF (Radial Distribution Function)，但在 Candela 中对应的指令通常是 `pdf` (Pair Distribution Function)。
2.  **`geo_ignore` (风险控制)**:
    *   **作用**: 忽略轨迹开头的不平衡帧数。
    *   **设置原则**: 对应上文“平衡性检查”中确定的步数。如果你的系统需要很长时间平衡，务必增大此值。
3.  **`geo_1` / `geo_2` vs `geo_ignore` (易混淆警告)**:
    *   ABACUS 的 `MD_dump` 目录下通常包含一系列文件（如 `STRU_TRAJ_0`, `STRU_TRAJ_1`...）。
    *   **`geo_1` / `geo_2`**: 指定要读取的**文件编号范围**。例如 `geo_1 0` 和 `geo_2 1000` 表示读取从 0 号到 1000 号文件。
    *   **`geo_ignore`**: 指定在读取到的数据中，**跳过前多少帧**。
    *   **逻辑关系**: Candela 会先根据 `geo_1/2` 加载文件，然后从加载的数据流中切掉前 `geo_ignore` 帧。
4.  **`rcut`**:
    *   RDF 的计算范围。通常取晶胞最短边长的一半，或者足以覆盖前几个配位壳层即可（如 8-10 Å）。

---

> **💡 锦囊妙计：关于时间步长的换算 (MSD 预警)**
>
> 虽然本章主讲 RDF，但在配置 Candela 时，新手极易在后续计算 MSD（均方位移）时搞错时间单位。请牢记以下换算逻辑：
>
> Candela 中的 `msd_dt` (ps) 并不等于 ABACUS 的 `md_dt` (fs)。
>
> **计算公式**：
> $$ \text{msd\_dt (ps)} = \frac{\text{ABACUS md\_dt (fs)} \times \text{ABACUS md\_dumpfreq}}{1000} $$
>
> **示例**：
> *   ABACUS 设置: `md_dt = 2.0` (fs), `md_dumpfreq = 10`
> *   Candela 设置: `msd_dt = 0.02` (ps)
>
> *如果不进行此换算，计算出的扩散系数将会有数量级的错误！*

---

## 4.2 多组分体系的 RDF 挑战

对于单质（如纯铝），RDF 只有一条曲线。但对于多组分体系（如 $SiO_2$ 或 $Li_{10}GeP_{2}S_{12}$），我们需要区分不同元素对之间的关联（如 Si-O 键长，或 Li-Li 扩散通道）。

### 输入文件调整

在多组分体系中，`INPUT` 文件需要准确描述原子类型：

```bash
# 针对 SiO2 体系 (假设总原子数 96, 32个Si, 64个O)
calculation     pdf
geo_in_type     ABACUS
# ... (路径设置同上) ...

ntype           2              # 两种元素
natom           96             # 总原子数

# 注意：Candela 通常会自动识别 STRU 中的原子顺序
# 确保 ABACUS 的 STRU 文件中原子按类型分组排列
```

### 结果分析

运行 Candela 后，输出文件通常会包含多列数据或生成多个文件。对于双组分体系（Type 1 和 Type 2），你通常会得到以下几类 RDF：

1.  **1-1 (e.g., Si-Si)**: 描述同类原子的长程有序性。
2.  **1-2 (e.g., Si-O)**: **最重要**。第一峰的位置对应键长，第一峰的积分（Coordination Number, CN）对应配位数。
3.  **2-2 (e.g., O-O)**: 描述阴离子骨架。

**实战技巧**：
*   **配位数计算**: Candela 输出文件的第三列通常是积分值 $N(r)$。
*   要获得 Si 原子的氧配位数，需查看 **Si-O (1-2)** 的 RDF 曲线。
*   读取 RDF 第一极小值处对应的积分值，即为第一配位层的平均配位数。

### 常见报错排除

*   **Error: `box size is too small`**: 你的 `rcut` 设置超过了模拟盒子的一半。请减小 `rcut`。
*   **Error: `segmentation fault`**: 检查 `natom` 是否与轨迹文件中的实际原子数一致，或者 `geo_directory` 路径是否为空。

# 第五章：动力学分析实战 (Candela MSD)

在计算材料学中，均方位移（Mean Square Displacement, MSD）是评估原子扩散能力、离子电导率的核心指标，尤其在固态电池电解质和超离子导体的研究中至关重要。

本章将带你完成从 ABACUS 分子动力学（MD）模拟到使用 Candela 进行 MSD 分析的全流程。我们将重点解决新手最容易“翻车”的痛点：**时间单位换算**与**平衡态截取**。

---

## 5.1 第一阶段：生产运行 (Production Run)

在使用 Candela 分析之前，必须先使用 ABACUS 产生高质量的 MD 轨迹。很多初学者在这一步设置不当，导致后续分析时数据点过少或文件过大。

### 5.1.1 关键 INPUT 参数设置

在 ABACUS 的 `INPUT` 文件中，除了常规的 DFT 参数外，以下 MD 参数直接决定了后续 MSD 分析的有效性：

```bash
INPUT_PARAMETERS
# ... (常规电子步参数) ...

# --- MD 核心参数 ---
calculation     md              # 计算类型：分子动力学
md_type         nvt             # 系综：通常先 NPT 平衡晶格，再 NVT 采样
md_nstep        20000           # 总步数：需保证总时长足够覆盖扩散事件
md_dt           2.0             # [关键] 时间步长，单位：fs (飞秒)

# --- 轨迹输出控制 ---
md_dumpfreq     10              # [关键] 采样频率：每 10 步输出一次结构
out_stru        1               # 必须开启，否则没有 STRU_MD 文件夹
cal_force       1               # 动力学计算必须算力
cal_stress      1               # 建议开启，用于监控压强平衡
```

### 5.1.2 避坑指南：采样频率 (`md_dumpfreq`)
*   **误区**：设置 `md_dumpfreq = 1`。
    *   **后果**：输出文件极其庞大，I/O 成为瓶颈，且相邻两帧原子位移极小，全是热振动噪声，对长时扩散分析无益。
*   **建议**：通常设置 `md_dumpfreq` 使得每帧间隔为 10~100 fs。
    *   例如：`md_dt = 2.0` fs，`md_dumpfreq = 10`，则每 20 fs 记录一帧。

---

## 5.2 第二阶段：平衡性检查 (Pre-Analysis Check)

**这是最容易被忽略的一步。** 在运行 Candela 之前，必须确认系统已经达到热力学平衡。

### 5.2.1 能量与温度诊断
检查 ABACUS 输出目录（如 `OUT.suffix/`）下的日志文件或能量文件。绘制 **温度 (Temperature)** 和 **势能 (Potential Energy)** 随时间的变化曲线。

*   **判据**：曲线应在某个平均值附近波动，无明显的漂移（Drift）。
*   **操作**：如果前 5000 步温度还在剧烈震荡或能量在持续下降，说明系统处于**弛豫期**。这段轨迹**绝对不能**用于计算扩散系数，否则结果会严重偏大。

---

## 5.3 第三阶段：Candela 参数配置与单位陷阱

Candela 是一个独立的后处理工具。我们需要编写一个 `INPUT.txt` (文件名可自定义) 来告诉 Candela 如何读取 ABACUS 的轨迹。

### 5.3.1 核心配置文件示例

假设 ABACUS 的输出目录为 `OUT.ABACUS/`，我们需要计算 MSD：

```bash
# Candela INPUT.txt 示例
calculation     msd             # 计算任务：均方位移
geo_in_type     ABACUS          # 轨迹来源格式

# --- 路径设置 ---
geo_directory   ./OUT.ABACUS    # ABACUS 输出文件夹路径

# --- [难点] 时间单位换算 ---
msd_dt          0.02            # 轨迹帧间隔时间，单位：ps (皮秒)

# --- [重点] 平衡态截取 ---
geo_ignore      500             # 忽略轨迹开头的前 500 帧 (非步数!)

# --- 原子选择 ---
msd_n_type      1               # 需要分析的元素种类数量
msd_type        Li              # 分析锂离子的扩散
msd_natom       16              # 该元素在系统中的原子总数
```

### 5.3.2 锦囊妙计：MSD 时间步长换算公式

这是本章的核心难点。ABACUS 使用 **fs**，而 Candela 的 `msd_dt` 通常需要 **ps**（用于后续计算扩散系数 $D$ 的单位）。

**计算公式：**
$$ \text{msd\_dt (ps)} = \frac{\text{md\_dt (fs)} \times \text{md\_dumpfreq}}{1000} $$

**实战演练：**
> 如果你在 ABACUS `INPUT` 中设置：
> *   `md_dt = 2.0` (fs)
> *   `md_dumpfreq = 10`
>
> 那么，你的轨迹文件中，两帧之间的时间间隔是 20 fs。
> 在 Candela 中，你应该设置：
> *   `msd_dt = 2.0 * 10 / 1000 = 0.02` (ps)

**风险提示**：如果此处填错，算出的扩散系数将会有数量级的错误！

### 5.3.3 参数辨析：`geo_ignore` vs `geo_1/2`

在查阅资料时，你可能会看到 `geo_1` 和 `geo_2` 参数。请务必区分它们的用途：

*   **`geo_ignore` (推荐)**: **跳过帧数**。用于去除 MD 轨迹前段未平衡的“预热”数据。例如 `geo_ignore 500` 表示跳过前 500 帧，从第 501 帧开始分析。这是处理单一长轨迹的标准操作。
*   **`geo_1` / `geo_2`**: **文件索引范围**。当 ABACUS 运行时间极长，输出被分割为多个文件（如 `STRU_MD_DIR/1/`, `STRU_MD_DIR/2/`...）时，这两个参数用于指定读取哪几个文件夹。对于大多数单次运行的任务，通常不需要设置。

---

## 5.4 第四阶段：结果解读与扩散系数计算

运行 Candela 后（通常命令为 `./candela INPUT.txt`），会生成 `MSD_total.txt` 等文件。

### 5.4.1 识别 MSD 曲线的三大区域

将 `MSD_total.txt` 的第一列（时间，ps）和第二列（MSD，$\AA^2$）作图，通常会看到以下趋势：

1.  **弹道输运区 (Ballistic Regime)**:
    *   **特征**：时间极短（< 0.1 ps），MSD $\propto t^2$。
    *   **物理意义**：原子在局部势阱内自由运动，尚未发生碰撞。
    *   **处理**：**排除**。不要用这段拟合。

2.  **扩散区 (Diffusive Regime)**:
    *   **特征**：中间时段，MSD 随时间呈**线性增长** (MSD $\propto t$)。
    *   **物理意义**：原子发生随机行走（Random Walk）。
    *   **处理**：**这是我们需要的区域**。对此区域进行线性拟合。

3.  **统计噪声区 (Statistical Noise)**:
    *   **特征**：时间很长时，曲线末端出现剧烈抖动或非线性弯曲。
    *   **物理意义**：用于统计平均的时间窗口变少（Lag time 变大），统计误差激增。
    *   **处理**：**排除**。

### 5.4.2 计算扩散系数 (D)

根据爱因斯坦关系式（Einstein Relation），在三维体系中：

$$ \text{MSD}(t) = 6Dt + C $$

其中 $D$ 为自扩散系数。

**计算步骤**：
1.  截取 MSD 曲线中线性的**扩散区**。
2.  进行线性拟合，得到斜率 $k$。
3.  计算 $D = k / 6$。

**单位换算**：
Candela 输出的 MSD 单位是 $\AA^2$，时间是 ps。
*   直接计算出的 $D$ 单位：$\AA^2/\text{ps}$
*   转换为常用单位 ($\text{cm}^2/\text{s}$):
    $$ 1 \text{ \AA}^2/\text{ps} = 10^{-16} \text{ cm}^2 / 10^{-12} \text{ s} = 10^{-4} \text{ cm}^2/\text{s} $$
    即：将 $\AA^2/\text{ps}$ 的数值乘以 $10^{-4}$。

### 5.4.3 常见问题排查
*   **MSD 曲线一直是水平的**：说明原子被束缚在晶格位点附近，没有发生扩散。可能是温度太低，或者模拟时间太短。
*   **MSD 曲线呈现抛物线状**：可能系统未平衡（体积在膨胀/收缩），或者存在定向漂移（Drift），需检查是否去除了质心运动。

# 第六章：进阶分析 (Python/MDTraj)

虽然 Candela 提供了便捷的快速可视化和基础分析功能，但在面对复杂的结构分析（如特定原子对的径向分布函数、配位数分析、二面角统计）或需要出版级的高质量绘图时，Python 生态系统——特别是 `MDTraj`、`ASE` 和 `Matplotlib`——是不可或缺的工具。

本章将带你从 ABACUS 的原始输出出发，通过 Python 脚本实现高自由度的轨迹分析。

---

## 6.1 使用 MDTraj 处理 ABACUS 轨迹

要进行高质量的分析，首先必须确保你的 ABACUS 模拟产出了足够的数据。我们将流程分为**生产阶段**和**分析阶段**。

### 第一阶段：生产运行 (Production Run)

在运行 ABACUS 分子动力学（AIMD）之前，必须在 `INPUT` 文件中正确设置输出频率。很多初学者遇到的最大问题是：跑了一周的 MD，结果发现轨迹文件里只有寥寥几帧，无法进行统计分析。

**关键参数设置 (INPUT 文件示例)：**

```bash
INPUT_PARAMETERS
# ... (基础 DFT 参数)

# --- MD 核心参数 ---
calculation     md          # 计算类型：分子动力学
md_type         nvt         # 系综类型：nve, nvt, npt 等
md_nstep        10000       # 总步数：必须足够长以保证统计显著性
md_dt           1.0         # 时间步长：单位 fs (通常 0.5 - 2.0)

# --- 关键输出控制 ---
md_dumpfreq     10          # 轨迹输出频率：每 10 步输出一次坐标
md_out_file     1           # 显式开启输出 (默认通常开启)
```

> **专家提示**：
> *   **`md_dumpfreq`**: 这是一个权衡参数。
>     *   设为 `1`：文件巨大，I/O 瓶颈，包含过多高频噪声。
>     *   设为 `1000`：数据太稀疏，无法捕捉短时动力学行为，RDF 曲线会充满噪点。
>     *   **推荐值**：通常设为 `10` 到 `50` 之间。
> *   **轨迹文件位置**：运行结束后，轨迹通常保存在 `OUT.${suffix}/MD_dump` 文件中（格式类似 XYZ）。

### 第二阶段：平衡性检查 (Pre-Analysis Check)

**Critical (至关重要)**：在计算任何性质（RDF, MSD）之前，**必须**确认系统已经达到热力学平衡。

1.  **检查能量与温度**：提取 `OUT.${suffix}/running_md.log` 中的温度和能量数据。
2.  **判定平衡点**：观察曲线何时不再漂移并在均值附近波动。
3.  **切片处理**：假设前 2000 步是平衡期，分析时必须丢弃这些数据。

### 第三阶段：Python 分析实战 (RDF 计算)

ABACUS 的 `MD_dump` 文件通常兼容标准的 XYZ 格式（包含元素符号和坐标）。我们可以直接使用 `MDTraj` 读取。

**Python 脚本示例：计算径向分布函数 (RDF)**

```python
import mdtraj as md
import matplotlib.pyplot as plt
import numpy as np

# 1. 参数设置
traj_file = 'OUT.ABACUS/MD_dump'  # ABACUS 轨迹文件路径
topology_file = None              # 对于 XYZ，MDTraj 通常能自动推断拓扑
equilibration_steps = 200         # 需要丢弃的帧数 (注意是帧数，不是 MD 步数)

# 2. 读取轨迹
print(f"正在读取轨迹: {traj_file} ...")
# ABACUS 的 MD_dump 格式通常为 XYZ，可以直接加载
traj = md.load_xyz(traj_file)

# 3. 数据预处理：去除平衡前的轨迹 (Slicing)
# 这一步对应 Candela 中的 geo_ignore
if len(traj) > equilibration_steps:
    traj_production = traj[equilibration_steps:]
    print(f"原始帧数: {len(traj)}, 分析帧数: {len(traj_production)}")
else:
    raise ValueError("轨迹过短，不足以去除平衡步！")

# 4. 拓扑修正 (如果 MDTraj 无法识别元素)
# 有时需要手动指定元素，或者加载一个 PDB 文件作为拓扑
# table, bonds = traj_production.topology.to_dataframe()
# print(table.head()) # 检查元素识别是否正确

# 5. 计算 RDF (以所有原子对为例)
# select_pairs 接受原子索引对。这里我们选取所有原子对。
pairs = traj_production.topology.select_pairs('all', 'all')
r_min, r_max = 0.0, 1.0 # 单位 nm (MDTraj 默认使用纳米)
r, g_r = md.compute_rdf(traj_production, pairs, r_range=(r_min, r_max))

# 6. 绘图
plt.figure(figsize=(8, 5))
plt.plot(r * 10, g_r, label='Total RDF', linewidth=2) # 转换为 Angstrom
plt.xlabel('r ($\AA$)', fontsize=14)
plt.ylabel('g(r)', fontsize=14)
plt.title('Radial Distribution Function (from ABACUS MD)', fontsize=16)
plt.grid(alpha=0.3)
plt.legend()
plt.savefig('rdf_analysis.png', dpi=300)
print("RDF 图像已保存为 rdf_analysis.png")
```

---

## 附录：常见问题与避坑指南

在处理 ABACUS 轨迹时，以下是新手最容易踩的坑，请务必仔细阅读。

### 1. PBC 边界效应与 `rcut`
*   **问题**：计算 RDF 时，为什么截断半径 (`rcut` 或 `r_max`) 不能超过盒子长度的一半？
*   **原理**：在周期性边界条件 (PBC) 下，如果统计半径超过 $L/2$，粒子可能会统计到它自己的镜像（Self-interaction），导致 $g(r)$ 在远端出现错误的峰值。
*   **建议**：始终设置 `r_max` 小于最小盒长的一半。

### 2. 内存溢出 (Memory Error)
*   **场景**：`MD_dump` 文件达到数 GB，Python 脚本直接卡死。
*   **解决方案**：
    *   **MDTraj**: 使用 `md.iterload()` 分块读取。
    *   **降采样**: 在读取时使用 `stride` 参数（例如每 10 帧读 1 帧），虽然牺牲了部分统计量，但能显著降低内存占用。

### 3. 统计不足 (Noisy RDF)
*   **现象**：RDF 曲线毛刺极多，不平滑。
*   **原因**：采样点太少。100 步 MD 产生的构型不足以遍历相空间。
*   **对策**：增加 `md_nstep`。对于液体或非晶体系，通常需要数千甚至数万帧的数据才能得到平滑的 RDF。

### 4. 参数映射速查表 (ABACUS vs. Candela)

在使用 Candela 进行快速分析时，参数设置必须与 ABACUS 的 `INPUT` 保持物理一致性。

| 参数类别 | ABACUS (INPUT) | Candela (分析工具) | 物理含义/备注 |
| :--- | :--- | :--- | :--- |
| **时间步长** | `md_dt` (fs) | `msd_dt` (ps) | **极易出错！** 见下方锦囊 |
| **输出频率** | `md_dumpfreq` | (隐式影响) | 决定了 Candela 读取的帧间隔时间 |
| **平衡去除** | (手动检查日志) | `geo_ignore` | **跳过**文件开头的帧数 (Equilibration) |
| **文件分段** | (自动分段) | `geo_1`, `geo_2` | 指定读取的文件**编号**范围 |

#### 💡 锦囊妙计：MSD 时间步长计算公式

在 Candela 或 Python 中计算均方位移 (MSD) 时，必须输入正确的时间间隔 (`dt`)，否则扩散系数计算将完全错误。

**公式**：
$$ \text{Analysis\_dt (ps)} = \frac{\text{md\_dt (fs)} \times \text{md\_dumpfreq}}{1000} $$

**示例**：
如果你在 ABACUS 中设置：
*   `md_dt = 2.0` (fs)
*   `md_dumpfreq = 10`

那么每一帧之间的时间间隔是 20 fs。
在 Candela 中设置 `msd_dt` 时，应填入：
$$ 2.0 \times 10 / 1000 = \mathbf{0.02} \text{ ps} $$

#### ⚠️ 风险提示：`geo_ignore` vs `geo_1/2`
*   **`geo_ignore`**: 用于**物理上的去平衡**。例如 `geo_ignore = 100` 表示忽略读取到的前 100 帧数据，防止非平衡态数据污染结果。
*   **`geo_1` / `geo_2`**: 用于**文件读取控制**。如果 ABACUS 运行时间很长，输出了 `MD_dump_1`, `MD_dump_2` ... `MD_dump_5`。
    *   `geo_1 = 2`, `geo_2 = 4` 表示只读取 `MD_dump_2` 到 `MD_dump_4` 这些文件。
    *   **切勿混淆**：不要试图用 `geo_1` 来去除平衡，除非你的平衡过程恰好占满了一整个文件。标准做法是读取所有文件，然后用 `geo_ignore` 切掉前段。

---

## 附录：进阶学习指南

恭喜你完成了本书的学习！掌握轨迹生产与基础分析只是第一步，计算材料学的世界广阔无垠，以下是为你准备的进阶建议：

### 1. 深度探索与扩展阅读
- **更多物理量分析**：除了 RDF 和 MSD，Candela 还支持静态结构因子（SSF）和离子-离子动态结构因子（DSF）的计算。对于非晶态或液态金属研究，这些指标至关重要。
- **大规模模拟的飞跃**：当 AIMD 的算力需求超出负荷时，建议关注 **DPMD（深度势能分子动力学）**。ABACUS 支持导出数据用于训练机器学习势函数，从而实现接近第一性原理精度的大规模长时演化模拟。
- **先进算法尝试**：参考资料中提到的 MSST 方法（冲击波模拟）和 FIRE 算法（结构优化），都是值得深入研究的特定领域工具。

### 2. 通用调试建议（Troubleshooting）
- **SCF 不收敛**：MD 过程中若出现 SCF 收敛困难，尝试调小 `mixing_beta` 或检查 `ecutwfc` 设置，确保势能面的平滑。
- **能量漂移**：在 NVE 系综下，若总能量随时间显著漂移，请务必检查时间步长（`delta_t`）是否过大，通常建议设置在 0.5~1.0 fs 之间。
- **单位陷阱**：这是新手最常犯错的地方。在处理 Candela 或自定义脚本时，务必确认 ABACUS 输出的长度单位（Bohr vs Angstrom）与时间单位（fs vs atomic unit）的换算关系。

### 3. 官方资源与社区
- **ABACUS 官方文档**：[https://abacus.deepmodeling.com/](https://abacus.deepmodeling.com/) 包含最权威的参数说明。
- **Candela 开源主页**：[https://github.com/MCresearch/Candela](https://github.com/MCresearch/Candela) 获取最新版本的分析功能。
- **DeepModeling 社区**：参与讨论，获取更多关于计算材料学的前沿动态。

保持好奇，勤于实践，祝你在科学研究的道路上取得突破！
