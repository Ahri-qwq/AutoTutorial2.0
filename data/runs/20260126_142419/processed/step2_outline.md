<!-- META_START -->
# ABACUS 实战教程：Smearing (高斯展宽) 参数调优与收敛性控制

## 前言
- **本书逻辑**: 本教程旨在帮助用户理解并掌握 ABACUS 中 Smearing（展宽）技术的应用。逻辑上遵循“物理原理 -> 参数含义 -> 精度与收敛性博弈 -> 典型体系策略”的递进关系，重点解决金属体系 SCF 难收敛的问题，并规避能量计算中的常见陷阱。
- **核心知识点**: 电子占据函数平滑化、电子熵修正、Rydberg 单位制陷阱、收敛性与精度的 Trade-off、不同体系（金属/半导体/绝缘体）的参数选择。

<!-- CHAPTER_START -->
## 第一章：物理机制：为什么需要“模糊”电子占据？
**本章逻辑**: 在操作参数之前，必须先理解 Smearing 的物理本质。本章解释为何在 DFT 计算（特别是金属体系）中需要引入数学上的“展宽”来解决 SCF 震荡问题，以及由此引入的“电子熵”物理意义。

### Section 1.1: 费米面处的数值困境
- **内容**: 阐述在 0K 下，金属费米面附近的电子占据呈阶梯状（Step Function）。解释这种不连续性如何导致 SCF 迭代中电荷密度的剧烈震荡（Charge Sloshing），从而引出引入平滑函数（Smearing）的必要性。
- **关键参数**: 无

### Section 1.2: 电子熵与自由能修正
- **内容**: 解释引入 Smearing 后，系统总能量不再是单纯的基态能量，而是包含了电子熵贡献（$-TS$）的自由能。说明在展宽趋于 0 时，结果如何回归到真实的物理基态。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第二章：参数详解：ABACUS 中的 Smearing 设置
**本章逻辑**: 进入实操环节，详细解析 ABACUS 输入文件中的核心参数。本章的重点是明确不同方法的适用场景，并**着重强调单位问题**，防止用户因习惯差异导致计算错误。

### Section 2.1: 展宽方法的选择 (Method)
- **内容**: 详细介绍 `gauss`, `mp` (Methfessel-Paxton), `fixed`, `fd` (Fermi-Dirac) 等方法的区别。
    - `fixed`: 绝缘体专用。
    - `gauss`: 通用，安全，但收敛较慢。
    - `mp`: 金属体系推荐，能更好地近似阶梯函数。
- **关键参数**: `smearing_method`

### Section 2.2: 展宽宽度的设定与单位陷阱 (Sigma)
- **内容**: 讲解如何设置展宽的能量范围。
    - **核心警告**: 必须强调 ABACUS 中 `smearing_sigma` 的单位是 **Ry (Rydberg)** 而非 eV。对比 `0.01 Ry` 与 `0.01 eV` 的巨大差异。
    - 介绍 `smearing_sigma_temp` 的存在及其与 `smearing_sigma` 的互斥关系。
- **关键参数**: `smearing_sigma`, `smearing_sigma_temp`

<!-- CHAPTER_START -->
## 第三章：核心博弈：收敛性与能量精度的权衡
**本章逻辑**: 这是本教程的“进阶分析”部分。用户需要理解 Sigma 值并非固定不变，而是一个需要在“容易收敛”和“结果准确”之间寻找平衡的参数。

### Section 3.1: Sigma 对 SCF 收敛性的影响
- **内容**: 分析增大 Sigma 值如何通过“模糊”费米面来抑制电荷密度震荡，从而加速 SCF 收敛。展示 Sigma 过小导致不收敛的现象。
- **关键参数**: `smearing_sigma`

### Section 3.2: Sigma 对总能量的影响与外推
- **内容**: 讨论 Sigma 增大带来的副作用——总能量偏离真实的基态能量。介绍如何通过测试不同的 Sigma 值并将能量外推至 Sigma=0 的情况来评估误差。
- **关键参数**: `smearing_sigma`

### Section 3.3: 能量对比的一致性原则
- **内容**: 强调在计算形成能、吸附能或能垒时，参与对比的所有结构（反应物、产物、过渡态）必须使用**完全一致**的 Smearing 参数，严禁为了某个难收敛结构单独修改参数。
- **关键参数**: `smearing_method`, `smearing_sigma`

<!-- CHAPTER_START -->
## 第四章：场景实战：不同体系的配置策略
**本章逻辑**: 将理论和参数知识转化为具体场景下的操作指南，涵盖绝缘体、半导体和金属的推荐配置，以及应对难收敛体系的高级策略。

### Section 4.1: 绝缘体与半导体体系
- **内容**: 
    - 宽带隙绝缘体：推荐使用 `fixed` 或极小的 `gauss` 展宽。
    - 小带隙半导体：使用 `gauss` 方法，Sigma 保持在默认值或更小（如 0.01 Ry）。
- **关键参数**: `smearing_method` (fixed/gauss)

### Section 4.2: 金属体系的标准配置
- **内容**: 推荐使用 `mp` 或 `mp2` 方法，配合适中的 Sigma（如 0.01 - 0.02 Ry）。解释为何 MP 方法在金属中优于高斯方法（负占据数的物理数学修正）。
- **关键参数**: `smearing_method` (mp), `smearing_sigma`

### Section 4.3: 难收敛体系的“两步走”策略
- **内容**: 提供一种实用的工作流：
    1. 先用较大的 Sigma (如 0.02-0.03 Ry) 快速获得粗略收敛的电荷密度。
    2. 读取电荷密度，减小 Sigma (至 0.01 Ry) 进行高精度计算。
    - 同时提及当 Smearing 无法解决问题时，需检查 `mixing_beta`。
- **关键参数**: `smearing_sigma`, `mixing_beta` (关联参数)

<!-- APPENDIX_START -->
## 附录：常见问题与避坑指南
- **DOS 计算的区别**: 明确区分 SCF 计算用的 `smearing_sigma` (Ry) 与后处理 DOS 绘图用的 `dos_sigma` (eV)。
- **受力收敛滞后**: 提醒在结构弛豫中，Smearing 较大时可能能量收敛但受力未收敛。
- **报错排查**: `smearing_sigma` 与 `smearing_sigma_temp` 同时使用的报错处理。