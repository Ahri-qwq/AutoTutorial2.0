# 第一章：弹性力学基础与计算原理

在开启 ABACUS 的计算之旅前，我们必须先夯实物理基础。弹性常数（Elastic Constants）不仅是衡量材料刚度的标尺，更是判断晶体结构力学稳定性的“金标准”。本章将从张量理论出发，深入解析第一性原理计算弹性常数的底层逻辑，帮助你理解每一个输入参数背后的物理意义。

## 1.1 弹性张量与广义胡克定律

在连续介质力学中，当材料受到微小外力作用时，其形状发生变化。描述这一物理过程的核心是两个二阶张量：**应力（Stress, $\sigma$）**与**应变（Strain, $\epsilon$）**。

### 1.1.1 物理定义
- **应力 ($\sigma_{ij}$)**: 描述单位面积上的内力，是一个 $3 \times 3$ 的二阶对称张量。
- **应变 ($\epsilon_{kl}$)**: 描述材料变形的程度，同样是一个 $3 \times 3$ 的二阶对称张量。

### 1.1.2 广义胡克定律
在弹性形变极限内（即形变足够小，撤去外力后材料能恢复原状），应力与应变之间满足线性关系，这就是**广义胡克定律**：

$$ \sigma_{ij} = \sum_{k,l} C_{ijkl} \epsilon_{kl} $$

其中，$C_{ijkl}$ 被称为**弹性刚度张量（Elastic Stiffness Tensor）**。这是一个四阶张量，包含 $3^4 = 81$ 个分量。

> **教授视点**：初学者常问，为什么我们需要计算这么多分量？实际上，如果不利用对称性，直接计算 81 个分量是极其昂贵且不必要的。理解下一节的“对称性约化”是高效计算的关键。

---

## 1.2 Voigt 记号与对称性约化

为了便于书写和计算，我们通常使用 **Voigt 记号** 将四阶张量降维处理。

### 1.2.1 降维映射规则
利用应力和应变的对称性（$\sigma_{ij}=\sigma_{ji}$，$\epsilon_{ij}=\epsilon_{ji}$），我们可以将双下标 $(ij)$ 映射为单下标 $\alpha$（范围 1-6）：

| 张量下标 $(ij)$ | $xx$ | $yy$ | $zz$ | $yz$ | $xz$ | $xy$ |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: |
| **Voigt 下标 $(\alpha)$** | **1** | **2** | **3** | **4** | **5** | **6** |

由此，胡克定律简化为矩阵形式：
$$ \sigma_{\alpha} = \sum_{\beta=1}^{6} C_{\alpha\beta} \epsilon_{\beta} $$
此时，$C_{\alpha\beta}$ 变成了一个 $6 \times 6$ 的对称矩阵，独立分量从 81 个减少到了 21 个。

### 1.2.2 晶体对称性的进一步约束
晶体自身的对称性会进一步迫使某些分量为零或彼此相等。这是我们在设置计算任务时的重要依据：

*   **立方晶系 (Cubic, 如 Si, Cu)**: 仅有 **3** 个独立分量 ($C_{11}, C_{12}, C_{44}$)。
*   **四方晶系 (Tetragonal, 如金红石 TiO$_2$)**: 通常有 **6** 个独立分量 ($C_{11}, C_{12}, C_{13}, C_{33}, C_{44}, C_{66}$)。
*   **三斜晶系 (Triclinic)**: 最低对称性，需计算全部 **21** 个独立分量。

### 1.2.3 坐标系取向的重要性 (IEEE 标准)
**警示**：弹性常数是高度依赖方向的。
在对比实验值或 Materials Project 数据库时，必须确保你的晶体取向与它们一致。通常推荐遵循 **IEEE 标准**（如 IEEE 176-1987）。
*   例如：对于四方晶系，$c$ 轴必须沿 $z$ 方向。如果你的结构文件（STRU）中 $c$ 轴沿 $x$ 方向，计算出的 $C_{11}$ 实际上对应物理上的 $C_{33}$。
*   **实战建议**：在使用 `abacustest` 或手动建模前，建议先对晶胞进行标准化旋转。

---

## 1.3 第一性原理计算方法：应力-应变法

ABACUS 计算弹性常数的核心思想是**“施加应变，测量应力”**。我们无法直接“测量”弹性常数，而是通过给晶体施加一系列已知的微小应变 $\epsilon$，利用 DFT 计算出对应的应力 $\sigma$，最后通过线性拟合求解 $C_{ij}$。

### 1.3.1 核心工作流
计算过程严格分为两个阶段，混淆这两个阶段是新手最常见的错误来源。

#### **第一步：零应力结构获取 (Equilibrium State)**
在施加变形前，必须确保初始结构处于“零应力”状态。任何残余应力都会导致后续拟合的截距偏移，甚至影响弹性常数的斜率。
*   **ABACUS 任务类型**: `calculation cell-relax`
*   **目标**: 优化晶胞矢量（Cell）和原子位置（Ions），直到应力张量对角元接近 0 kbar。

#### **第二步：施加应变后的应力计算 (Deformation & Response)**
在此阶段，我们对优化好的晶胞施加微小形变（如 $\pm 0.5\%, \pm 1\%$），然后计算应力。
*   **ABACUS 任务类型**: `calculation relax` (注意：绝不是 `cell-relax`！)
*   **关键逻辑**: 我们固定变形后的晶胞形状（Fixed Cell），只允许原子在晶胞内部移动以寻找受力平衡位置。

> **风险提示**：在第二步中，如果你错误地使用了 `cell-relax`，ABACUS 会自动优化晶胞形状以消除你施加的应变，导致计算结果完全失效（应力全为零）。

### 1.3.2 原子弛豫：Relaxed-ion vs. Clamped-ion
在施加应变后，原子是否允许移动，定义了两种不同的弹性常数：

1.  **Relaxed-ion Elastic Constants (通常对应实验值)**
    *   **物理含义**: 静态或低频极限。当晶胞变形时，原子有足够的时间调整位置以达到受力平衡（Internal Relaxation）。
    *   **计算设置**: 使用 `calculation relax`。
    *   **abacustest 默认行为**: `abacustest` 的工作流默认会进行此项计算。

2.  **Clamped-ion Elastic Constants (高频极限)**
    *   **物理含义**: 假设变形发生得极快，原子来不及调整相对位置，仅随晶格做仿射变换。
    *   **计算设置**: 使用 `calculation scf`（仅电子迭代，原子不动）。
    *   **abacustest 设置**: 需添加 `--norelax` 参数。

### 1.3.3 关键参数详解
在 ABACUS 的 `INPUT` 文件中，以下参数对于弹性常数计算至关重要：

```bash
# INPUT 参数示例

calculation     relax   # 变形后计算必须用 relax (或 scf)，严禁 cell-relax
cal_stress      1       # 【核心】必须开启！否则无法输出应力数据
cal_force       1       # 推荐开启，用于辅助原子弛豫判断

# 精度控制
relax_nmax      100     # 确保有足够的步数让原子弛豫收敛
etot_conv_thr   1.0e-5  # 能量收敛标准需足够严格
force_thr       1.0e-3  # 力收敛标准，直接影响应力计算的精度
```

### 1.3.4 自动化工作流的风险 (`abacustest` 用户必读)
在使用 `abacustest` 辅助工具时，它会自动为你生成一系列形变文件夹（如 `deform-001`, `deform-002`...）。

> **警告**：`abacustest` 的准备命令（prepare）具有覆盖性。
> **不要在计算完成后重复执行输入文件准备命令！**
> 如果你手滑再次运行了准备脚本，它会清空目录下已算好的 `OUT` 文件夹，导致你需要重新提交所有计算任务。

---

**本章小结**
理解了胡克定律的矩阵形式、Voigt 记号的降维逻辑，以及“先优化晶胞，后固定晶胞弛豫原子”的计算流程，你就已经掌握了计算弹性常数的理论核心。下一章，我们将进入实战环节，手把手教你计算硅（Si）的弹性模量。