<!-- META_START -->
# ABACUS 实战教程：随机波函数 DFT (sDFT) 大体系计算

## 前言
- **本书逻辑**: 本教程遵循从“物理原理”到“基础操作”，再到“核心难点（误差控制）”，最后进阶到“动力学与性质分析”的认知路径。sDFT 与传统 KSDFT 最大的区别在于随机性引入的统计误差，因此本教程特别将“误差分析与收敛性测试”独立成章，作为连接基础与进阶的桥梁。
- **核心知识点**: 随机波函数理论基础、温稠密物质 (WDM) 模拟、sDFT/MDFT 参数配置、随机误差控制、高温分子动力学、态密度 (DOS) 计算。

<!-- CHAPTER_START -->
## 第一章：随机波函数 DFT 的物理基础与适用场景
**本章逻辑**: 在动手计算前，必须明确 sDFT 解决了什么问题（高温计算瓶颈）以及其代价是什么（引入随机噪声），从而理解后续参数设置的物理动机。

### Section 1.1: 温稠密物质与 KSDFT 的瓶颈
- **内容**: 介绍温稠密物质 (WDM) 的定义（高温高压），阐述传统 Kohn-Sham DFT 在高温下因占据态急剧增加导致计算量呈 $N^3$ 爆炸式增长的问题。
- **关键参数**: 无

### Section 1.2: sDFT 的核心思想：以随机换效率
- **内容**: 通俗解释 sDFT 如何利用随机轨道 (Stochastic Orbitals) 和切比雪夫 (Chebyshev) 展开逼近费米算符的迹，从而避免哈密顿量对角化。对比 sDFT 与 KSDFT 的计算复杂度。
- **关键参数**: `esolver_type` (设置为 sdft)

### Section 1.3: 纯 sDFT 与 混合 MDFT 的抉择
- **内容**: 介绍两种模式的区别。纯 sDFT 适用于极高温；MDFT (Mixed DFT) 引入少量确定性轨道处理深能级，加速收敛。指导用户如何根据体系温度选择模式。
- **关键参数**: `nbands` (0 为纯 sDFT, >0 为 MDFT), `nbands_sto`

<!-- CHAPTER_START -->
## 第二章：sDFT 基础流程：单点能计算 (SCF)
**本章逻辑**: 以最简单的硅双原子体系为例，建立 sDFT 计算的标准输入文件结构，重点讲解与 KSDFT 不同的核心参数。

### Section 2.1: 输入文件概览与核心开关
- **内容**: 基于 `pw_Si2` 案例，解析 INPUT 文件。重点说明如何开启 sDFT 求解器以及展宽方法的限制。
- **关键参数**: `calculation` (scf), `esolver_type` (sdft), `smearing_method` (必须为 fd)

### Section 2.2: 随机空间与切比雪夫展开设置
- **内容**: 详解控制精度的两大支柱：随机轨道数量和展开阶数。解释 `nche_sto` 与温度、截断能的依赖关系（温度越高阶数越低）。
- **关键参数**: `nbands_sto`, `nche_sto` (关注 log 中的 Chebyshev Precision)

### Section 2.3: 算法选择与并行策略
- **内容**: 介绍不同内存/速度权衡的算法模式，以及如何利用能带并行提高效率。
- **关键参数**: `method_sto` (1 省内存, 2 速度快), `bndpar`, `kpar`

<!-- CHAPTER_START -->
## 第三章：核心难点：误差分析与收敛性测试
**本章逻辑**: 这是 sDFT 最关键的一章。由于结果带有随机性，用户必须掌握如何通过统计方法验证结果的可靠性，而非盲目信任一次计算的输出。

### Section 3.1: 理解随机误差与大数定律
- **内容**: 解释为何 sDFT 的能量不是固定值，而是围绕真值波动。阐述误差与 $\frac{1}{\sqrt{N}}$ 的关系。
- **关键参数**: `seed_sto` (随机数种子)

### Section 3.2: 随机轨道数目 (nbands_sto) 的收敛测试
- **内容**: 实战演练：固定其他参数，改变 `seed_sto` 进行多次计算（约10次），统计能量标准差。演示如何增加 `nbands_sto` 直到误差满足要求（如 < 1e-4 Ry）。
- **关键参数**: `nbands_sto`, `seed_sto`

### Section 3.3: 平面波截断能 (ecut) 的统计测试
- **内容**: 说明 sDFT 中测试 `ecut` 的特殊性（需取多次随机种子的平均值）。展示如何判断高温下的 `ecut` 收敛标准。
- **关键参数**: `ecutwfc`

<!-- CHAPTER_START -->
## 第四章：进阶应用：混合 DFT (MDFT) 与 分子动力学
**本章逻辑**: 在掌握基础 SCF 和误差控制后，进入实际科研场景：利用 MDFT 提高精度，以及进行高温下的原子运动模拟。

### Section 4.1: 启用混合随机-确定性 DFT (MDFT)
- **内容**: 针对非极高温场景，演示如何通过引入确定性轨道来处理费米面深处的电子，从而减少随机噪声。
- **关键参数**: `nbands` (设置为覆盖深层能级), `nbands_sto`

### Section 4.2: 高温分子动力学模拟 (MD)
- **内容**: 基于 `pw_md_Al` 案例，讲解如何进行 WDM 的动力学演化。重点强调 MD 过程中的参数继承与稳定性。
- **关键参数**: `calculation` (md), `md_nstep`, `md_dt`, `md_tfirst`

<!-- CHAPTER_START -->
## 第五章：电子性质分析：态密度 (DOS) 计算
**本章逻辑**: 计算完能量和结构后，通常需要分析电子结构。sDFT 的 DOS 计算需要独立的后处理流程和参数调整。

### Section 5.1: DOS 计算流程与参数配置
- **内容**: 基于 `186_PW_SDOS_10D10S` 案例，讲解如何开启 DOS 输出。注意 DOS 计算通常需要比 SCF 更高的切比雪夫展开阶数。
- **关键参数**: `out_dos` (1), `dos_emin_ev`, `dos_emax_ev`, `dos_sigma`, `dos_nche`

### Section 5.2: 大体系 DOS 计算的内存优化
- **内容**: 针对大体系计算 DOS 时可能出现的内存溢出问题，介绍分块计算策略。
- **关键参数**: `npart_sto`, `method_sto`

<!-- APPENDIX_START -->
## 附录：常见问题与专家建议
- **高温赝势选择**: 警告用户注意内壳层电离问题，建议使用专用的高温赝势或自行生成。
- **内存溢出 (OOM) 处理**: 汇总 `method_sto` 和 `npart_sto` 的调整策略。
- **Smearing 陷阱**: 再次强调仅支持 `fd` (Fermi-Dirac) 展宽，避免使用 Gaussian 或 Methfessel-Paxton。