基于您提供的参考资料，以下是关于 **随机波函数 DFT (sDFT) 大体系计算** 的结构化元数据报告。

---

# ABACUS 元数据报告：随机波函数 DFT (sDFT)

## 1. 物理本质 (Physics Concepts)
- **核心物理概念**: 
    - **随机密度泛函理论 (Stochastic DFT, sDFT)**: 放弃传统 Kohn-Sham DFT 中对哈密顿矩阵的严格对角化，转而使用随机轨道（Stochastic Orbitals）和切比雪夫（Chebyshev）多项式展开来逼近费米-狄拉克算符的迹，从而获得电子密度和总能量。
    - **混合随机-确定性 DFT (Mixed DFT, MDFT)**: 结合少量低能确定性 Kohn-Sham 轨道（处理占据数接近 1 的深能级）和随机轨道（处理高能级），以加速收敛并减小随机误差。
- **解决的科学问题**: 
    - **温稠密物质 (Warm Dense Matter, WDM) 模拟**: 解决在极高温（数十到上千 eV）条件下，传统 KSDFT 因需要计算海量占据态波函数而导致的计算量爆炸问题。
    - **大体系高温计算**: 利用 sDFT 算法优势，实现随温度升高计算效率相对提升（展开阶数降低），适用于极端条件下的材料模拟。

## 2. 关键输入参数 (Key Parameters)

### 核心控制参数
- **`esolver_type`**
    - **推荐值**: `sdft`
    - **物理意义**: 指定能量求解器类型。必须设置为 `sdft` 才能开启随机波函数计算功能。
- **`calculation`**
    - **推荐值**: `scf` 或 `md`
    - **物理意义**: 计算类型。sDFT 支持自洽计算 (`scf`) 和分子动力学模拟 (`md`)。
- **`smearing_method`**
    - **推荐值**: `fd`
    - **物理意义**: 展宽方法。**注意**：目前 sDFT 仅支持费米-狄拉克 (`fd`) 展宽。

### 轨道与精度参数
- **`nbands`**
    - **推荐值**: 
        - 纯 sDFT: `0`
        - MDFT: 大于 0 (通常设为覆盖费米能级以下的能带数)
    - **物理意义**: 确定性 Kohn-Sham 轨道的数量。若为 0 且 `nbands_sto > 0`，则为纯 sDFT；若 `>0`，则为 MDFT。
- **`nbands_sto`**
    - **推荐值**: 需测试收敛性 (例如 64, 128...)
    - **物理意义**: 随机波函数轨道的数量。数量越多，随机误差越小（误差与 $\frac{1}{\sqrt{N}}$ 成正比），但计算量线性增加。
- **`nche_sto`**
    - **推荐值**: 使得 `running_scf.log` 中 `Chebyshev Precision < 1e-8`。
    - **物理意义**: 哈密顿量切比雪夫展开的阶数。与温度成反比（温度越高阶数越低），与 `ecut` 成正比。
- **`method_sto`**
    - **推荐值**: `2` (默认，速度快但耗内存) 或 `1` (省内存但稍慢)
    - **物理意义**: sDFT 的具体算法实现方式。

### 并行与随机种子
- **`seed_sto`**
    - **推荐值**: `0` (随机) 或 `>1` 的整数 (固定种子)
    - **物理意义**: 生成随机轨道的种子。用于误差分析时，需使用不同种子多次计算取平均。
- **`bndpar`**
    - **推荐值**: 需测试，优先使用 K 点并行 (`kpar`)。
    - **物理意义**: 随机轨道的并行组数。将随机轨道分组并行计算。

### 态密度 (DOS) 计算参数
- **`out_dos`**
    - **推荐值**: `1` (开启)
    - **物理意义**: 是否输出态密度。
- **`dos_nche`**
    - **推荐值**: `100` 或更高
    - **物理意义**: 计算 DOS 时的切比雪夫展开阶数（通常比 SCF 中的 `nche_sto` 要求更高）。
- **`npart_sto`**
    - **推荐值**: `1` (默认)
    - **物理意义**: 当 `method_sto=2` 计算 DOS 时，控制内存使用的参数（内存变为正常的 `1/npart_sto`）。

## 3. 体系与接口配置 (System & Interfaces)
- **结构 (STRU)**: 
    - 与标准 KSDFT 一致，无特殊格式要求。
- **赝势 (Pseudopotentials)**: 
    - **类型限制**: 目前主要支持模守恒赝势 (Norm-Conserving, NC)。
    - **高温注意**: 在极高温情况下，常规赝势的内壳层可能发生电离，需谨慎选择或专门生成适用于高温的赝势（考虑更深的内壳层电子作为价电子）。
- **K点 (KPT)**: 
    - ABACUS 的 sDFT/MDFT 支持多 K 点采样，这一点优于部分其他软件的 sDFT 实现。

## 4. 教程编写特殊指令 (Special Instructions for Writer)
- **Critical (误差控制流程)**: 必须详细描述如何确定 `nbands_sto` 和 `ecut`。
    - **指令**: 强调 sDFT 存在随机误差。教程中必须包含“误差测试”步骤：即使用约 10 个不同的 `seed_sto` 进行计算，统计能量的平均值和标准差，以此判断 `nbands_sto` 是否足够（目标误差通常 < 1e-4 Ry）。
- **Critical (MDFT vs sDFT)**: 
    - **指令**: 明确告知用户何时使用 MDFT。当系统温度虽高但仍有部分深能级被完全占据时，使用 MDFT（设置少量 `nbands`）可以显著加速收敛并降低对随机轨道数量的需求。
- **Critical (参数依赖关系)**: 
    - **指令**: 解释 `nche_sto` 的选取逻辑。提醒用户：温度越高，需要的 `nche_sto` 越小（计算越快）；截断能 `ecut` 越大，需要的 `nche_sto` 越大。
- **风险提示**: 
    - 资料中未提及应力 (Stress) 计算在 sDFT 下的特殊参数，若涉及晶胞优化 (Cell Relaxation)，需提醒用户查阅官方文档确认 sDFT 是否支持应力计算（通常 sDFT 计算力比较成熟，应力计算可能受限）。

## 5. 常见报错与注意事项 (Pitfalls)
- **内存溢出 (OOM)**: 
    - `method_sto 2` 虽然速度快，但内存消耗大。如果遇到内存不足，建议切换为 `method_sto 1` 或在 DOS 计算时调整 `npart_sto`。
- **收敛性问题**: 
    - 如果 SCF 不收敛，除了调整常规混合参数 (`mixing_beta`) 外，应首先检查 `nbands_sto` 是否太少导致随机噪声过大，淹没了物理梯度的方向。
- **Smearing 设置错误**: 
    - 如果设置了 `smearing_method` 为 `gaussian` 或 `mp`，程序可能会报错或结果不正确，必须强制使用 `fd`。
- **赝势移植性**: 
    - 警告用户不要直接沿用常温下的赝势进行上百 eV 的计算，必须检查芯电子是否被激发。