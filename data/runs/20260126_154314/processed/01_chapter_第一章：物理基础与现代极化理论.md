# 第一章：物理基础与现代极化理论

欢迎来到《ABACUS 实战教程》。作为一名长期从事计算材料学研究的开发者，我深知许多初学者在处理“铁电极化”这一课题时，往往会陷入数据的迷宫。

你可能会发现，计算出的极化值忽大忽小，甚至与实验值相差巨大的整数倍。这并非软件的 Bug，而是量子力学在周期性体系中的本质特性。在开始编写 `INPUT` 文件之前，我们必须先重塑对“极化”的物理认知。本章将带你理解现代极化理论（Modern Theory of Polarization）的核心——**贝里相位（Berry Phase）**。

---

## 1.1 周期性体系极化的困境

在经典电磁学或孤立分子体系中，电极化强度 $\mathbf{P}$ 的定义非常直观：它是偶极矩密度。
$$ \mathbf{P} = \frac{1}{V} \sum_i q_i \mathbf{r}_i $$
其中 $q_i$ 是电荷，$\mathbf{r}_i$ 是位置矢量。

然而，当我们进入晶体世界，引入**周期性边界条件（PBC）**时，这个定义瞬间崩塌了。

### 为什么 $\sum q \mathbf{r}$ 会失效？
在周期性体系中，位置算符 $\mathbf{r}$ 是不受限的（unbounded）。
想象一个一维原子链，原子间距为 $a$。如果我们选取原胞边界在 $x=0$ 到 $x=a$，计算出的偶极矩是一个值；如果我们仅仅将原胞边界平移微小的距离 $\delta$，或者将某个电子的坐标选取为 $x+na$（这在物理上代表同一个电子），上述公式计算出的 $\mathbf{P}$ 值会发生剧烈跳变，甚至取决于你如何选取原胞的“边缘”。

但在物理上，晶体的极化状态是确定的，不应随人为选取的原胞边界而改变。这说明：**在周期性固体中，绝对极化强度（Absolute Polarization）本身是一个定义模糊的量，只有极化的变化量（$\Delta \mathbf{P}$）才是物理可测的。**

### Clausius-Mossotti 的局限
早期的固体物理尝试使用 Clausius-Mossotti 关系将极化率与介电常数联系起来。这对于高对称性的非极性材料（如 Si, Ge）是有效的，但对于铁电体（如 $BaTiO_3$），由于存在显著的共价键成分和电子离域化，经典的离子模型无法描述电子云的复杂畸变。我们需要一个基于量子力学的、不依赖于位置算符 $\mathbf{r}$ 的新理论。

---

## 1.2 贝里相位与极化量子

现代极化理论（由 King-Smith, Vanderbilt, Resta 等人建立）提出了一个革命性的观点：**极化不是电荷密度的静态积分，而是波函数在倒空间绝热演化产生的几何相位（Berry Phase）。**

### 1.2.1 什么是贝里相位？
在 ABACUS 中，当我们计算极化时，实际上是在计算电子波函数（Bloch态 $|u_{n\mathbf{k}}\rangle$）随 $k$ 点在布里渊区移动时积累的相位。

简单来说，极化强度 $\mathbf{P}$ 与以下积分成正比：
$$ \mathbf{P} \propto \int_{BZ} \langle u_{n\mathbf{k}} | i\nabla_{\mathbf{k}} | u_{n\mathbf{k}} \rangle d\mathbf{k} $$
被积函数正是贝里联络（Berry Connection）。这意味着，极化反映了电子云中心（Wannier 中心）相对于离子骨架的相对位移。

### 1.2.2 极化多值性 (The Modulo $2\pi$ Ambiguity) —— **核心概念**

这是新手最容易“翻车”的地方，请务必仔细阅读。

由于相位 $\phi$ 和 $\phi + 2\pi$ 在数学上描述的是同一个物理状态，由贝里相位导出的极化强度 $\mathbf{P}$ 具有**多值性**。计算得到的极化值 $\mathbf{P}_{calc}$ 实际上属于一个集合：

$$ \mathbf{P} = \mathbf{P}_{calc} + n \cdot \mathbf{P}_{quant} \quad (n = 0, \pm 1, \pm 2, \dots) $$

这里的 $\mathbf{P}_{quant}$ 被称为**极化量子（Polarization Quantum）**。

*   **物理意义**：极化量子对应于将一个电子从晶胞的一侧绝热移动一个晶格矢量 $\mathbf{R}$ 到另一侧所产生的极化变化。
*   **公式**：对于体积为 $\Omega$ 的晶胞，沿某一方向 $\mathbf{R}$ 的极化量子大小为：
    $$ P_{quant} = \frac{e |\mathbf{R}|}{\Omega} $$
    其中 $e$ 是电子电荷。

**实战启示**：
当你使用 ABACUS 计算铁电相（Ferroelectric）和顺电相（Paraelectric）的极化差 $\Delta P$ 时，直接相减可能会得到一个巨大的数值，或者一个反常的小数值。
**你必须手动检查并加上或减去若干个 $P_{quant}$，使得 $\Delta P$ 落在合理的物理范围内。** 这就是所谓的“选取正确的分支（Branch）”。

---

## 1.3 ABACUS 中的计算策略

理解了物理原理后，我们在 ABACUS 中实施计算时需要遵循特定的工作流。

### 1.3.1 LCAO 基组的优势
ABACUS 支持平面波（PW）和原子轨道（LCAO）两种基组。在极化计算方面，**LCAO 基组**（`basis_type lcao`）具有天然的优势。由于 LCAO 也就是紧束缚近似的自然延伸，它在处理 Berry Curvature 和 Wannier 中心定位时，通常比纯平面波方法在数值上更为高效，且能与有限差分法的结果吻合良好。

### 1.3.2 必须遵循的“两步走”流程
计算 Berry Phase 极化**绝不能**在一个普通的自洽计算（SCF）中直接完成。必须严格分两步：

1.  **第一步：SCF (Self-Consistent Field)**
    *   **目的**：求解基态电子密度，获得收敛的电荷密度文件。
    *   **关键参数**：
        *   `calculation scf`
        *   `scf_thr 1.0e-8` (建议极化计算使用较高的收敛精度)
    *   **输出**：产生电荷密度文件（如 `SPIN1_CHG.cube` 或二进制文件，取决于版本）。

2.  **第二步：NSCF / Berry Phase Calculation**
    *   **目的**：读取第一步收敛的电荷密度，固定哈密顿量，计算波函数在倒空间的相位。
    *   **关键操作**：
        *   读取上一步的电荷密度（通常通过设置 `init_chg` 或类似参数，具体依版本而定）。
        *   开启 Berry Phase 计算模式。

### 1.3.3 风险提示：参数设置
在撰写 `INPUT` 文件时，你需要指定计算极化的方向（通常是沿着晶格矢量的方向）。

> **⚠️ 特别注意 (Risk Warning)**：
> 目前的公开资料库中未明确收录 ABACUS 最新版本中指定 Berry Phase 方向的具体参数名（例如是叫 `berry_phase_dir`、`gdir` 还是通过 `KPT` 文件特殊指定）。
>
> **请务必查阅 ABACUS 官方文档中关于 "Berry Phase" 或 "Macroscopic Polarization" 的章节**，确认以下两点：
> 1.  开启极化计算的开关参数（例如 `calculation nscf` 配合特定的 flag）。
> 2.  指定极化方向的参数（Direction）。
>
> *切勿凭空猜测参数名，否则程序将忽略该设置或报错。*

---

## 本章小结

1.  **周期性**导致位置算符 $\mathbf{r}$ 失效，必须使用**贝里相位**理论。
2.  极化值是 **Modulo $2\pi$** 的，存在**极化量子 $P_{quant}$**。在分析数据时，必须考虑 $P \pm n \cdot P_{quant}$ 的多值性。
3.  ABACUS 计算极化推荐使用 **LCAO 基组**，且必须遵循 **先 SCF 后 NSCF (Berry Phase)** 的计算流程。

在下一章中，我们将进入实战环节，手把手教你准备 $BaTiO_3$ 的结构文件与输入参数。