# 第三章：结果分析与自发极化计算

获得原始数据只是第一步。在计算材料学中，铁电材料的自发极化计算是初学者最容易感到困惑的领域之一。这主要是因为根据现代极化理论（Modern Theory of Polarization），晶体中的宏观极化强度并非一个单值，而是一个多值函数（Lattice of values）。

本章将带你穿越“相位迷雾”，演示如何利用 ABACUS 的 LCAO 基组优势，从原始的 Berry Phase 数据中提取出物理上唯一的自发极化强度 $P_s$。

---

## 3.1 原始输出数据的解读

在 ABACUS 中计算极化，必须遵循 **“先 SCF 后 NSCF”** 的两步走流程。这是因为 Berry Phase 的计算依赖于收敛良好的基态波函数，但其本身的计算过程（沿着倒空间路径积分）通常是在非自洽（NSCF）步骤中完成的。

### 3.1.1 计算流程与 INPUT 设置

**第一步：自洽计算 (SCF)**
首先进行标准的自洽计算以获得收敛的电荷密度和波函数。

```bash
# INPUT (Step 1: SCF)
calculation     scf
basis_type      lcao        # ABACUS 在 LCAO 下计算 Berry Phase 效率极高
symmetry        0           # 建议关闭对称性以防止极化方向被强制对称化
cal_force       0
cal_stress      0
out_chg         1           # 必须输出电荷密度，供下一步读取
```

**第二步：非自洽计算 (NSCF)**
读取上一步的电荷密度，开启 Berry Phase 计算。

> **⚠️ 风险提示：参数缺失警告**
> ABACUS 的极化计算参数更新较快。在撰写 `INPUT` 文件时，你需要明确指定极化的计算方向（通常是沿着倒格矢的某个方向）。
>
> 由于当前资料库未包含最新的方向控制参数名（例如可能是 `berry_phase_dir` 或在 `KPT` 文件中特殊指定），**请务必查阅 ABACUS 官方文档中关于 "Berry Phase" 或 "Polarization" 的章节**，确认如何设置积分方向（Direction）和积分路径的密度。

```bash
# INPUT (Step 2: NSCF)
calculation     nscf        # 切换为非自洽计算
init_chg        file        # 读取上一步生成的电荷密度
basis_type      lcao
symmetry        0

# [PARAMETER_MISSING]
# 在此处需添加开启 Berry Phase 计算及指定方向的参数
# 请参考官方文档设置极化方向 (e.g., x, y, or z)
```

### 3.1.2 解读输出文件

运行结束后，ABACUS 会在日志文件或特定的输出文件中打印 Berry Phase 的结果。通常你会看到两部分贡献：

1.  **离子贡献 (Ionic Contribution)**: 来自原子核电荷的简单求和。
    $$P_{ion} = \frac{1}{\Omega} \sum_i Z_i r_i$$
    *注意：ABACUS 会自动处理原子坐标的边界条件，但为了直观，建议将原子坐标置于晶胞中心。*

2.  **电子贡献 (Electronic Contribution / Berry Phase)**:
    这是计算的核心。输出值通常以“电子相位” ($\phi$) 的形式给出，单位通常是 $2\pi$ 的倍数或者直接转换为电荷单位。

    若输出为相位 $\phi$（弧度），其对应的极化强度 $P_{elec}$ 为：
    $$P_{elec} = \frac{e \mathbf{R}}{2\pi \Omega} \phi$$
    其中 $\mathbf{R}$ 是沿极化方向的晶格矢量，$\Omega$ 是晶胞体积。

---

## 3.2 极化量子的确定与分支选择

这是本章最核心的物理概念。初学者常问：“为什么我算出的极化值和文献差了巨大的一截？” 答案通常在于 **极化量子 (Polarization Quantum)**。

### 3.2.1 极化的多值性 (Modulo $2\pi$)

根据 Berry Phase 理论，电子波函数的相位具有 $2\pi$ 的不确定性。这意味着计算出的极化强度 $P$ 并不是一个单一的数值，而是一系列相差 $n \cdot P_{quant}$ 的数值集合：

$$P = P_0 + n \cdot P_{quant} \quad (n = 0, \pm 1, \pm 2, ...)$$

其中 $P_{quant}$ 被称为极化量子，其大小由晶格几何决定：
$$P_{quant} = \frac{e \mathbf{R}}{\Omega}$$
对于正交晶系，沿某一晶轴长度 $L$ 的极化量子简单地等于 $e/S$，其中 $S$ 是垂直于该轴的截面积。

### 3.2.2 绝热路径法 (Adiabatic Path)

为了消除 $n$ 的不确定性，我们不能直接比较铁电相和顺电相的计算结果，因为它们可能落在不同的“分支”上。必须构建一条 **绝热路径**。

**操作步骤：**
1.  **确定参考相**：选择高对称性的顺电相（通常具有中心反演对称，极化为 0）。
2.  **插值结构**：在顺电相（$\lambda=0$）和铁电相（$\lambda=1$）之间线性插值生成 5-7 个中间结构。
3.  **批量计算**：对每一个结构进行 Berry Phase 计算（SCF -> NSCF）。
4.  **连接数据点**：
    *   将所有结果画在 $P - \lambda$ 图上。
    *   由于每个点都有多值性（纵向重复出现），你需要选择一条 **连续平滑** 的曲线连接 $\lambda=0$ 到 $\lambda=1$ 的点。
    *   **判定标准**：物理上，极化在绝热形变过程中不应发生突变。

> **专家提示**：
> ABACUS 的 LCAO 基组在处理这种多结构计算时非常有优势，因为其基组的局域性使得 Berry Curvature 的计算通常比平面波方法更稳定，且对 K 点网格的收敛速度较快。但即便如此，仍建议在 `KPT` 文件中保证沿极化方向有足够高的 K 点密度。

---

## 3.3 计算自发极化强度 ($P_s$)

一旦你通过绝热路径确立了正确的分支，自发极化强度的计算就变得简单了。

### 3.3.1 计算公式

自发极化 $P_s$ 定义为铁电相极化与顺电相极化的差值：

$$P_s = | \Delta P | = | P(\lambda=1) - P(\lambda=0) |$$

在实际操作中，如果顺电相具有中心反演对称性，其 $P(\lambda=0)$ 理论上为 0（或 $0.5 P_{quant}$，取决于原点选取）。此时：

$$P_s = | P_{ferro}^{corrected} |$$

这里的 $P_{ferro}^{corrected}$ 是指通过绝热路径“追踪”到的那个特定分支的值，而不是软件直接输出的任意模数值。

### 3.3.2 结果验证

*   **单位转换**: 确保最终单位统一。ABACUS 输出可能基于原子单位 (a.u.)，而文献常用 $\mu C/cm^2$ 或 $C/m^2$。
    *   $1 \text{ electron}/Bohr^2 \approx 57.2 \text{ C}/m^2$ (需根据具体输出单位仔细换算)。
*   **Born Effective Charge (BEC)**: 如果你观察到极化随位移的变化率（斜率）远大于名义电荷（Nominal Charge），这正是铁电体的特征——巨大的玻恩有效电荷导致的。这可以作为结果合理性的辅助判据。

---

## 附录：常见问题与进阶建议

### A.1 K点收敛性 (Critical)
Berry Phase 本质上是波函数在倒空间沿某一方向的积分。因此，**沿极化测量方向的 K 点密度必须非常高**。
*   例如，若计算沿 z 轴的极化，`KPT` 设置建议为 `4 4 20` 或更高，而不是均匀的 `8 8 8`。
*   如果 K 点不足，结果会表现为巨大的随机跳跃。

### A.2 金属体系警告
**Berry Phase 极化计算仅适用于绝缘体或半导体（有带隙体系）。**
如果你尝试对金属（如 bcc Fe）进行此计算，程序可能会报错或输出无物理意义的随机数。这是因为金属在费米面处没有能隙，导致绝热演化条件被破坏。对于金属体系的 Berry Curvature 相关计算（如反常霍尔电导 AHC），需要使用完全不同的后处理方法。

### A.3 对称性的陷阱
在 `INPUT` 中设置 `symmetry 1` 可能会导致 ABACUS 强制将电荷密度对称化，从而人为地抹除微小的极化畸变。在进行铁电极化计算时，**强烈建议设置 `symmetry 0`**，以允许电子云自由弛豫以适应晶格畸变。