# 第四章：自旋分辨的电子结构分析

在上一章中，我们可能已经通过自洽计算得到了体系的总磁矩。然而，对于材料物理研究者而言，仅仅知道一个总磁矩数值（例如 "2.0 $\mu_B$"）是远远不够的。我们需要知道这些磁矩是由哪些轨道贡献的？自旋向上和向下的电子在能量空间是如何分布的？是否存在半金属（Half-metal）特性？

本章将深入 ABACUS 的输出文件，指导你如何处理双通道（Two-channel）数据，从态密度（DOS）、能带（Bands）和电子局域函数（ELF）三个维度解析磁性材料的电子结构。

---

## 4.0 计算前的关键检查（Pre-calculation Check）

在进行分析之前，必须确保你的计算是正确的。磁性计算不仅是参数设置的问题，更涉及物理原理的正确应用。

### 1. 对称性破缺与初始磁矩
**这是新手最容易犯的错误**：如果你在 `INPUT` 中开启了 `nspin = 2`，但在 `STRU` 文件中没有设置初始磁矩，或者初始磁矩设为 0，ABACUS 的自洽迭代（SCF）通常会收敛到一个非磁性（Non-magnetic）的解。
*   **物理原因**：DFT 迭代需要一个初始的“对称性破缺”来引导电子密度向磁性基态演化。
*   **操作**：在 `STRU` 文件的 `ATOMIC_POSITIONS` 块中，务必为磁性原子指定非零的初始磁矩。

### 2. 反铁磁（AFM）体系的特殊处理
对于反铁磁材料，总磁矩为 0，但局部磁矩不为 0。
*   **超胞（Supercell）**：如果原胞中只有一个磁性原子，你无法构建反铁磁态（因为它自己不能既是 Up 又是 Down）。必须构建超胞（如 $2 \times 1 \times 1$），使得晶胞内至少包含两个磁性原子。
*   **磁矩设置**：在 `STRU` 中手动设置相反的磁矩方向。
    ```abacus
    ATOMIC_POSITIONS
    Direct
    Fe  0.0  0.0  0.0  mag  4.0  // 自旋向上
    Fe  0.5  0.5  0.5  mag -4.0  // 自旋向下
    ```

### 3. 计算成本预警
开启 `nspin = 2` 后，Kohn-Sham 方程需要对 Spin 1 (Up) 和 Spin 2 (Down) 两个通道分别求解。
*   **时间成本**：计算耗时通常是 `nspin = 1` 的 **2倍** 左右。
*   **内存成本**：波函数和电荷密度的存储需求也会相应增加。

---

## 4.1 自旋态密度 (Spin-Resolved DOS)

态密度（DOS）是分析磁性最直观的工具。在自旋极化计算中，ABACUS 会输出两组 DOS 数据。

### 4.1.1 参数设置与输出文件
在 `INPUT` 文件中确保开启 DOS 计算：
```abacus
calculation  scf
nspin        2      // 开启自旋极化
out_dos      1      // 输出态密度
dos_sigma    0.05   // 高斯展宽宽度 (eV)
```

计算完成后，输出目录（`OUT.suffix/`）下会生成以下关键文件：
*   **`DOS1_smearing.dat`**: 自旋向上（Spin Up / Majority Spin）的态密度。
*   **`DOS2_smearing.dat`**: 自旋向下（Spin Down / Minority Spin）的态密度。

### 4.1.2 数据处理与绘图逻辑
为了直观展示磁性，学术界通用的绘图标准是“镜像 DOS 图”：
1.  **读取数据**：两份文件格式相同，第一列为能量（Energy），第二列为总 DOS（Total DOS）。
2.  **数据变换**：
    *   保持 `DOS1` 的数值不变（正值）。
    *   将 `DOS2` 的数值乘以 **-1**（变为负值）。
3.  **绘图**：以能量为 X 轴，DOS 为 Y 轴。
    *   $Y > 0$ 区域代表 Spin Up。
    *   $Y < 0$ 区域代表 Spin Down。

### 4.1.3 物理分析
观察绘制出的镜像 DOS 图：
*   **非磁性**：上下完全对称（镜像重合）。
*   **铁磁性（FM）**：上下不对称，且费米面处的积分差值对应总磁矩。
*   **半金属（Half-metal）**：一个通道在费米面处有 DOS（导电），另一个通道在费米面处 DOS 为 0（绝缘）。这是自旋电子学器件的理想特性。

---

## 4.2 自旋能带结构 (Spin-Resolved Bands)

能带结构描述了电子在动量空间（k空间）的色散关系。磁性会导致能带发生交换分裂（Exchange Splitting）。

### 4.2.1 参数设置与输出文件
在 `INPUT` 文件中设置：
```abacus
calculation  scf    // 先做 scf
// ... 完成后修改为 ...
calculation  nscf   // 非自洽计算用于画能带
nspin        2
out_band     1      // 输出能带
```
*注意：能带计算通常需要指定高对称点路径（在 `KPT` 文件中设置）。*

输出文件通常为：
*   **`BANDS_1.dat`**: 自旋向上能带数据。
*   **`BANDS_2.dat`**: 自旋向下能带数据。

### 4.2.2 数据可视化
使用 ABACUS 提供的辅助脚本（如 `gene_band_dat.py`，如果你的版本包含此工具）或自行编写 Python 脚本处理数据。

**绘图策略**：
*   通常将 Spin Up 绘制为红色实线，Spin Down 绘制为蓝色虚线（或反之）。
*   将两条能带画在同一张图上进行对比。

### 4.2.3 关键特征分析
1.  **能带分裂**：观察同一轨道的能带在能量轴上的错位。分裂的大小反映了交换相互作用的强弱。
2.  **半金属特性识别**：
    *   检查费米能级（$E_F$）是否穿过某一自旋通道的能带。
    *   **Case A**: Spin Up 穿过 $E_F$（金属），Spin Down 在 $E_F$ 处有带隙（半导体/绝缘体） $\rightarrow$ **半金属**。
    *   **Case B**: 两者都穿过 $E_F$ $\rightarrow$ **铁磁金属**。
    *   **Case C**: 两者都有带隙 $\rightarrow$ **磁性半导体/绝缘体**。

---

## 4.3 实空间分析：电子局域函数 (ELF)

除了能量和动量空间，我们还可以在实空间（Real Space）观察自旋分布。电子局域函数（ELF）可以帮助我们理解成键性质和孤对电子分布。

### 4.3.1 参数设置
在 `INPUT` 文件中开启 ELF 输出：
```abacus
out_elf      1
```

### 4.3.2 输出文件解析
当 `nspin = 2` 时，ABACUS 会生成区分自旋的 Cube 文件（文件名可能因版本略有差异，通常如下）：
*   **`ELF_SPIN1.cube`**: 自旋向上电子的局域化程度。
*   **`ELF_SPIN2.cube`**: 自旋向下电子的局域化程度。
*   *(有时也会输出总的 `ELF.cube`)*

### 4.3.3 可视化与分析 (VESTA 实战)
推荐使用 **VESTA** 软件进行可视化：
1.  **导入**：将 `ELF_SPIN1.cube` 拖入 VESTA。
2.  **等值面（Isosurface）**：设置一个较高的等值面数值（如 0.7 或 0.8）。
3.  **对比**：
    *   分别观察 Spin 1 和 Spin 2 的空间分布。
    *   对于磁性原子（如 Fe, Co, Ni），你会发现 $d$ 轨道的 ELF 分布在两个自旋通道中显著不同。
    *   **自旋极化空间分布**：你甚至可以通过工具（如 `chgdiff.py` 脚本，需自备）计算 `CHG_SPIN1.cube` - `CHG_SPIN2.cube` 得到自旋密度差（Spin Density），直接画出“哪里是磁性”的云图。

---

## 总结：数据处理清单

| 分析维度 | 关注文件 (Spin Up) | 关注文件 (Spin Down) | 核心技巧 |
| :--- | :--- | :--- | :--- |
| **DOS** | `DOS1_smearing.dat` | `DOS2_smearing.dat` | Down 通道乘 -1 绘制镜像图 |
| **能带** | `BANDS_1.dat` | `BANDS_2.dat` | 双色叠加绘制，寻找半金属特征 |
| **ELF** | `ELF_SPIN1.cube` | `ELF_SPIN2.cube` | VESTA 等值面分析，对比空间分布差异 |

**专家提示**：在处理所有数据时，请务必确认费米能级（Fermi Energy）的位置。ABACUS 的 `DOS` 文件通常是绝对能量，绘图时建议将能量轴平移，使 $E - E_F = 0$ 位于原点，方便阅读。