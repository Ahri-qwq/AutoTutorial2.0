# 第一章：自旋极化计算基础与物理图像

在开始真正的 ABACUS 实战计算之前，我们必须先构建正确的物理图像。对于许多初学者来说，最常见的陷阱不是报错，而是程序“成功”运行结束，却输出了一个完全错误的非磁性基态。

本章将带你理解为什么要开启自旋极化（Spin Polarization），开启后对计算资源意味着什么，以及如何避免掉入“非磁性陷阱”。

---

## 1.1 物理概念：自旋、磁序与对称性破缺

在标准的非自旋（Non-spin-polarized）DFT 计算中，我们假设每个空间轨道都被一对自旋相反（自旋向上 $\uparrow$ 和自旋向下 $\downarrow$）的电子占据，且它们的空间波函数完全相同。此时，体系的总磁矩强制为零。

然而，对于过渡金属（如 Fe, Co, Ni）、稀土元素、自由基或某些缺陷体系，自旋向上和自旋向下的电子数并不相等，或者它们在空间上的分布不同。这就需要开启**自旋极化计算**。

### 1.1.1 核心机制：对称性破缺（Symmetry Breaking）
这是本章最重要的概念。

Kohn-Sham 方程的求解是一个自洽迭代（SCF）过程。如果你不告诉程序“这个体系可能有磁性”，程序通常会从一个非磁性的初始电荷密度开始迭代。由于非磁性态通常也是势能面上的一个极值点（虽然可能是鞍点或局域极小值），迭代过程极易“卡”在这个非磁性解上，导致你算出了一个磁矩为 0 的铁原子。

**专家经验法则**：
> **初始磁矩绝对不能设为 0。**
> 必须人为地引入“对称性破缺”。即在计算开始时，通过 `STRU` 文件明确指定原子的初始磁矩（Initial Magnetic Moment），给体系一个初始的“磁性猜测”。哪怕你的猜测值（比如 1.0 $\mu_B$）与最终真实值（比如 2.2 $\mu_B$）不符，这个非零的初始值也是引导 SCF 收敛到磁性基态的关键“火种”。

### 1.1.2 铁磁（FM）与反铁磁（AFM）
- **铁磁 (Ferromagnetic)**: 所有磁性原子的磁矩方向相同。通常在原胞（Primitive Cell）中即可计算。
- **反铁磁 (Anti-Ferromagnetic)**: 相邻原子的磁矩方向相反（如 $\uparrow \downarrow$），总磁矩可能为零，但局部磁矩不为零。

**关于 AFM 的特殊提示**：
反铁磁计算对结构建模有特殊要求。如果晶体的化学原胞中只包含一个磁性原子，你必须构建**超胞（Supercell）**。
*   **原因**: 周期性边界条件强制要求原胞在平移后完全重合。如果原胞里只有一个原子，它不可能既是 Spin-up 又是 Spin-down。
*   **做法**: 扩胞（例如 $2 \times 1 \times 1$），使得超胞内包含两个磁性原子。然后在 `STRU` 文件中，需手动区分这两个原子（即使它们是同一种元素），例如分别标记为 `Fe1` 和 `Fe2`，并分别赋予 `+m` 和 `-m` 的初始磁矩。

---

## 1.2 全局参数设置与计算成本

在 ABACUS 中开启自旋极化非常简单，但它对计算资源的影响是立竿见影的。

### 1.2.1 开启自旋极化 (`INPUT` 文件)

在 `INPUT` 文件中，通过参数 `nspin` 控制自旋模式。

```bash
INPUT_PARAMETERS
# ... 其他参数 ...

# 开启共线自旋极化计算
nspin      2      # 1: 非自旋 (默认); 2: 共线自旋; 4: 非共线自旋(SOC)

# ... 其他参数 ...
```

*   **`nspin 1` (默认)**: 强制自旋简并，$\rho_{\uparrow}(r) = \rho_{\downarrow}(r)$。适用于非磁性半导体、绝缘体或非磁性金属。
*   **`nspin 2`**: 共线自旋极化（Collinear Spin-polarized）。电子密度分为 $\rho_{\uparrow}$ 和 $\rho_{\downarrow}$ 两部分独立处理。适用于大多数铁磁、反铁磁材料。

### 1.2.2 计算成本分析
当你设置 `nspin 2` 后，请务必调整你对计算时间的预期：

1.  **Kohn-Sham 方程加倍**: 程序需要分别求解自旋向上和自旋向下的哈密顿量矩阵。
2.  **内存消耗增加**: 存储波函数和电荷密度的数组大小几乎翻倍。
3.  **时间成本**:
    > **计算耗时 $\approx$ 2 倍于非自旋计算**。
    > 在申请超算机时或规划任务排队时，请务必将此因素考虑在内。

### 1.2.3 结果数据的物理图像
计算完成后，ABACUS 会输出针对两个自旋通道的数据。在后处理（如绘制态密度 DOS 或能带结构）时，请注意区分：

*   **Spin 1 (or Up)**: 自旋向上通道。
*   **Spin 2 (or Down)**: 自旋向下通道。

**绘图惯例**:
为了直观展示磁性，学术界通用的绘图标准是：
- 将 **Spin 1 (Up)** 的 DOS 绘制在 Y 轴**正半轴**。
- 将 **Spin 2 (Down)** 的 DOS 绘制在 Y 轴**负半轴**。
- 如果上下对称，说明体系最终收敛到了非磁性态（净磁矩为 0）；如果不对称，则存在净磁矩。

---

### 本章小结
1.  **必须打破对称性**: 计算磁性体系，必须在 `STRU` 中提供非零的初始磁矩猜测，否则极易得到错误的非磁性解。
2.  **AFM 需扩胞**: 反铁磁计算通常需要构建超胞，并手动设置正负交替的磁矩。
3.  **资源预估**: 开启 `nspin 2` 后，计算时间约为原来的 2 倍。

在下一章中，我们将进入实战环节，手把手教你编写 `STRU` 文件中的磁矩设置以及处理具体的输入文件。