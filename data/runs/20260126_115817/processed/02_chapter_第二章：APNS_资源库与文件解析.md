# 第二章：APNS 资源库与文件解析

在上一章中，我们深入探讨了 ABACUS 的 LCAO（原子轨道线性组合）基组原理。理解了“数值原子轨道”是什么之后，摆在每位新用户面前最现实的问题便是：“我去哪里下载这些文件？”以及“面对一堆文件名类似的文件，我该选哪一个？”。

本章将聚焦于 ABACUS 官方推荐的 **APNS-PPORB** 资源库，这是目前解决赝势与轨道“匹配痛点”的最佳方案。

---

## 2.1 APNS-PPORB 捆绑包概览

在 LCAO 计算中，**赝势（Pseudopotential）**与**数值原子轨道（Numerical Atomic Orbitals, NAO）**必须严格匹配。这种匹配不仅指交换关联泛函（如 PBE）的一致，更涉及生成轨道时所使用的赝势必须与计算时使用的赝势完全相同。为了解决用户手动匹配的繁琐与风险，ABACUS 开发团队推出了 **APNS-PPORB**（Atomic Pseudo-potentials and Numerical Series）项目。

### 2.1.1 什么是 APNS-PPORB？
APNS-PPORB 是一个经过系统化验证的标准化数据库，它将赝势文件（通常为 `.upf` 格式）与轨道文件（`.orb` 格式）进行了打包。

*   **覆盖范围**：目前的 v1 版本覆盖了元素周期表中从 **H (Z=1)** 到 **Bi (Z=83)** 的大部分主族及过渡金属元素。
*   **排除元素**：暂不包含 镧系（La-Lu）和 锕系（Ac-Lr）元素。对于这些强关联体系，通常需要专门定制的轨道或使用平面波（PW）基组。
*   **验证标准**：该库中的轨道经过了 Delta Test 等高通量测试标准的检验，确保了在绝大多数常规材料计算中的精度与可移植性。

### 2.1.2 获取渠道
作为 ABACUS 的用户，你应该从以下官方或受信任的渠道获取资源：

1.  **AIS-Square (Bohrium 社区)**：
    *   这是 DeepModeling 社区的首选资源站。在“数据集”或“ABACUS 专区”通常可以找到最新版本的 `APNS-PPORB` 压缩包。
2.  **GitHub 官方仓库**：
    *   访问 ABACUS 的 GitHub 组织（`abacus-modeling`），在相关的资源仓库（如 `abacus-develop` 的 `tests` 目录或专门的 `pseudopotentials` 仓库）中可以找到。
3.  **ABACUS 官网**：
    *   官方文档通常会提供经过筛选的下载链接，指向经过验证的稳定版本。

### 2.1.3 高级用户扩展：CP2K 接口
对于 APNS 库尚未覆盖的特殊元素，或者需要极高精度定制的场景，ABACUS 支持使用 CP2K 的 `MOLOPT` 轨道生成方案。
*   **原理**：ABACUS 的数值轨道格式与 CP2K 的基组在数学形式上高度兼容。
*   **方法**：高级用户可以使用 ABACUS 提供的辅助工具（如 `ptg_dft` 相关的转换脚本），将 CP2K 的基组参数转换为 ABACUS 可读的 `.orb` 格式。这为 ABACUS 提供了近乎无限的基组扩展能力。

---

## 2.2 解读文件名中的“密码”

下载完资源包后，你会发现每个元素都有多个轨道文件。选错文件不仅可能导致计算报错，更可能导致结果物理意义的丧失。

让我们以一个典型的文件名 **`C_gga_9au_100Ry_3s3p2d.orb`** 为例，拆解其中的关键信息。

### 2.2.1 文件名结构拆解

| 片段 | 含义 | 物理意义与教授点评 |
| :--- | :--- | :--- |
| **`C`** | **元素符号** | 碳元素。务必确保与 `STRU` 文件中的原子类型对应。 |
| **`gga`** | **泛函类型** | 通常指广义梯度近似（GGA），在 ABACUS 中默认对应 PBE 泛函。**注意**：轨道文件的泛函类型必须与赝势文件（`.upf`）一致。 |
| **`9au`** | **截断半径 ($r_{cut}$)** | **关键参数**。表示数值原子轨道的空间延展范围（单位：Bohr/a.u.）。<br>• **物理含义**：轨道在 9.0 a.u. 处被强制截断为 0。<br>• **计算影响**：半径越大，精度越高，但哈密顿量矩阵越稠密，计算越慢。 |
| **`100Ry`** | **推荐截断能** | **参考参数**。表示生成该轨道时使用的参考能量截断值（`ecutwfc`）。<br>• **使用建议**：在 `INPUT` 文件中设置 `ecutwfc` 时，建议**不低于**此数值。如果轨道是按 100Ry 生成的，而你只用 50Ry 计算，可能会出现“鬼态”或积分精度不足。 |
| **`3s3p2d`** | **轨道构型** | **精度核心**。表示基组的大小（Zeta）。<br>• **含义**：该轨道包含 3 条 s 轨道，3 条 p 轨道，2 条 d 轨道。<br>• **对应关系**：类似于量子化学中的 TZDP（Triple-Zeta + Double Polarization）。 |

### 2.2.2 深入解析：如何选择合适的轨道？

在实战中，你通常会面临 `2s2p1d` 和 `3s3p2d` 等多种选择。以下是基于经验的决策逻辑：

#### 1. 截断半径（Radius, e.g., 6au vs 9au）
*   **6au - 7au**：适用于高压计算或致密结构。原子间距很小，过大的半径会导致相邻原子的轨道过度重叠，引起线性相关性问题（Linear Dependency），导致 SCF 不收敛。
*   **8au - 9au**：**标准推荐值**。适用于大多数常规体相材料和表面计算，兼顾了精度与稀疏性。
*   **> 10au**：适用于团簇、分子或低维材料。

#### 2. 轨道构型（Configuration, e.g., 2s2p1d vs 3s3p2d）
这是平衡计算成本（内存与时间）与精度的核心杠杆。

*   **DZP 级 (Double-Zeta Polarized)**：
    *   *典型标识*：`2s2p1d` (对于 C/O 等第二周期元素)。
    *   *适用场景*：**高通量筛选、大体系（>200原子）、结构弛豫初猜**。这是性价比最高的选择，通常能得到可靠的晶格常数和键长。
*   **TZDP 级 (Triple-Zeta Double Polarized)**：
    *   *典型标识*：`3s3p2d`。
    *   *适用场景*：**最终态密度（DOS）计算、能带计算、对精度要求极高的能量对比**。
    *   *代价*：计算量通常是 DZP 的 2-4 倍。

### 2.2.3 实战案例：INPUT 文件中的关联设置

当你选择了 `C_gga_9au_100Ry_3s3p2d.orb` 文件后，你的 `INPUT` 文件应该如何配合？

```INPUT
INPUT_PARAMETERS
# ... 其他参数 ...

basis_type      lcao        # 必须开启 LCAO 模式

# 能量截断值
ecutwfc         100         # 建议 >= 文件名中的 100Ry
                            # 如果设为 80，虽然能跑，但精度会受损

# 轨道截断半径控制 (高级)
# rcut          9.0         # 默认情况下，ABACUS 会读取 .orb 文件头部的 rcut。
                            # 如果在此处设置 rcut < 9.0，程序会进一步截断轨道；
                            # 如果设置 rcut > 9.0，无效，因为轨道本身只有 9.0 长。
```

### 专家提示 (Pro-Tip)
> **不要混用不同精度的轨道！**
> 在同一个计算中，如果对 A 元素使用了极高精度的 `3s3p2d` (TZDP)，而对 B 元素使用了低精度的 `1s1p` (SZ)，会导致电荷描述的不平衡，进而产生严重的电荷转移误差。请尽量保持所有元素的基组处于同一精度水平（如全员 DZP 或全员 TZDP）。

---

**下一章预告**：
搞定了资源文件，我们将正式进入**第三章：结构文件的构建与对称性**。我们将学习如何手写 `STRU` 文件，以及如何利用工具自动生成它。