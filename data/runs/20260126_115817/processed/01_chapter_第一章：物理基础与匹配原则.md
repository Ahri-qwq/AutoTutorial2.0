# 第一章：物理基础与匹配原则

> **作者按**：
> 在我们急于编写 `INPUT` 文件并敲下运行命令之前，我必须先按下暂停键。作为 ABACUS 的开发者，我见过太多用户因为忽视本章的内容而浪费数周时间——他们得到了收敛的结果，但物理意义却是错误的。
>
> ABACUS 的强大之处在于其独特的“双基组”架构（平面波 PW 与数值原子轨道 LCAO）。理解这两者的区别，特别是 LCAO 模式下**赝势与轨道的严格匹配关系**，是你成为高阶用户的投名状。

---

## 1.1 赝势与数值原子轨道 (NAO) 概论

在密度泛函理论 (DFT) 计算中，我们很少直接处理全电子波函数，因为原子核附近的电子波函数振荡极其剧烈，需要消耗巨大的计算资源。为了解决这个问题，我们引入了两个核心概念：**赝势 (Pseudopotential)** 和 **基组 (Basis Set)**。

### 1.1.1 赝势：平滑化的艺术
赝势的作用是将原子核与内层电子（Core Electrons）“打包”成一个有效势场，只显式计算价电子（Valence Electrons）。
*   **物理图像**：在某个截断半径 $r_c$ 之外，赝波函数与全电子波函数完全重合；在 $r_c$ 之内，赝波函数是平滑无节点的。
*   **ABACUS 的选择**：
    *   **模守恒赝势 (Norm-Conserving, NC)**：特别是 **ONCV (Optimized Norm-Conserving Vanderbilt)** 赝势，是目前 ABACUS **最推荐**使用的类型。它在精度和效率之间取得了极佳的平衡，且与 ABACUS 的 LCAO 算法兼容性最好。
    *   **超软赝势 (USPP) / PAW**：虽然在平面波软件（如 VASP/QE）中很流行，但在 ABACUS 的 LCAO 模式下，处理超软赝势涉及复杂的辅助电荷积分。**对于初学者和绝大多数生产环境，请务必坚持使用 ONCV 规范的模守恒赝势。**

### 1.1.2 数值原子轨道 (NAO)：LCAO 的基石
ABACUS 的核心竞争力在于其支持 **LCAO (Linear Combination of Atomic Orbitals)** 模式。与平面波 (PW) 不同，LCAO 使用原子轨道作为基函数来展开波函数。

*   **PW (平面波)**：普适性强，精度易控制（仅依赖 `ecutwfc`），但对于大体系（>500 原子），计算量呈 $O(N^3)$ 增长。
*   **LCAO (数值原子轨道)**：将计算量降低至 $O(N)$ 量级，极适合千原子级的大规模模拟。但它需要额外的输入文件——**轨道文件**。

这些轨道是“数值”的，意味着它们不是解析的高斯函数，而是定义在径向网格上的数值解。

### 1.1.3 关键参数设置 (`INPUT`)

在 ABACUS 的 `INPUT` 文件中，通过 `basis_type` 参数来决定计算模式：

```bash
INPUT_PARAMETERS
# ... 其他参数 ...

# 核心参数：基组类型
basis_type      lcao    # 推荐：使用数值原子轨道模式，效率高
# basis_type    pw      # 可选：使用平面波模式，用于基准测试 (Benchmark)

# ... 其他参数 ...
```

> **开发者提示**：
> 如果你设置 `basis_type pw`，你只需要赝势文件（`.upf` 或 `.vsp`）。
> 如果你设置 `basis_type lcao`，你**必须**同时提供赝势文件和对应的轨道文件（`.orb`）。

---

## 1.2 核心铁律——匹配性原则

这是本教程最重要的一条警告：**在 LCAO 模式下，严禁“乱点鸳鸯谱”。**

### 1.2.1 为什么必须匹配？
很多初学者会问：“我可以用 VASP 的赝势配 ABACUS 的轨道吗？”或者“我可以用 PBE 的赝势配 LDA 的轨道吗？”
答案是：**绝对不行**。

物理原因如下：
1.  **生成的同源性**：ABACUS 的数值原子轨道（NAO）是**基于特定的赝势求解原子薛定谔方程生成的**。
    *   轨道 $\phi(r)$ 的形状完全取决于它感受到的势场 $V_{pseudo}(r)$。
    *   如果你在计算中使用了赝势 A，却使用了基于赝势 B 生成的轨道，这就好比用“张三的钥匙”去开“李四的锁”，波函数在原子核附近的投影将完全错误。
2.  **完备性与鬼态**：不匹配的轨道-赝势组合会导致基组完备性严重受损，甚至在带隙中引入非物理的“鬼态” (Ghost States)，导致自洽迭代 (SCF) 无法收敛或收敛到错误基态。

### 1.2.2 实践指南：如何确保匹配

在准备 `STRU` (结构文件) 时，你必须遵循以下标准流程：

1.  **认准标准库**：目前 ABACUS 官方强烈推荐使用 **SG15-ONCV** 赝势库及其配套的轨道库。
    *   赝势文件通常以 `.upf` 结尾（如 `Si_ONCV_PBE-1.0.upf`）。
    *   轨道文件通常以 `.orb` 结尾（如 `Si_gga_7au_100Ry_2s2p1d.orb`）。

2.  **文件名解读**：
    让我们解读一个典型的轨道文件名 `Si_gga_7au_100Ry_2s2p1d.orb`，其中包含了匹配的关键信息：
    *   `Si`: 元素。
    *   `gga` (或 `PBE`): 交换关联泛函。**必须与赝势的泛函一致**。
    *   `7au`: 截断半径。
    *   `100Ry`: 生成轨道时的能量截断。
    *   `2s2p1d`: 轨道构型（Zeta数）。

3.  **文件组织示例**：

建议在项目根目录下建立清晰的文件夹结构，并在 `INPUT` 中正确指定路径：

```text
Project_Folder/
├── INPUT
├── STRU
├── KPT
├── PP/              <-- 存放赝势文件
│   └── Si_ONCV_PBE-1.0.upf
└── ORB/             <-- 存放轨道文件 (仅 lcao 模式需要)
    └── Si_gga_7au_100Ry_2s2p1d.orb
```

**INPUT 文件设置：**
```bash
INPUT_PARAMETERS
# 指定文件夹路径（注意：末尾不要加 /，ABACUS 会自动处理，或者写相对路径）
pseudo_dir      ./PP
orbital_dir     ./ORB
basis_type      lcao
# ...
```

**STRU 文件设置 (原子种类部分)：**
```text
ATOMIC_SPECIES
# 元素名  原子质量  赝势文件名
Si       28.0855  Si_ONCV_PBE-1.0.upf

# 仅在 basis_type = lcao 时需要下方的区块
LCAO_ORBITALS
# 轨道文件名 (必须位于 orbital_dir 指定的目录下)
Si_gga_7au_100Ry_2s2p1d.orb
```

### 1.2.3 总结：匹配清单 (Checklist)

在提交任务前，请核对以下三点：
1.  [ ] **泛函匹配**：赝势是 PBE 的，轨道也必须是 PBE (GGA) 的。
2.  [ ] **源头匹配**：如果使用的是 SG15 的赝势，必须使用针对 SG15 赝势生成的轨道文件（通常官方网站或 DeepModeling 社区会打包提供）。
3.  [ ] **类型匹配**：`basis_type` 设为 `lcao` 时，`STRU` 文件中必须包含 `LCAO_ORBITALS` 字段。

> **下章预告**：
> 理解了物理匹配原则后，下一章我们将正式进入实战环节。我们将手把手教你编写 ABACUS 的三大输入文件：`INPUT`、`STRU` 和 `KPT`，并完成你的第一个自洽计算 (SCF)。