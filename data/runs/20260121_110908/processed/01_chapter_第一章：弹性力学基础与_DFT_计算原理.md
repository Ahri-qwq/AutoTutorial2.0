# 第一章：弹性力学基础与 DFT 计算原理

> **教授寄语**：
> 在按下回车键运行 ABACUS 之前，作为计算材料学家，我们必须先在脑海中构建清晰的物理图像。不要急于复制粘贴代码，弹性常数的计算本质上是模拟材料对微小形变的力学响应。本章我们将剥离代码细节，专注于“我们在算什么”以及“ABACUS 是如何计算它的”。

---

## 1.1 广义胡克定律与 Voigt 记号

在宏观力学实验中，我们拉伸一个弹簧，遵循 $F=kx$。在微观晶格尺度，当我们对晶胞施加微小的形变（应变，Strain）时，晶格内部会产生抵抗这种形变的力（应力，Stress）。在弹性极限内，这种关系由**广义胡克定律（Generalized Hooke's Law）**描述。

### 1.1.1 弹性刚度张量 (Stiffness Tensor)

应力 $\sigma$ 和应变 $\varepsilon$ 都是二阶张量（$3\times3$ 矩阵）。连接它们的系数是一个四阶张量，称为弹性刚度张量 $C_{ijkl}$：

$$ \sigma_{ij} = \sum_{k,l} C_{ijkl} \varepsilon_{kl} $$

这里，$i, j, k, l$ 的取值范围是 1 到 3（代表 x, y, z 方向）。这意味着 $C_{ijkl}$ 理论上有 $3^4 = 81$ 个分量。直接计算 81 个数显然是不切实际的，好在物理世界存在对称性。

### 1.1.2 Voigt 记号：从 81 到 36 到 21

由于应力张量和应变张量都是对称的（$\sigma_{ij}=\sigma_{ji}$），我们可以引入 **Voigt 记号** 将双下标简化为单下标，从而将四阶张量降维为 $6\times6$ 的矩阵。

**下标映射规则**：
- $11 \to 1$ (xx)
- $22 \to 2$ (yy)
- $33 \to 3$ (zz)
- $23, 32 \to 4$ (yz)
- $13, 31 \to 5$ (xz)
- $12, 21 \to 6$ (xy)

此时，胡克定律可以写成矩阵形式 $\boldsymbol{\sigma} = \mathbf{C} \boldsymbol{\varepsilon}$：

$$
\begin{pmatrix} \sigma_1 \\ \sigma_2 \\ \sigma_3 \\ \sigma_4 \\ \sigma_5 \\ \sigma_6 \end{pmatrix}
=
\begin{pmatrix}
C_{11} & C_{12} & C_{13} & C_{14} & C_{15} & C_{16} \\
C_{21} & C_{22} & C_{23} & C_{24} & C_{25} & C_{26} \\
C_{31} & C_{32} & C_{33} & C_{34} & C_{35} & C_{36} \\
C_{41} & C_{42} & C_{43} & C_{44} & C_{45} & C_{46} \\
C_{51} & C_{52} & C_{53} & C_{54} & C_{55} & C_{56} \\
C_{61} & C_{62} & C_{63} & C_{64} & C_{65} & C_{66}
\end{pmatrix}
\begin{pmatrix} \varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \varepsilon_4 \\ \varepsilon_5 \\ \varepsilon_6 \end{pmatrix}
$$

利用热力学势函数的性质，我们知道 $C_{ij} = C_{ji}$，这使得独立分量最多只有 21 个（三斜晶系）。

### 1.1.3 晶体对称性的力量

对于高对称性晶体，独立分量的数量会进一步大幅减少。这是我们在查看 ABACUS 输出结果时进行**自洽性检查**的重要依据。

以常见的**立方晶系 (Cubic System)**（如 Si, Cu, Diamond）为例，其独立分量仅有 3 个：$C_{11}, C_{12}, C_{44}$。

$$
\mathbf{C}_{\text{cubic}} =
\begin{pmatrix}
C_{11} & C_{12} & C_{12} & 0 & 0 & 0 \\
C_{12} & C_{11} & C_{12} & 0 & 0 & 0 \\
C_{12} & C_{12} & C_{11} & 0 & 0 & 0 \\
0 & 0 & 0 & C_{44} & 0 & 0 \\
0 & 0 & 0 & 0 & C_{44} & 0 \\
0 & 0 & 0 & 0 & 0 & C_{44}
\end{pmatrix}
$$

> **风险提示：晶体取向陷阱**
> 上述矩阵形式仅在晶胞基矢量与笛卡尔坐标轴 ($x, y, z$) 对齐时成立。
> 很多数据库（如 Materials Project）可能会为了标准化（IEEE 176/1987 标准）而旋转晶体。如果你计算出的矩阵非零元位置混乱，首先请检查你的结构文件（CIF/POSCAR/STRU）中晶格矢量是否已旋转，而不是怀疑计算精度。

---

## 1.2 应力-应变法 (Stress-Strain Method)

在第一性原理计算中，主要有两种方法求解 $C_{ij}$：
1.  **能量-应变法 (Energy-Strain)**: 拟合能量随应变的二次曲线。
2.  **应力-应变法 (Stress-Strain)**: 拟合应力随应变的线性关系。

本教程采用 **应力-应变法**，这也是 `abacustest` 工作流采用的方法。相比能量法，它通常对 K 点采样的收敛速度更快，且能同时获得更多信息。

### 1.2.1 计算核心逻辑：两个阶段

要得到准确的弹性常数，必须严格区分两个计算阶段。混淆这两个阶段是初学者最容易犯的错误。

#### 阶段一：原始结构优化 (Equilibrium State)
在施加应变之前，晶体必须处于**零应力**的平衡态。如果初始结构本身就有巨大的残余应力，胡克定律的线性假设可能失效，且计算出的弹性常数物理意义存疑。

*   **物理目标**: 寻找势能面上的局部极小值，使应力张量 $\sigma \approx 0$。
*   **ABACUS 关键参数**:
    *   `calculation` = `cell-relax` (变胞优化)
    *   此阶段同时优化**晶格矢量**和**原子位置**。

#### 阶段二：变形结构计算 (Deformed State)
在平衡结构的基础上，人为施加一组预定义的微小应变（通常在 $\pm 1\%$ 范围内），然后计算由于形变产生的应力。

*   **物理目标**: 计算 $\sigma(\varepsilon)$。
*   **ABACUS 关键参数**:
    *   `calculation` = `relax` (定胞优化) 或 `scf` (自洽计算)
    *   **注意**: 此阶段**绝对不能**使用 `cell-relax`，因为我们的目的就是固定住变形后的晶胞形状，去测量它受到的力。如果开启变胞，晶胞会直接变回平衡态，应变消失。

### 1.2.2 离子弛豫：Clamped vs. Relaxed Ions

在阶段二中，当我们拉伸晶胞后，原子该怎么办？这里引出了一个极其重要的概念，对应 `abacustest` 中的关键参数。

1.  **离子钳制 (Ion-clamped / Frozen ions)**:
    *   **物理图像**: 晶胞变形瞬间，原子按比例均匀位移，但保持相对坐标（Direct coordinates）不变。就像把原子“钉”在晶格上一起拉伸。
    *   **对应操作**: ABACUS 运行 `scf` 计算，不进行离子步弛豫。
    *   **abacustest 参数**: `--norelax`
    *   **适用场景**: 极高频响应（原子来不及移动）。

2.  **离子弛豫 (Relaxed ions)**:
    *   **物理图像**: 晶胞变形后，固定晶胞边界，但允许内部原子根据受力微调位置，直到内部原子受力为零。这对应于实验测量的静态或低频弹性常数。
    *   **对应操作**: ABACUS 运行 `relax` 计算（固定晶胞，动原子）。
    *   **abacustest 参数**: 默认行为（**不**加 `--norelax`）。
    *   **结论**: **绝大多数情况下，我们需要的都是 Relaxed ions 的结果。**

### 1.2.3 自动化工作流 (Workflow)

手动生成几十个变形结构并提取应力极为繁琐且易错。本教程推荐使用 **Workflow A**。

*   **Workflow A (推荐)**: 使用 `abacustest`。
    *   它自动处理：生成变形结构 $\to$ 生成 INPUT 文件 $\to$ 提交任务 $\to$ 收集应力 $\to$ 拟合 $C_{ij}$。
    *   它不仅简化了操作，还规范了上述的“阶段二”流程，防止人为设置错误的 `calculation` 类型。

*   **Workflow B (了解)**: 使用 Python 脚本 (`gene_dfm.py` 等)。
    *   这是早期的方法，虽然灵活性高，但需要用户手动管理文件目录和后处理，适合有特殊需求的高级用户。

---

**本章小结**
1.  弹性常数 $C_{ij}$ 是连接应力和应变的桥梁。
2.  利用对称性（Voigt 记号）可以将复杂张量简化为矩阵。
3.  **计算流程核心**：先做 `cell-relax` 得到零应力基态，再施加应变做 `relax` (固定晶胞) 得到应力响应。
4.  务必理解 **Relaxed ions** 的物理意义，这决定了我们在使用工具时是否开启优化开关。

下一章，我们将进入实战环节，使用 `abacustest` 亲手计算硅（Si）的弹性常数。