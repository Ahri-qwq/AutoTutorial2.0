# 第一章：物理基础与测试策略

欢迎来到 ABACUS 实战教程的第一章。

很多初学者在拿到软件后，往往急于修改 `INPUT` 文件里的参数让程序“跑起来”。但在计算材料学中，“跑通”和“算对”之间隔着巨大的鸿沟。作为一款同时支持**平面波 (Plane Wave, PW)** 和 **数值原子轨道 (LCAO)** 双基组的软件，ABACUS 赋予了用户极大的灵活性，但也带来了选择的困惑。

本章将不涉及复杂的代码操作，而是为你建立一套严谨的**基准测试（Benchmark）逻辑**。在动手计算前，你必须理解我们手中的“尺子”——基组——是如何工作的，以及如何通过控制变量法来验证计算结果的可靠性。

---

## 1.1 平面波 (PW) vs. 局域轨道 (LCAO)

在 ABACUS 的 `INPUT` 文件中，`basis_type` 是决定计算核心逻辑的最重要参数。它决定了薛定谔方程中的波函数 $\psi(r)$ 如何被数学表达。

### 1.1.1 平面波基组 (`basis_type = pw`)
平面波是固体物理中最经典的基组。它的数学形式是简单的 $e^{i\mathbf{G}\cdot\mathbf{r}}$。

*   **优势**：
    *   **完备性（Completeness）**：这是 PW 最大的优点。你只需要通过一个参数——**截断能 (`ecutwfc`)**——就能系统性地控制精度。只要 `ecutwfc` 足够大，平面波基组就能无限逼近真实波函数。
    *   **无偏见**：它均匀地覆盖整个空间，不依赖于原子的具体位置。
*   **劣势**：
    *   **计算昂贵**：为了描述原子核附近的剧烈振荡或真空区域（对于低维材料），需要大量的平面波，导致计算量急剧增加。

### 1.1.2 数值原子轨道基组 (`basis_type = lcao`)
LCAO 使用类似于原子轨道的函数（如 $s, p, d$ 轨道）作为基底。ABACUS 使用的是数值原子轨道（Numerical Atomic Orbitals, NAO）。

*   **优势**：
    *   **极高效率**：轨道只在原子附近存在（局域性），哈密顿量矩阵是稀疏的。这使得 ABACUS 能够处理数千甚至上万原子的体系，且计算速度通常比 PW 快 1-2 个数量级。
    *   **物理直观**：可以直接对应到化学键的概念。
*   **劣势**：
    *   **基组依赖性**：精度取决于你选择了哪一套轨道文件（.orb）。如果轨道选得不好，计算结果可能偏差很大。

### 1.1.3 变分原理与能量基准
根据密度泛函理论（DFT）的**变分原理**，在相同的哈密顿量下，基组越完备，计算得到的总能量越低（越接近真实基态）。

> **教授的经验法则**：
> 通常情况下，**PW 计算的能量会略低于 LCAO 计算的能量**（约 0.1 - 0.2 eV/atom）。
>
> 因此，我们的测试策略是：**以高精度的 PW 计算结果为“真值”（Ground Truth），来衡量 LCAO 基组的误差是否在可接受范围内。**

---

## 1.2 解读数值原子轨道 (.orb) 文件

在 LCAO 模式下，你需要为每种元素提供一个 `.orb` 文件。这些文件通常由 ABACUS 开发团队或社区提供（如 `SG15` 或 `Chen-Cheng` 库）。读懂文件名是选择基组的第一步。

### 1.2.1 文件名解剖学
以一个标准的硅元素轨道文件为例：
`Si_gga_7au_100Ry_2s2p1d.orb`

我们可以将其拆解为四个关键部分：

1.  **`Si` (元素)**: 适用元素。
2.  **`gga` (泛函类型)**: 生成该轨道时使用的交换关联泛函。
    *   **关键注意**：轨道文件的泛函类型最好与赝势文件（`.upf` 或 `.vsp`）一致，虽然混用有时能跑通，但不推荐。
3.  **`7au` (截断半径 $R_{cut}$)**: 轨道的空间范围。
    *   **物理含义**：轨道在 7.0 Bohr (原子单位) 处被截断为 0。
    *   **权衡**：$R_{cut}$ 越大，轨道重叠越多，精度越高，但计算矩阵越稠密，速度越慢。7au 是一个中等偏大的安全值；6au 较快；8au+ 极高精度。
4.  **`100Ry` (参考截断能)**:
    *   **物理含义**：这是生成该轨道时使用的能量截断值。
    *   **实战指导**：这提示你在 `INPUT` 文件中设置 `ecutwfc` 时，**建议不低于 100 Ry**。虽然设低了程序也能跑，但这会导致积分网格过于稀疏，无法准确描述该轨道的高频部分，产生“蛋箱效应”（Egg-box effect）误差。
5.  **`2s2p1d` (轨道配置)**: **这是判断精度的核心指标**。
    *   它表示该基组包含：2个 s 轨道，2个 p 轨道，1个 d 轨道。

### 1.2.2 如何判断基组精度（SZ, DZP, TZDP）
我们需要结合元素的价电子排布来看。以 Si ($3s^2 3p^2$) 为例，其价层是 s 和 p。

*   **SZ (Single Zeta)**: 最小基组。
    *   配置：`1s1p` (每个价层轨道只有 1 个径向函数)。
    *   特点：极快，但精度仅适用于定性分析或紧束缚模型预研。
*   **DZP (Double Zeta Polarized)**: 标准科研基组。
    *   配置：`2s2p1d` (每个价层 2 个径向函数 + 1 个极化轨道 d)。
    *   特点：**性价比之王**。大多数科研论文（能带、结构优化）使用此精度。
*   **TZDP / TZTP (Triple Zeta)**: 高精度基组。
    *   配置：`3s3p2d` 或更高。
    *   特点：用于对精度要求极高的计算（如态密度细节、弱相互作用），接近 PW 精度。

---

## 1.3 测试方案设计：控制变量法

在正式开始大规模计算前，必须进行收敛性和一致性测试。很多初学者容易陷入“乱调参数”的误区。

### 1.3.1 核心原则：控制变量
我们在对比 PW 和 LCAO，或者对比 DZP 和 TZDP 时，**只能**改变与基组相关的参数。

**必须保持严格一致的参数（不变量）：**
1.  **`pseudo_dir` & 赝势文件**：绝对不能换赝势！不同的赝势定义的内核不同，能量没有可比性。
2.  **K 点网格 (`kspacing` 或 `K_POINTS`)**：K 点密度必须一致。
3.  **晶体结构 (`STRU`)**：晶格常数和原子位置必须完全冻结。
4.  **`ecutwfc` (特殊情况)**：在 PW 计算中这是变量；但在 LCAO 对比测试中，建议固定在一个较高值（如 100 Ry），以排除积分网格带来的误差。

### 1.3.2 常见的 LCAO 误区（Warning）
> **误区**：我在使用 SZ (1s1p) 基组时发现精度不够，于是我把 `INPUT` 里的 `ecutwfc` 从 100 Ry 提高到 200 Ry，希望能提高精度。
>
> **真相**：**这是徒劳的。**
> 在 LCAO 模式下，`ecutwfc` 仅决定实空间积分网格的密度。一旦网格足够密（能分辨轨道的特征），再增加 `ecutwfc` 并不能改变基组本身只有 "1s1p" 这一事实。**基组的完备性缺陷无法通过提高截断能来弥补。** 想要提高精度，必须更换更完备的 `.orb` 文件（如换成 DZP）。

### 1.3.3 标准测试协议 (Protocol)

建议在开始课题前，按照以下步骤建立基准：

**Step 1: 建立 PW 真值 (Benchmark)**
*   设置 `basis_type = pw`。
*   进行 `ecutwfc` 收敛性测试（如 60, 70, ..., 120 Ry），找到能量收敛点（例如 100 Ry）。
*   记录此时的总能量 $E_{PW}$ 和关键物理量（如晶格常数、带隙）。

**Step 2: LCAO 精度测试**
*   设置 `basis_type = lcao`。
*   保持 `ecutwfc` 为 100 Ry（参考 Step 1 的收敛值或轨道文件名推荐值）。
*   **实验 A**: 使用 SZ 轨道文件。记录 $E_{SZ}$。
*   **实验 B**: 使用 DZP 轨道文件。记录 $E_{DZP}$。
*   **实验 C**: 使用 TZDP 轨道文件（可选）。记录 $E_{TZDP}$。

**Step 3: 结果分析**
*   验证是否满足：$E_{SZ} > E_{DZP} > E_{PW}$。
*   计算能量差 $\Delta E = E_{LCAO} - E_{PW}$。如果 DZP 的 $\Delta E$ 在 10-200 meV/atom 范围内，且能带结构与 PW 基本重合，则说明该 LCAO 基组可靠，可用于后续的大规模计算。

### 1.3.4 必要的输入文件准备
为了执行上述测试，你需要准备以下文件结构。请注意 `STRU` 文件在引入轨道时的写法。

**文件结构示例：**
```text
.
├── pseudopotentials/     # 存放 .upf 或 .vsp 文件
├── orbitals/             # 存放 .orb 文件
├── 01_pw_benchmark/      # PW 计算目录
│   ├── INPUT
│   ├── STRU
│   └── K_POINTS
└── 02_lcao_dzp/          # LCAO 计算目录
    ├── INPUT
    ├── STRU
    └── K_POINTS
```

**关于 STRU 文件的特别提示：**
在 `02_lcao_dzp/STRU` 中，`ATOMIC_SPECIES` 部分必须显式指定轨道文件。

```text
ATOMIC_SPECIES
Si  28.0855  Si_ONCV_PBE-1.0.upf  Si_gga_7au_100Ry_2s2p1d.orb
// 元素名  原子量  赝势文件名  轨道文件名(LCAO模式必需)
```
*注意：PW 模式下，`STRU` 中的第四列（轨道文件名）会被忽略，但为了文件统一，保留它也不会报错。*

---

**总结**：
本章我们确立了“以 PW 为尺，衡量 LCAO 精度”的核心思想。理解 `basis_type` 的区别和 `.orb` 文件的含义是使用 ABACUS 的基本功。下一章，我们将进入实战环节，手把手教你编写第一个 `INPUT` 文件。