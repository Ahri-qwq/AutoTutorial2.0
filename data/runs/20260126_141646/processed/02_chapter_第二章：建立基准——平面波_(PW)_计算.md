# 第二章：建立基准——平面波 (PW) 计算

这是一篇基于 ABACUS 最佳实践撰写的《ABACUS 实战教程》第二章。本章旨在建立计算的“基准真值”，为后续的 LCAO（数值原子轨道）计算提供精度评估的标尺。

---

# 第二章：建立基准——平面波 (PW) 计算

在进入 ABACUS 高效的 LCAO（线性组合原子轨道）模式之前，我们必须先完成一步至关重要的工作：**建立基准（Benchmark）**。

很多初学者容易陷入一个误区：直接使用 LCAO 模式计算，却不知道结果偏离了多少。**没有基准的测试是毫无意义的。** 在本章中，我们将利用 ABACUS 的平面波（Plane Wave, PW）基组功能，对体系进行一次高精度的计算。由于平面波基组具有系统可收敛性（Systematic Convergence），我们可以将其结果视为该赝势下的“参考真值”（Ground Truth）。

## 2.1 PW 模式下的输入文件配置

在这一节，我们将配置 `INPUT` 文件以启动平面波计算。此时我们的目标不是速度，而是**精度**。

### 核心参数详解

要开启 PW 模式，最关键的参数是 `basis_type` 和 `ecutwfc`。

1.  **`basis_type`**: 设置为 `pw`。这告诉 ABACUS 忽略轨道文件，直接使用平面波展开波函数。
2.  **`ecutwfc`**: 波函数截断能（Energy Cutoff for Wavefunctions），单位为 Rydberg (Ry)。
    *   **物理意义**: 它决定了平面波基组的大小。数值越大，基组越完备，结果越精确，但计算量呈指数级增长。
    *   **推荐值**: 为了获得“真值”，我们通常设置一个较高的数值，例如 **100 Ry**（对于大多数软/中等硬度赝势已足够收敛）。
    *   **注意**: 在 PW 模式下，`ecutwfc` 直接决定精度；而在 LCAO 模式下，它的作用完全不同（详见 2.3 节）。

### INPUT 文件示例

创建一个名为 `INPUT` 的文件，写入以下内容：

```bash
INPUT_PARAMETERS
# 1. 基础计算参数
suffix              Si_PW_Benchmark  # 输出文件后缀
calculation         scf              # 自洽场计算
basis_type          pw               # 关键：指定使用平面波基组
symmetry            1                # 开启对称性分析以加速

# 2. 精度控制参数
ecutwfc             100              # 关键：设置为 100 Ry 以确保高精度
scf_thr             1.0e-8           # 自洽收敛阈值 (Ry)，基准计算建议设严
scf_nmax            100              # 最大自洽步数

# 3. 赝势路径
pseudo_dir          ./               # 赝势文件所在目录
# orbital_dir       ./               # PW 模式下不需要此参数，但保留也不报错
```

> **专家提示**：
> 这里的 `scf_thr` 设为了 `1.0e-8`，比日常计算（通常 `1.0e-6`）更严格，这是为了消除数值噪声，确保我们拿到的能量是真正的收敛解。

## 2.2 准备结构与赝势 (STRU & KPT)

除了 `INPUT` 文件，我们还需要定义晶体结构和 K 点。

### 1. 准备赝势文件
确保你的目录下有对应的赝势文件（例如 `Si.upf`）。
*   **重要原则（控制变量法）**：在后续对比 LCAO 精度时，**必须使用完全相同的赝势文件**。切勿在对比过程中更换赝势（如从 LDA 换到 GGA），否则能量差将失去物理意义。

### 2. 编写 STRU 文件
`STRU` 文件定义了原子种类、晶格常数和原子位置。

**风险提示**：在 PW 模式下，虽然不需要读取数值轨道文件（`.orb`），但 `ATOMIC_SPECIES` 部分的格式必须保持完整。

```bash
ATOMIC_SPECIES
Si  28.0855  Si.upf  # 元素名 质量 赝势文件名

LATTICE_CONSTANT
10.2                 # 晶格常数 (Bohr)

LATTICE_VECTORS
0.5 0.5 0.0
0.5 0.0 0.5
0.0 0.5 0.5

ATOMIC_POSITIONS
Direct               # 分数坐标
Si                   # 元素名
0.0   0.0   0.0      # 磁矩(可选) 坐标x 坐标y 坐标z
0.25  0.25  0.25
```

### 3. 编写 KPT 文件
K 点网格密度直接影响能量精度。

```bash
K_POINTS
0
Gamma
4 4 4 0 0 0
```

> **重要原则（控制变量法）**：请记住这里设置的 `4 4 4`。在下一章进行 LCAO 计算时，**必须保持 K 点网格完全一致**。如果 PW 用 `4 4 4` 而 LCAO 用 `2 2 2`，两者的能量差异将包含 K 点采样误差，导致无法评估基组误差。

## 2.3 运行计算与数据记录

### 执行计算
在终端运行 ABACUS（根据你的环境，命令可能是 `abacus` 或 `mpirun -np 4 abacus`）：

```bash
mpirun -np 4 abacus | tee output.log
```

### 提取基准能量 (Ground Truth)
计算完成后，我们需要提取总能量。在 `output.log` 或 `OUT.Si_PW_Benchmark/running_scf.log` 中寻找 `!FINAL_ETOT_IS` 关键字。

```bash
grep "FINAL_ETOT_IS" OUT.Si_PW_Benchmark/running_scf.log
```

假设输出为：
`!FINAL_ETOT_IS  -231.567890 eV`

**记录下这个数值**。这就是我们在当前赝势、当前结构、当前 K 点下的“真值”。

## 2.4 核心概念辨析与预告

在进入下一章 LCAO 实战前，作为开发者，我必须澄清几个极其关键的概念，这直接关系到你是否能正确使用 ABACUS。

### 1. 为什么 LCAO 的能量通常比 PW 高？
根据变分原理，基组越完备，总能量越低（越接近真实基态）。
*   **PW (100 Ry)**：基组非常完备，能量极低，接近极限。
*   **LCAO (DZP/TZDP)**：基组是有限的，完备性不如高截断能的平面波。
因此，**LCAO 的总能量通常会比 PW 高 0.1 ~ 0.2 eV/atom**。这是一个正常的物理现象，称为“基组误差”。我们的目标不是消除它，而是将其控制在可接受范围内（如 < 10 meV/atom）。

### 2. `ecutwfc` 的致命误区
在 **PW 模式**下，调大 `ecutwfc` = 提高精度。
在 **LCAO 模式**下，**这是一个常见的陷阱**！
*   LCAO 模式下，`ecutwfc` 仅决定积分格点的密度（Grid Mesh）。
*   如果你使用的是小基组（如 SZ），即使把 `ecutwfc` 加到 500 Ry，结果依然是不准的 SZ 结果，只是积分更精确的“错误结果”而已。
*   **结论**：在 LCAO 模式下要提高精度，必须更换更完备的轨道文件（如从 SZ 换到 DZP），而不是盲目增加 `ecutwfc`。

### 3. 预习：如何解读轨道文件名
在下一章我们将引入轨道文件。请先学会阅读 ABACUS 标准轨道库的文件名，例如 `Si_gga_7au_100Ry_2s2p1d.orb`：

*   **`Si`**: 元素。
*   **`gga`**: 生成该轨道时使用的泛函类型（需与赝势匹配）。
*   **`7au`**: **截断半径 ($R_{cut}$)**。这是 LCAO 的核心参数。半径越大，轨道拖尾越长，精度越高，但计算越慢（稀疏矩阵变稠密）。
*   **`100Ry`**: **生成截断能**。指生成这个数值轨道时，参考的平面波截断能是 100 Ry。这**不是**你在 `INPUT` 里设置的 `ecutwfc`，而是一个标签，代表这个轨道的“品质”。
*   **`2s2p1d`**: **轨道配置**。
    *   `2s`: 2 个 s 轨道。
    *   `2p`: 2 组 p 轨道。
    *   `1d`: 1 组 d 轨道（极化轨道）。
    *   这是判断基组大小（DZP, TZDP）的直接依据。

---

**本章总结**：
你已经成功运行了 `basis_type = pw` 的高精度计算，并拿到了总能量的参考真值。请妥善保存 `INPUT`、`STRU` 和 `KPT` 文件，下一章我们将保持这些参数不变，仅通过引入 `.orb` 文件和修改 `basis_type`，来体验 LCAO 的极速计算与精度平衡。