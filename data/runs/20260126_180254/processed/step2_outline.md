<!-- META_START -->
# ABACUS 实战教程：实时含时 DFT (rt-TDDFT) 激发态模拟

## 前言
- **本书逻辑**: 本教程遵循“理论痛点 -> 基础构建 -> 核心解决方案 -> 实战分析”的教学逻辑。首先揭示周期性体系激发态模拟中“规范变换”的理论难题，进而引入 ABACUS 特有的“混合规范 (Hybrid Gauge)”解决方案，最后通过从线性响应到非线性光学（如高次谐波）的完整案例，指导读者掌握 rt-TDDFT 的全流程。
- **核心知识点**: 实时 Kohn-Sham 方程演化、混合规范 (Hybrid Gauge) 理论、数值原子轨道 (NAO) 的相位修正、外加电场激发、电流/偶极矩后处理、非线性光学响应。

<!-- CHAPTER_START -->
## 第一章：rt-TDDFT 理论基础与规范难题
**本章逻辑**: 在动手计算前，必须理解 rt-TDDFT 的物理图像以及为何在周期性体系中需要特殊的“混合规范”。本章将通过理论对比，明确 ABACUS 混合规范算法的科学价值。

### Section 1.1: 实时演化与 TDKS 方程
- **内容**: 简述 Runge-Gross 定理，解释电子波函数如何在时间域内直接演化（Propagator）。对比线性响应 TDDFT (LR-TDDFT) 与实时演化 (rt-TDDFT) 的适用场景（强调 rt-TDDFT 在强场、非线性过程中的优势）。
- **关键参数**: 无（理论背景）。

### Section 1.2: 周期性体系的“规范”困境
- **内容**: 深入剖析长度规范 (Length Gauge) 与速度规范 (Velocity Gauge) 的矛盾：
    1.  长度规范破坏周期性边界条件，无法用于固体。
    2.  速度规范虽保留周期性，但在有限原子轨道 (NAO) 基组下存在严重的相位误差（低频发散）。
- **关键参数**: 无（理论背景）。

### Section 1.3: ABACUS 混合规范 (Hybrid Gauge) 解决方案
- **内容**: 介绍混合规范的核心思想——在传统速度规范基础上，引入依赖于矢势的局域相位因子修正。展示其如何同时实现“保持周期性”与“修正基组误差”，并强调其相对于单纯增大基组的高效性。
- **关键参数**: 无（核心算法介绍）。

<!-- CHAPTER_START -->
## 第二章：基础参数设置与演化环境构建
**本章逻辑**: 确立计算的“地基”。从静态计算过渡到动力学模拟，重点讲解时间步长、基组选择等对结果物理正确性至关重要的参数。

### Section 2.1: 激活 rt-TDDFT 模块
- **内容**: 修改 `INPUT` 文件，将计算模式从基态自洽场切换为含时演化模式。
- **关键参数**: 
    - `calculation`: 设为 `md`。
    - `esolver_type`: 设为 `tddft`。

### Section 2.2: 时间尺度与演化步长
- **内容**: 强调电子动力学（阿秒级）与离子动力学（飞秒级）的时间尺度差异。指导如何设置合理的时间步长以保证演化算符的稳定性。
- **关键参数**: 
    - `md_dt`: 时间步长（通常需设为极小值，如阿秒量级，需查阅文档确认具体单位）。
    - `md_nstep`: 总演化步数（决定模拟的总时长）。

### Section 2.3: 电子结构与空带准备
- **内容**: 解释为何激发态计算必须包含足够的空带（Empty Bands）。如果仅计算占据态，电子将无法发生跃迁。
- **关键参数**: 
    - `nbands`: 能带总数（必须显著大于体系的电子对数）。
    - 基组文件 (`orbital_dir`): 确认使用高质量的 NAO 基组。

<!-- CHAPTER_START -->
## 第三章：外场激发与混合规范实战
**本章逻辑**: 本章是教程的核心。指导用户如何施加外场（电场）来“踢”动电子，并明确开启混合规范以确保结果准确。

### Section 3.1: 选择规范与开启混合规范
- **内容**: 指导用户如何在输入文件中显式指定使用“混合规范”，以修正周期性体系下的计算误差。
- **关键参数**: 
    - `td_gauge` (暂定名，需查阅文档): 设置为 `hybrid` 或对应开启混合规范的开关。
    - `td_gauge_fix` (暂定名，需查阅文档): 是否开启针对速度规范的经验性修正（作为对比）。

### Section 3.2: 定义外加电场 (External Field)
- **内容**: 介绍两种主要的激发方式：
    1.  **脉冲激发 (Delta-kick/Gaussian)**: 用于获取全频段吸收谱/介电函数。
    2.  **持续强场**: 用于模拟 Rabi 振荡或高次谐波 (HHG)。
- **关键参数**: 
    - `td_efield` (暂定名，需查阅文档): 定义电场类型（高斯、阶跃等）。
    - `td_field_amp` (暂定名，需查阅文档): 电场强度（注意单位转换）。
    - `td_field_pol` (暂定名，需查阅文档): 电场极化方向。

### Section 3.3: 案例实操 A - 硅 (Si) 单胞的线性响应
- **内容**: 复现素材中的经典案例。设置弱高斯脉冲，使用混合规范计算 Si 的电流响应。
- **关键参数**: 结合上述参数，设定较小的场强以保证处于线性响应区。

<!-- CHAPTER_START -->
## 第四章：后处理与物理量分析
**本章逻辑**: 计算结束后的数据挖掘。如何从随时间剧烈震荡的输出文件中提取出有物理意义的光谱和非线性特征。

### Section 4.1: 关键物理量提取
- **内容**: 解析 ABACUS 输出文件，提取随时间变化的电流密度 $J(t)$ 和偶极矩 $P(t)$。
- **关键参数**: 
    - 输出文件关键词（如 `J_t`, `Dipole_t` 等，需查阅文档）。

### Section 4.2: 傅里叶变换与光谱计算
- **内容**: 介绍如何对 $J(t)$ 进行傅里叶变换得到 $J(\omega)$，进而利用公式 $\sigma(\omega) = J(\omega)/E(\omega)$ 计算光电导率和介电函数。
- **关键参数**: 外部数据处理脚本（Python/Matlab）。

### Section 4.3: 案例实操 B - 非线性效应与高次谐波 (HHG)
- **内容**: 分析强场激发下的 Si 案例。展示如何从电流谱中识别出基频的倍频信号（3次、5次、7次谐波），验证混合规范在强非线性区的稳定性。
- **关键参数**: 需设置较大的 `td_field_amp` 和较长的 `md_nstep` 以保证频率分辨率。

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **基组收敛性陷阱**: 提醒用户虽然混合规范修正了相位误差，但过小的基组仍可能导致高能态描述不准。
- **对称性破坏**: 施加外场后，体系的空间对称性可能发生变化，需注意 `symmetry` 参数的设置。
- **计算资源预估**: rt-TDDFT 极其耗时，建议先用小体系测试 `md_dt` 和收敛性。
- **参数速查表**: 汇总 `td_` 相关参数的官方文档链接。