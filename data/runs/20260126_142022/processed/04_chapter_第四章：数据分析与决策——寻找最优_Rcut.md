# 第四章：数据分析与决策——寻找最优 Rcut

在 ABACUS 的数值原子轨道（LCAO）计算中，**截断半径（Rcut）** 是决定计算精度与效率平衡的核心参数。不同于平面波（PW）基组只需简单增加截断能（`ecutwfc`），LCAO 基组的完备性高度依赖于轨道的空间延展范围。

本章将指导你如何通过定量的“Delta Test”流程，针对不同体系（固体、分子、表面）筛选出最优的 Rcut。

> **核心概念澄清**：
> 在 ABACUS 的 LCAO 模式中，**改变 Rcut 通常意味着更换轨道文件**。
> 你无法在 `INPUT` 文件中简单地修改一个数字来改变 Rcut。你必须在 `STRU` 文件中指定不同截断半径的轨道文件（例如从 `Si_7au.orb` 换成 `Si_8au.orb`）。

---

## 4.1 能量与能带的误差分析 (Delta Test)

LCAO 是一种近似方法，其精度上限由基组决定。为了验证 Rcut 是否足够，我们需要一个“绝对真值”作为标尺。在 ABACUS 中，**平面波（PW）计算结果**就是这个标尺。

### 4.1.1 建立基准：PW 计算 (Reference)

首先，我们需要对同一体系进行一次高精度的平面波计算。

1.  **准备 INPUT**：将 `basis_type` 设置为 `pw`。
2.  **设置参数**：为了保证作为基准的可靠性，PW 计算的 `ecutwfc` 应设置得足够高（通常建议 80-100 Ry 或更高，视赝势软硬而定）。

**INPUT 示例 (PW Benchmark):**
```bash
INPUT_PARAMETERS
# ... 通用设置 ...
calculation     scf
basis_type      pw        # 关键：使用平面波作为基准
ecutwfc         100       # 关键：足够大的截断能
scf_thr         1e-8      # 高精度收敛标准
# ... 其他参数 ...
```

记录下此次计算的总能量 $E_{PW}$（单位：eV 或 Ry）。

### 4.1.2 测试对象：LCAO 计算

接下来，保持体系结构（`STRU` 中的晶格和原子位置）完全不变，切换到 LCAO 模式，并轮换使用不同 Rcut 的轨道文件。

**INPUT 示例 (LCAO Test):**
```bash
INPUT_PARAMETERS
# ... 通用设置 ...
calculation     scf
basis_type      lcao      # 关键：切换为 LCAO
ecutwfc         100       # 建议与 PW 保持一致或至少 60+ Ry，用于处理积分网格
# ... 其他参数 ...
```

**STRU 文件调整 (关键步骤):**
在 `ATOMIC_SPECIES` 部分，你需要修改第三列引用的轨道文件名。假设你手头有一组不同 Rcut 的轨道文件（通常位于 `orbital_dir` 指定的目录下）：

*   **测试 6.0 au:**
    ```
    ATOMIC_SPECIES
    Si  28.086  Si.upf  Si_DZP_6.0au.orb
    ```
*   **测试 7.0 au:**
    ```
    ATOMIC_SPECIES
    Si  28.086  Si.upf  Si_DZP_7.0au.orb
    ```
*   **测试 8.0 au:**
    ```
    ATOMIC_SPECIES
    Si  28.086  Si.upf  Si_DZP_8.0au.orb
    ```

> **注意**：必须确保 PW 和 LCAO 计算使用的是**完全相同**的赝势文件（`.upf`），否则能量差值没有物理意义。

### 4.1.3 评估标准：Delta E

计算每个 Rcut 下的能量差值：
$$ \Delta E(R_{cut}) = \frac{|E_{LCAO}(R_{cut}) - E_{PW}|}{N_{atoms}} $$

**高精度收敛标准**：
- **优 (Excellent)**: $\Delta E < 1 \text{ meV/atom}$
- **良 (Good)**: $\Delta E < 5 \text{ meV/atom}$ (对于大规模动力学模拟通常可接受)
- **差 (Poor)**: $\Delta E > 10 \text{ meV/atom}$ (需增大 Rcut 或基组大小)

绘制一张 "Delta E vs. Rcut" 的曲线图。你会发现随着 Rcut 增加，$\Delta E$ 会迅速下降并趋于平缓。选择那个**刚进入“优/良”区间且 Rcut 最小**的点，即为最优解。

---

## 4.2 不同体系的选取策略

虽然 Delta Test 是金标准，但在实际科研中，我们可以根据体系的物理特性应用经验法则。

### 4.2.1 固体体系 (Bulk Systems)
**推荐策略**：**较短 Rcut (6 - 8 au)**

*   **物理原理**：在致密的固体中，原子间距较小。一个原子的波函数可以通过邻近原子的轨道线性组合来补充（即邻近原子的轨道“伸”过来帮忙描述电子）。这种重叠效应增加了基组的有效完备性。
*   **决策**：通常 6.0 au 或 7.0 au 的 DZP 轨道就能达到非常高的精度（< 1 meV/atom）。过大的 Rcut (如 > 9 au) 会导致哈密顿量矩阵变得不够稀疏，显著增加计算量，却对精度提升极小。

### 4.2.2 分子与表面体系 (Molecules & Surfaces)
**推荐策略**：**较长 Rcut (8 - 10 au)**

*   **物理原理**：
    1.  **真空衰减**：在分子或表面模型中，电子波函数需要向真空层延伸并自然衰减。真空中没有“邻居”原子提供轨道重叠支持，因此必须依靠原子自身的轨道拖得足够长来描述这种衰减。
    2.  **BSSE 问题**：虽然长 Rcut 理论上可能引入基组重叠误差（BSSE），但在 LCAO 中，过短的 Rcut 造成的“人为禁闭误差”（电子撞到截断半径墙壁）通常比 BSSE 更严重。
*   **决策**：对于真空中孤立分子或吸附表面，建议从 8.0 au 起步测试，通常 9.0 au 或 10.0 au 是更稳妥的选择。

---

## 附录：常见陷阱与进阶

### 1. SZ vs DZP 的陷阱
**警告**：**永远不要在 SZ (Single Zeta) 基组上做 Rcut 测试。**
SZ 基组本身自由度太少，无论 Rcut 多大，其精度都无法逼近 PW 结果。你可能会看到 $\Delta E$ 很大且不随 Rcut 改善，从而错误地认为是 Rcut 不够大。
**正确做法**：始终使用 **DZP (Double Zeta Polarized)** 或更高阶基组进行 Rcut 收敛性测试。

### 2. 内存溢出 (OOM) 风险
**现象**：当 Rcut 很大（如 > 10 au）且体系原子很密时，稀疏矩阵（H 和 S 矩阵）的非零元数量会呈立方级增长，导致内存瞬间耗尽。
**解决方案**：
- 如果必须使用超大 Rcut，请务必增加计算节点（MPI 进程），利用并行分摊内存。
- 检查是否误用了针对团簇设计的长轨道去计算高压致密固体。

### 3. 不要混淆 `ecutwfc` 与 Rcut
- **Rcut (轨道半径)**：决定了基组的广度，直接影响 LCAO 的物理精度。
- **`ecutwfc` (网格截断能)**：在 LCAO 中，它决定了实空间积分网格的密度。
**调试指南**：如果 LCAO 结果不准，**90% 的情况应该优先检查 Rcut 和基组大小（DZP/TZP）**，而不是盲目增加 `ecutwfc`。只要 `ecutwfc` 达到 60-100 Ry，它通常不是误差的主要来源。