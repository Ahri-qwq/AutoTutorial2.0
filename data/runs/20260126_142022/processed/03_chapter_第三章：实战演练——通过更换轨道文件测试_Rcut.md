# 第三章：实战演练——通过更换轨道文件测试 Rcut

在上一章中，我们了解了数值原子轨道（NAO）的基本原理。当你准备开始第一个 LCAO 计算时，很多初学者的第一反应是在 `INPUT` 文件中寻找一个名为 `rcut` 或 `orbital_radius` 的参数，试图通过修改这个数字来控制计算精度。

**请立刻停下来。**

在 ABACUS 的 LCAO 模式中，**$R_{cut}$ 不是一个输入参数，而是轨道文件的固有属性**。要改变 $R_{cut}$，你必须更换不同半径的轨道文件。本章将带你一步步完成这个核心操作，并建立一套标准的精度测试流程。

---

## 3.1 轨道文件的准备与识别：文件名即参数

数值原子轨道文件（通常以 `.orb` 结尾）是预先生成好的数据表。ABACUS 读取这些文件时，轨道的形状、节点数以及最重要的截断半径（$R_{cut}$）就已经被固定了。

### 3.1.1 读懂文件名
虽然文件名可以任意修改，但官方发布的轨道文件通常遵循严格的命名规范，这包含了我们所需的所有信息。

以文件名 `Si_gga_7au_100Ry_2s2p1d.orb` 为例：
- **Si**: 元素符号。
- **gga**: 交换关联泛函类型（需与赝势一致）。
- **7au**: **这就是 $R_{cut}$**。表示该轨道的截断半径为 7.0 Bohr（约 3.7 Å）。
- **100Ry**: 生成该轨道时使用的截断能（参考值，提示你在 LCAO 计算中 `ecutwfc` 最好不低于此值）。
- **2s2p1d**: 基组大小（Zeta），表示包含 2 个 s 轨道，2 个 p 轨道和 1 个 d 轨道。

### 3.1.2 准备测试序列
为了测试 $R_{cut}$ 对计算结果的影响，你不能只准备一个文件。你需要从 ABACUS 官网或使用 PTG 程序准备一系列不同半径的轨道文件。

**实战准备**：假设我们要测试硅（Si）晶体，请确保你的工作目录下有以下三个文件（如果没有，请假设我们已经生成了它们）：
1.  `Si_gga_6au_100Ry_2s2p1d.orb` (短半径，速度快，精度可能不足)
2.  `Si_gga_7au_100Ry_2s2p1d.orb` (中等半径，推荐起点)
3.  `Si_gga_8au_100Ry_2s2p1d.orb` (长半径，精度高，计算量大)

---

## 3.2 LCAO 计算参数设置 (INPUT)

在进行 Rcut 测试之前，我们需要配置 `INPUT` 文件。这里有一个极易混淆的概念需要澄清：`ecutwfc` 在 LCAO 中的作用。

### 3.2.1 关键参数配置
创建一个标准的 `INPUT` 文件：

```bash
INPUT_PARAMETERS
# 基础计算模式
calculation     scf
basis_type      lcao    # 关键：开启 LCAO 模式

# 精度控制
ecutwfc         100     # 推荐值：100 Ry
scf_thr         1e-6    # 自洽收敛标准
scf_nmax        100

# 涂抹设置 (针对金属或小能隙体系)
smearing_method gaussian
smearing_sigma  0.01

# 混合参数
mixing_type     pulay
mixing_beta     0.7
```

### 3.2.2 专家点拨：ecutwfc 与 Rcut 的无关性
> **误区警示**：很多用户发现 LCAO 结果不准，第一反应是把 `ecutwfc` 从 100 Ry 加到 200 Ry，结果发现能量几乎没变。

**原理**：
- 在 **PW（平面波）** 模式下，`ecutwfc` 决定了基组的大小（圆球半径），直接决定精度。
- 在 **LCAO** 模式下，基组的大小由 `.orb` 文件（即 $R_{cut}$ 和 Zeta）决定。此时 `ecutwfc` 仅控制**实空间积分网格的疏密**。

**结论**：只要 `ecutwfc` 足够高（通常 100 Ry 对于大多数标准轨道已足够），能准确描述轨道波函数的起伏即可。**如果结果不准，请去换轨道文件（改 Rcut 或 Zeta），而不是盲目增加 `ecutwfc`。**

---

## 3.3 核心操作——修改 STRU 文件

这是本章的实操重点。改变 $R_{cut}$ 的操作完全在 `STRU` 文件中进行。

### 3.3.1 STRU 文件结构
`STRU` 文件定义了原子种类、晶格和坐标。我们需要关注的是 `ATOMIC_SPECIES` 模块。

**格式说明**：
```text
ATOMIC_SPECIES
元素名  原子质量  赝势文件路径  轨道文件路径
```

### 3.3.2 实战演练：6au -> 7au -> 8au
我们将进行三次独立的 SCF 计算，每次仅修改 `STRU` 文件中的最后一列。

**测试 1：使用 6au 轨道**
修改 `STRU` 文件：
```text
ATOMIC_SPECIES
Si  28.086  Si_ONCV_PBE-1.0.upf  Si_gga_6au_100Ry_2s2p1d.orb
```
*运行 ABACUS，记录总能量 $E_{6au}$。*

**测试 2：使用 7au 轨道**
修改 `STRU` 文件：
```text
ATOMIC_SPECIES
Si  28.086  Si_ONCV_PBE-1.0.upf  Si_gga_7au_100Ry_2s2p1d.orb
```
*运行 ABACUS，记录总能量 $E_{7au}$。*

**测试 3：使用 8au 轨道**
修改 `STRU` 文件：
```text
ATOMIC_SPECIES
Si  28.086  Si_ONCV_PBE-1.0.upf  Si_gga_8au_100Ry_2s2p1d.orb
```
*运行 ABACUS，记录总能量 $E_{8au}$。*

---

## 3.4 建立基准：PW vs LCAO 对比测试

单纯看 LCAO 的能量变化是不够的，因为 LCAO 是变分近似。我们需要一个“真值”作为标尺。在 DFT 计算中，收敛的高截断能平面波（PW）结果通常被视为基准。

### 3.4.1 标准测试流程
建议在正式大规模计算前，对你的体系进行如下 Benchmark：

1.  **运行 PW 基准计算**：
    - 修改 `INPUT`: `basis_type pw`, `ecutwfc 80` (或更高，确保 PW 收敛)。
    - 运行计算，获得 $E_{PW}$。
2.  **计算能量差 ($\Delta E$)**：
    - $\Delta E = (E_{LCAO} - E_{PW}) / N_{atoms}$
    - 单位通常转换为 meV/atom。

### 3.4.2 精度判据
根据经验，我们推荐以下收敛标准：

| 精度等级 | $\Delta E$ (vs PW) | 适用场景 | 建议 Rcut |
| :--- | :--- | :--- | :--- |
| **高精度** | < 1 meV/atom | 声子谱、弹性常数、高精度能带 | 7.0 - 9.0 au |
| **中等精度** | < 10 meV/atom | 结构弛豫、MD 预跑、大体系筛选 | 6.0 - 7.0 au |
| **低精度** | > 10 meV/atom | 仅做定性分析（慎用） | < 6.0 au |

### 3.4.3 锦囊妙计：固体 vs 分子
在选择 $R_{cut}$ 时，请记住物理环境的区别：

*   **固体/体材料**：原子排列紧密，近邻原子的轨道重叠非常大。这种重叠实际上弥补了单个原子基组的不足（类似于基组完备性借用）。因此，**固体计算通常可以使用较短的 Rcut（如 6-7 au）** 就能达到很高精度。
*   **分子/表面/团簇**：存在真空层，原子周围的“邻居”少，必须依靠自身的轨道延伸来描述波函数。因此，**孤立体系通常需要更长的 Rcut（如 8-10 au）**，这也有助于减少基组重叠误差（BSSE）。

---

## 3.5 本章总结

1.  **文件名即参数**：不要在 INPUT 里找 `rcut`，请直接在 `STRU` 的 `ATOMIC_SPECIES` 中更换轨道文件。
2.  **控制变量**：测试 Rcut 时，保持 `ecutwfc`（推荐 100 Ry）和基组大小（如 DZP）不变。
3.  **PW 是标尺**：没有 PW 结果做对比的 LCAO 计算是“盲飞”。务必先跑一个 PW 算例作为 Reference。
4.  **按需选择**：固体体系 6-7 au 通常足矣；分子体系建议 8 au 起步。

在掌握了如何通过更换文件控制 $R_{cut}$ 后，下一章我们将深入探讨另一个决定精度的关键因素：**基组大小（SZ, DZP, TZDP）的选择策略**。