# 第三章：输入文件设置与晶胞优化

## Section 3.1: INPUT文件的关键参数

在使用ABACUS进行弹性常数计算之前，正确配置INPUT文件是至关重要的一步。本节将详细介绍几个关键参数及其推荐值。

### 关键参数详解

1. **`cal_stress`**:
   - **作用**: 控制是否计算应力张量。
   - **推荐值**: `1` (开启)。
   - **物理意义**: 应力张量对于理解材料的力学性质至关重要，特别是在进行弹性常数计算时。

2. **`cal_force`**:
   - **作用**: 控制是否计算原子受力。
   - **推荐值**: `1` (开启)。
   - **物理意义**: 原子受力信息对于结构优化和分子动力学模拟非常重要。

3. **`gamma_only`**:
   - **作用**: 控制是否只计算Gamma点。
   - **推荐值**: `0` (关闭) 或 `1` (开启)。
   - **物理意义**: 在某些情况下（如对称性较高的体系），只计算Gamma点可以显著减少计算量。但对于一般情况，建议关闭以获得更准确的结果。

4. **`smearing_method`**:
   - **作用**: 指定电子占据数的展宽方法。
   - **推荐值**: `gaussian` 或 `methfessel-paxton`。
   - **物理意义**: 展宽方法的选择会影响电子态密度的平滑程度，从而影响自洽场迭代的收敛速度和结果的准确性。

5. **`smearing_sigma`**:
   - **作用**: 设置展宽参数σ的值。
   - **推荐值**: `0.01` (单位为哈特里)。
   - **物理意义**: σ值越小，电子态密度越尖锐，但可能导致自洽场迭代收敛困难；σ值越大，电子态密度越平滑，但可能引入额外的误差。

6. **`mixing_type`**:
   - **作用**: 指定电荷密度混合方法。
   - **推荐值**: `pulay` 或 `broyden`。
   - **物理意义**: 不同的混合方法会影响自洽场迭代的收敛速度和稳定性。Pulay混合方法通常较为稳健，而Broyden混合方法在某些情况下可以更快收敛。

### 示例 `INPUT` 文件

```plaintext
INPUT_PARAMETERS
suffix              UO2
ntype               2
pseudo_dir          ../../PP_ORB
orbital_dir         ../../PP_ORB
ecutwfc             100
scf_thr             1e-4
basis_type          pw
calculation         cell-relax
force_thr_ev        0.1
stress_thr          20
relax_nmax          10
out_stru            1
cell_factor         2
relax_scale_force   0.4
cal_stress          1
cal_force           1
gamma_only          0
smearing_method     gaussian
smearing_sigma      0.01
mixing_type         pulay
```

## Section 3.2: 晶胞优化步骤

在施加应变之前，必须确保晶胞已经被充分优化至势能面的局部极小值点。这一步骤的重要性在于，未优化的初始结构可能会导致计算结果的不准确或不稳定。

### 为什么需要晶胞优化

- **物理意义**: 晶胞优化通过最小化系统的总能量，使结构达到稳定状态。这对于后续的弹性常数计算尤为重要，因为非平衡结构会导致应力张量的计算偏差。
- **操作指南**:
  1. **准备初始结构文件** (`STRU`): 包含原子种类、位置、晶格常数等信息。
  2. **配置 `INPUT` 文件**:
     - 设置 `calculation` 参数为 `cell-relax`。
     - 确保 `cal_stress` 和 `cal_force` 参数均设置为 `1`。
     - 调整 `force_thr_ev` 和 `stress_thr` 参数以控制优化精度。
  3. **运行计算**:
     - 使用命令行工具或脚本提交计算任务。
     - 监控计算过程，确保收敛。

### 示例 `STRU` 文件

```plaintext
ATOMIC_SPECIES
U 238.0508 U-5spdf.upf
O  15.999 O_ONCV_PBE-1.0.upf

LATTICE_CONSTANT
1.8897259886

LATTICE_VECTORS
5.471 0.0 0.0
0.0 5.471 0.0
0.0 0.0 5.471

ATOMIC_POSITIONS
U 0.0 0.0 0.0
O 0.5 0.5 0.5
```

### 结果验证

- **检查应力张量**: 确保优化后的应力张量接近于零，表明结构已达到平衡状态。
- **检查原子受力**: 确保所有原子的受力小于设定的阈值 (`force_thr_ev`)。

### 风险提示

- **关于应力计算的参数资料缺失**: 请查阅ABACUS官方文档以获取具体的参数名和推荐值。
- **依赖库的安装**: 确保安装了 `pymatgen`、`dpdata`、`monty` 和 `numpy` 库，以便进行数据处理和分析。

通过以上步骤，您可以确保晶胞得到充分优化，并为后续的弹性常数计算打下坚实的基础。