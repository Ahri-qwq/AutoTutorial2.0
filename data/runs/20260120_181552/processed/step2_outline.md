<!-- META_START -->
# ABACUS 实战教程：晶体弹性常数计算原理与应用

## 前言
- **本书逻辑**: 本教程遵循“理论物理背景 -> 计算流程设计 -> 关键操作细节 -> 数据后处理”的逻辑闭环。弹性常数计算不同于常规的单点能计算，它涉及高通量任务管理和严格的张量拟合。本教程特别强调“应变-应力法”在 ABACUS 中的具体实现，重点解决结构预优化标准、变形结构的离子弛豫策略以及自动化脚本的使用。
- **核心知识点**: 广义胡克定律、Voigt 标记法、应变-应力法 (Strain-Stress Method)、pymatgen 接口应用、ABACUS 应力张量计算。

<!-- CHAPTER_START -->
## 第一章：弹性力学基础与计算原理
**本章逻辑**: 在动手操作前，必须理解物理本质。本章旨在建立从“宏观力学性质”到“微观电子结构计算”的映射关系，明确为什么我们需要计算应力张量来反推弹性常数。

### Section 1.1: 广义胡克定律与 Voigt 标记法
- **内容**: 介绍晶体材料中应力 ($\sigma$) 与应变 ($\epsilon$) 的线性关系，解释刚度张量 $C_{ijkl}$ 的物理意义。阐述如何利用晶体对称性将 81 个分量的四阶张量降维为 $6 \times 6$ 的 Voigt 矩阵，以及不同晶系（如立方晶系）下的独立分量个数。
- **关键参数**: 无（理论背景）。

### Section 1.2: 应变-应力法 (Strain-Stress Method) 工作流
- **内容**: 详解 DFT 计算弹性常数的核心策略：施加微小应变 -> 固定晶格弛豫原子 -> 计算应力 -> 线性拟合。重点区分“能量-应变法”与“应力-应变法”的区别，明确为何 ABACUS 采用后者（效率更高）。
- **关键参数**: 无（方法论）。

<!-- CHAPTER_START -->
## 第二章：计算准备与结构预优化
**本章逻辑**: 弹性常数对应力极其敏感，计算前的准备工作决定了结果的可靠性。本章涵盖环境配置和至关重要的初始结构优化步骤，这是新手最容易忽视的环节。

### Section 2.1: 辅助工具与环境配置
- **内容**: 介绍计算所需的外部依赖库 pymatgen 及其安装，说明配套 Python 脚本 (`gene_dfm.py`, `compute_dfm.py`) 和 Shell 脚本 (`run_task.sh`) 的功能定位。
- **关键参数**: 无（环境配置）。

### Section 2.2: 初始结构的零应力优化
- **内容**: 强调在施加应变前，必须对原始 `STRU` 进行极高精度的 `cell-relax`。解释残余应力（Residual Stress）如何污染后续的弹性常数拟合，设定收敛标准。
- **关键参数**: 
    - `calculation`: `cell-relax` (仅用于此步，后续严禁使用)
    - `cal_stress`: `1`
    - `cal_force`: `1`
    - `ecutwfc`: (建议设置较高值以保证应力收敛)

<!-- CHAPTER_START -->
## 第三章：变形结构生成与任务分发
**本章逻辑**: 进入实战操作阶段。本章指导读者如何利用脚本自动生成满足胡克定律线性区要求的变形结构文件，并理解这些构型的物理含义。

### Section 3.1: 变形构型生成 (Pre-processing)
- **内容**: 演示使用 `gene_dfm.py` 生成变形结构。解释“24种构型”的来源（6种应变模式 $\times$ 4种应变幅值 $\pm 0.01, \pm 0.005$），讨论应变幅值选择的权衡（太小受数值噪声影响，太大超出线性区）。
- **关键参数**: 无（通过 Python 脚本控制，非 INPUT 参数）。

### Section 3.2: 批量任务管理
- **内容**: 讲解文件目录结构的设计（如 `relax` 文件夹下的子目录结构），以及如何使用 `run_task.sh` 批量生成 ABACUS 输入文件并提交任务。
- **关键参数**: 无（Shell 脚本操作）。

<!-- CHAPTER_START -->
## 第四章：ABACUS 核心计算参数详解
**本章逻辑**: 这是本教程的核心技术章节。详细解读用于计算变形结构的 `INPUT` 文件设置，特别是区分常规优化与弹性常数计算中“弛豫策略”的根本不同。

### Section 4.1: 离子弛豫与应力计算设置
- **内容**: **核心警示**——详解为何在计算变形结构时 `calculation` 必须设为 `relax` 而非 `cell-relax`（固定晶胞形状，仅优化原子位置）。说明开启应力和力计算的必要性。
- **关键参数**: 
    - `calculation`: `relax` (**Critical**)
    - `cal_stress`: `1` (**Critical**)
    - `cal_force`: `1`

### Section 4.2: 精度控制与电子结构参数
- **内容**: 针对弹性计算的高精度需求，推荐电子步的参数设置。涵盖基组截断能、k点密度以及 Smearing 方法的选择，特别是针对金属和绝缘体体系的调整。
- **关键参数**: 
    - `ecutwfc`: (需高精度)
    - `smearing_method`: `gaussian` (推荐)
    - `smearing_sigma`: `0.002` (参考值，需验证收敛性)
    - `mixing_type`: `broyden`
    - `symmetry`: (需查阅文档/测试，通常建议在变形下检查是否需设为 0)

<!-- CHAPTER_START -->
## 第五章：数据拟合与性质分析
**本章逻辑**: 计算完成后，如何从海量的输出文件中提取物理量？本章介绍后处理流程，从原始数据到最终的力学模量。

### Section 5.1: 应力提取与线性拟合
- **内容**: 使用 `compute_dfm.py` 读取 24 个任务的应力输出，执行线性回归求解刚度矩阵 $C_{ij}$。解读脚本输出的日志信息和拟合优度（R-squared）。
- **关键参数**: 无（Python 后处理）。

### Section 5.2: 宏观力学性质计算
- **内容**: 基于计算得到的 $C_{ij}$，利用 Voigt-Reuss-Hill 近似计算多晶材料的杨氏模量 (Young's modulus)、剪切模量 (Shear modulus)、体积模量 (Bulk modulus) 和泊松比 (Poisson's ratio)。简述 Born 稳定性判据的应用。
- **关键参数**: 无（物理公式应用）。

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **单位换算**: 提醒 ABACUS 输出单位（Ry/Bohr, kbar）与常见文献单位（GPa）的换算。
- **Symmetry 陷阱**: 处理剪切变形时可能遇到的对称性报错及解决方案（手动关闭对称性）。
- **收敛性自检**: 如何判断计算结果是否可靠（检查拟合直线及其残差）。