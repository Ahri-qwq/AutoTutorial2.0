<!-- META_START -->
# ABACUS 实战教程：能带结构计算与后处理

## 前言
- **本书逻辑**: 本教程旨在指导读者掌握使用 ABACUS 进行材料电子能带结构计算的全流程。内容设计遵循“物理基础 -> 标准计算路线 -> 进阶紧束缚路线”的认知逻辑，清晰区分了基于 NSCF 的直接计算法和基于 PYATB 的紧束缚模型后处理法，以适应不同科研场景的需求。
- **核心知识点**: 电子能带结构、高对称 K 点路径、非自洽计算 (NSCF)、紧束缚模型 (Tight-Binding)、投影能带 (Fat Band)、能带反折叠 (Band Unfolding)。

<!-- CHAPTER_START -->
## 第一章：计算准备与物理基础
**本章逻辑**: 在进行任何能带计算之前，必须确保体系结构的合理性以及基态电子密度的准确性。本章是所有后续计算的基石。

### Section 1.1: 晶胞选择与结构文件 (STRU)
- **内容**: 阐述在能带计算中选择原胞 (Primitive Cell) 与超胞 (Supercell) 的物理考量。介绍如何准备 `STRU` 文件，并强调 PYATB 后处理对结构文件的特殊依赖（如原子轨道基组匹配）。
- **关键参数**: 无（侧重文件准备与晶体学概念）。

### Section 1.2: 基态自洽计算 (SCF)
- **内容**: 介绍获取收敛电荷密度的流程。这是能带计算的前置步骤，无论是 NSCF 路线还是 PYATB 路线，都需要先通过 SCF 获得系统的基态信息。
- **关键参数**: `calculation` (scf), `basis_type` (lcao/pw)。

<!-- CHAPTER_START -->
## 第二章：标准能带计算路线 (NSCF Method)
**本章逻辑**: 这是最常用的能带计算方法，适用于绝大多数标准晶体体系。本章重点讲解如何利用收敛的电荷密度，通过非自洽计算直接获取本征值。

### Section 2.1: 高对称 K 点路径设置
- **内容**: 解释布里渊区与高对称点的概念。详细演示如何使用 `Atomkit` 等辅助工具自动生成 Line 模式的 `KPT` 文件。
- **关键参数**: `KPT` 文件模式 (Line)。

### Section 2.2: 非自洽计算 (NSCF) 参数配置
- **内容**: 详解从 SCF 到 NSCF 的作业切换流程。重点剖析 `INPUT` 文件中的关键参数设置，特别是对称性的处理，以避免 K 点路径识别错误。
- **关键参数**: `symmetry` (推荐设为 0), `calculation` (待定，需查阅文档确认为 nscf 或 band), `scf_nmax` (通常设为 1 或小值，因为是非自洽)。

### Section 2.3: 数据流与作业提交
- **内容**: 演示如何读取前一步 SCF 生成的电荷密度文件（如 `SPIN1_CHG.cube` 或密度目录），并执行计算。强调分步计算（SCF -> NSCF）的操作规范。
- **关键参数**: `start_charge` (file/atomic，需设置为读取文件)。

<!-- CHAPTER_START -->
## 第三章：进阶能带分析路线 (PYATB & Tight-Binding)
**本章逻辑**: 针对需要更深入分析（如轨道投影、大体系反折叠）的场景，引入基于紧束缚模型的 PYATB 流程。本章将解决传统 NSCF 方法难以处理的复杂问题。

### Section 3.1: 构建紧束缚哈密顿量
- **内容**: 介绍如何在 ABACUS 计算中输出用于构建紧束缚模型的关键矩阵（哈密顿量 HR、重叠矩阵 SR、偶极矩阵 rR）。这是连接 ABACUS 与 PYATB 的桥梁。
- **关键参数**: 待定 (需查阅 ABACUS 文档中关于 "Tight-binding matrices output" 的具体参数)。

### Section 3.2: 投影能带 (Fat Band) 计算
- **内容**: 利用 PYATB 读取矩阵文件与轨道文件 (`.orb`)，计算并绘制投影能带，分析不同原子轨道（s, p, d）对能带的贡献。
- **关键参数**: PYATB 输入参数（非 ABACUS 参数）。

### Section 3.3: 能带反折叠 (Band Unfolding)
- **内容**: 针对掺杂、缺陷或界面等破坏平移对称性的超胞体系，讲解如何利用 PYATB 将能带反折叠回原胞布里渊区，以恢复清晰的能带图像。
- **关键参数**: PYATB 输入参数（涉及超胞与原胞的变换矩阵）。

<!-- APPENDIX_START -->
## 附录：常见问题与避坑指南
- **内容**:
    1.  **对称性陷阱**: 忘记设置 `symmetry = 0` 导致的报错。
    2.  **文件依赖**: 缺少 `.orb` 文件导致 PYATB 无法运行。
    3.  **流程中断**: SCF 不收敛或电荷密度文件丢失对 NSCF 的影响。
    4.  **物理图像**: 区分 Conventional Cell 与 Primitive Cell 对能带图的影响。