<!-- META_START -->
# ABACUS 实战教程：晶胞变胞优化与结构演化

## 前言
- **本书逻辑**: 本教程旨在引导读者掌握计算材料学中至关重要的“晶胞弛豫”技术。我们将从物理本质出发，明确晶胞优化的热力学意义，进而详细讲解 ABACUS 中的参数配置。特别强调“分步优化”的工程策略，以解决收敛难的问题，并针对 LCAO 与 PW 基组的差异提供具体指导。
- **核心知识点**: 晶胞弛豫物理原理、`cell-relax` 核心参数配置、应力与受力收敛标准、自由度约束（体积/形状）、VASP 参数迁移、ASE 外部接口调用。

<!-- CHAPTER_START -->
## 第一章：晶胞弛豫的物理基础与应用场景
**本章逻辑**: 在动手操作前，必须理解计算背后的物理图景。本章阐述晶胞弛豫是为了寻找零温下的基态结构（最小化焓），并解释何时需要进行此类计算。

### Section 1.1: 从原子弛豫到晶胞弛豫
- **内容**: 阐述 `relax` (仅优化原子坐标 $\mathbf{x}_i$) 与 `cell-relax` (同时优化原子坐标 $\mathbf{x}_i$ 与晶格矢量 $\mathbf{L}$) 的本质区别。介绍形变梯度 $\Delta_F$ 的概念，以及如何通过调整晶格矢量来消除内应力。
- **关键参数**: `calculation`

### Section 1.2: 解决的科学问题
- **内容**: 举例说明晶胞优化的应用场景：确定平衡晶格常数、消除人工建模引入的内应力、模拟高压下的相变过程。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第二章：标准晶胞优化流程与参数详解
**本章逻辑**: 这是本教程的核心操作部分。详细讲解如何配置一个标准的晶胞优化任务，特别是如何设置合理的收敛标准以避免计算资源的浪费。

### Section 2.1: 核心输入参数配置
- **内容**: 详解 `INPUT` 文件中的关键设置。重点区分 ABACUS 特有的参数体系，确立“原子位置与晶胞同时优化”的计算模式。
- **关键参数**: `calculation` (设为 cell-relax), `out_stru`, `relax_nmax`

### Section 2.2: 收敛精度的权衡 (PW vs LCAO)
- **内容**: 深入探讨受力 (`force`) 和应力 (`stress`) 的收敛阈值设置。**重点强调**：由于“蛋盒效应”，LCAO 基组下不可追求过高的受力精度，需给出推荐值；PW 基组则可设置更高精度。同时明确应力单位的换算。
- **关键参数**: `force_thr_ev` (推荐值: PW=0.01/0.001, LCAO=0.04), `stress_thr` (单位 kBar)

### Section 2.3: 施加外压与目标控制
- **内容**: 讨论如何在优化过程中施加外部压强（如模拟地核环境或高压相变）。*注：需提醒读者查阅官方文档以确认具体的“目标压强”参数名。*
- **关键参数**: `stress_thr`, `target_pressure` (待定，需查阅文档)

<!-- CHAPTER_START -->
## 第三章：最佳实践策略——分步优化法
**本章逻辑**: 针对新手常犯的“直接跑 cell-relax 导致不收敛”的错误，提出工业界标准的“两步走”策略，这是保证计算成功率的关键。

### Section 3.1: "先 Relax 后 Cell-Relax" 策略
- **内容**: 详细演示标准工作流：第一步先固定晶胞优化原子位置 (`relax`)，待体系接近局部极小值后，第二步再开启晶胞自由度 (`cell-relax`)。解释为什么这样做能显著提高收敛效率。
- **关键参数**: `calculation` (先 relax 后 cell-relax)

### Section 3.2: 应对收敛困难
- **内容**: 分析当结构优化震荡或不收敛时的排查顺序。强调 SCF 收敛是结构优化的前提，优先检查电子步设置。
- **关键参数**: `scf_thr`, `smearing`

<!-- CHAPTER_START -->
## 第四章：进阶控制——自由度约束与对称性
**本章逻辑**: 满足特定物理需求的优化（如层状材料固定体积优化、保持晶体对称性）。本章涵盖 ABACUS 原生功能及 ASE 高级接口，并提供 VASP 用户的迁移指南。

### Section 4.1: 限定自由度优化 (Constrained Optimization)
- **内容**: 讲解如何只优化形状但固定体积，或只优化体积但固定形状。这在计算形变势或特定力学性质时非常有用。
- **关键参数**: `fixed_axes` (volume/shape), `fixed_atoms`

### Section 4.2: 对称性保持与 ASE 接口
- **内容**: 讨论晶胞优化中的对称性破缺问题（如 bcc 坍塌为 fcc）。介绍如何使用 ABACUS 原生参数或通过 Python ASE 接口 (`FixSymmetry`, `UnitCellFilter`) 进行强约束优化。
- **关键参数**: `fixed_ibrav` (需查阅文档), ASE 库相关类

### Section 4.3: VASP 用户迁移指南 (ISIF 对照)
- **内容**: 提供 VASP `ISIF` 参数与 ABACUS `fixed_axes`/`fixed_atoms` 组合的映射表，帮助有经验的用户快速上手。
- **关键参数**: `fixed_axes`, `fixed_atoms`, `cal_stress`

<!-- APPENDIX_START -->
## 附录：常见陷阱与调试清单
- **LCAO 精度陷阱**: 再次警示 Egg box effect 导致的受力基底误差。
- **单位换算**: 强调 `stress_thr` (kBar) 与 GPa 的换算关系。
- **对称性破缺**: 提醒高对称性结构在无约束优化下的自发破缺风险。