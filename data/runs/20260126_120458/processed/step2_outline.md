<!-- META_START -->
# ABACUS 实战指南：平面波截断能 (Ecut) 收敛性测试

## 前言
- **本书逻辑**: 本教程遵循“理论认知 -> 参数配置 -> 自动化执行 -> 数据分析”的闭环逻辑。首先明确截断能的物理意义，随后重点讲解如何利用 Shell 脚本实现参数的批量扫描，最后建立科学的收敛判据，帮助读者在计算精度与资源消耗之间找到最佳平衡点。
- **核心知识点**: 平面波基组展开、`ecutwfc` 参数详解、Shell 脚本自动化工作流 (`sed`/`grep`)、收敛性判据 (1 meV/atom)。

<!-- CHAPTER_START -->
## 第一章：平面波截断的物理原理
**本章逻辑**: 在动手计算前，必须理解“截断能”为何存在以及它如何影响计算结果。本章旨在建立物理图像，解释为何我们需要人为引入近似，以及这种近似带来的误差特性。

### Section 1.1: 平面波基组与截断近似
- **内容**: 简述周期性体系中波函数如何通过平面波基组展开。解释理论上需要无穷多平面波才能精确描述波函数，但在实际计算中必须在动能某处“截断”的必要性。
- **关键参数**: 无

### Section 1.2: 截断能 (Cutoff Energy) 的权衡艺术
- **内容**: 阐述截断能大小与计算精度（基矢量数量）及计算成本（内存、时间）之间的矛盾关系。说明收敛性测试的目标：寻找性价比最高的“甜点”数值。
- **关键参数**: `ecutwfc`

<!-- CHAPTER_START -->
## 第二章：测试环境与参数配置
**本章逻辑**: 明确 ABACUS 输入文件的核心设置。重点在于区分“变量”与“控制变量”，确保测试结果的唯一变量是截断能，避免因其他参数干扰导致数据无效。

### Section 2.1: 关键输入参数设置
- **内容**: 详解 INPUT 文件中涉及截断能的核心参数。明确基组类型必须设为平面波模式。特别说明 `ecutwfc` 的推荐扫描范围（20-120 Ry）及步长设置。
- **关键参数**: `basis_type` (设为 pw), `ecutwfc`

### Section 2.2: 关联参数与潜在风险 (`ecutrho`)
- **内容**: 讨论波函数截断能与电荷密度截断能的关系。由于素材未明确默认比例，需引导读者查阅文档确认是否需要显式设置 `ecutrho`（通常需大于 `ecutwfc`），防止因电荷密度描述不准导致的虚假收敛。
- **关键参数**: `ecutrho` (待定，需查阅文档), `ecutwfc`

### Section 2.3: 控制变量：结构与 K 点
- **内容**: 强调在测试过程中 `STRU` (晶胞与原子位置) 和 `KPT` (K点网格) 必须保持绝对静止。解释为何改变这些量会导致能量基准漂移，从而使测试失效。
- **关键参数**: 无 (涉及文件 `STRU`, `KPT`)

<!-- CHAPTER_START -->
## 第三章：自动化测试工作流 (Workflow)
**本章逻辑**: 手动修改参数不仅低效且极易出错。本章作为实战核心，教授如何利用 Shell 脚本结合 ABACUS 接口进行批量计算，这是高通量计算的基础技能。

### Section 3.1: 构建 Shell 自动化脚本
- **内容**: 编写 Bash 脚本，利用 `for` 循环遍历 `ecutwfc` 数值。重点讲解如何使用 `sed` 命令动态修改 INPUT 文件中的参数，以及如何设置 `suffix` 以区分不同任务的输出目录，防止文件覆盖。
- **关键参数**: `suffix`, `ecutwfc`

### Section 3.2: 任务提交与并行策略
- **内容**: 讲解脚本中的执行命令 (`mpirun`)。特别指出并行核数选择的原则（不应远超原子数），避免因进程通讯开销过大导致的效率降低。
- **关键参数**: 无 (涉及命令 `mpirun`)

<!-- CHAPTER_START -->
## 第四章：数据分析与收敛判据
**本章逻辑**: 计算完成后，如何从海量日志中提取有效信息并做出科学决策是最后一步。本章将定性和定量地分析测试结果。

### Section 4.1: 数据清洗与提取
- **内容**: 使用 `grep` 命令从标准输出文件 (`running_scf.log`) 中提取最终的总能量 (`final etot is`)。构建“截断能-总能量”的数据表格。
- **关键参数**: 无 (涉及日志关键词 `final etot is` 或 `final e tote is`)

### Section 4.2: 确立收敛标准
- **内容**: 绘制 E_total vs. Ecut 曲线。定义收敛判据（通常为能量差 < 1 meV/atom）。指导读者如何根据曲线的平滑程度和能量差阈值，确定最终用于生产环境的 `ecutwfc` 数值。
- **关键参数**: 无

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **内存溢出 (OOM)**: 警惕过大的 `ecutwfc` 导致节点崩溃。
- **赝势依赖性**: 强调更换赝势（如从 Ultrasoft 换为 PAW 或 Norm-Conserving）后，必须重新进行截断能测试。
- **进阶收敛**: 提及力 (Force) 和应力 (Stress) 的收敛可能需要比总能量更高的截断能（针对结构弛豫任务）。