<!-- META_START -->
# ABACUS 实战教程：基于 LCAO 基组的线性光学性质计算

## 前言
- **本书逻辑**: 本教程遵循“理论基础 -> 基态计算与矩阵生成 -> 光学响应计算 -> 数据后处理与物理分析”的教学逻辑。从第一性原理出发，利用紧束缚近似（Tight-Binding）思想，通过 ABACUS 生成哈密顿量与偶极矩阵，再结合 pyatb 工具计算介电函数，最终推导出一系列线性光学性质。
- **核心知识点**: 
    - 线性响应理论与 Kubo-Greenwood 公式。
    - LCAO 基组下的紧束缚矩阵（Hamiltonian, Overlap, Dipole）生成。
    - 介电函数（实部/虚部）的计算流程。
    - 费米能级（Fermi Energy）在分步计算中的传递。
    - 吸收系数、折射率、消光系数等光学常数的推导与单位换算。

<!-- CHAPTER_START -->
## 第一章：理论基础与计算原理
**本章逻辑**: 在动手计算前，必须理解材料光学性质的微观来源以及计算软件背后的物理模型，特别是 LCAO 基组如何通过紧束缚模型衔接光学性质计算。

### Section 1.1: 线性光学响应与介电函数
- **内容**: 介绍介电函数 $\epsilon(\omega) = \epsilon_1(\omega) + i\epsilon_2(\omega)$ 的物理意义。解释虚部 $\epsilon_2$ 对应光吸收（电子跃迁），实部 $\epsilon_1$ 对应光色散，以及两者如何通过 Kramers-Kronig 关系关联。
- **关键参数**: 无

### Section 1.2: 基于原子轨道基组的紧束缚模型
- **内容**: 阐述 ABACUS 如何利用数值原子轨道（NAO）构建实空间的哈密顿矩阵 $H(R)$、重叠矩阵 $S(R)$ 和位置/偶极矩阵 $r(R)$。这是后续使用 pyatb 进行计算的核心数据基础。
- **关键参数**: `basis_type` (需设置为 lcao)

### Section 1.3: Kubo-Greenwood 公式
- **内容**: 简要说明利用速度矩阵元计算光电导率 $\sigma(\omega)$ 的原理，以及光电导率与介电函数的关系。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第二章：基态自洽计算与矩阵生成 (ABACUS)
**本章逻辑**: 光学性质计算依赖于高质量的电子基态波函数和矩阵信息。本章重点在于如何配置 ABACUS 输入文件，使其输出 pyatb 所需的稀疏矩阵文件。

### Section 2.1: 结构建模与输入文件准备
- **内容**: 以晶态 $\mathbf{SiO_2}$ 为例，准备 `STRU` (结构)、`KPT` (K点) 和赝势/轨道文件。强调光学性质计算通常需要比常规 SCF 更密的 K 点网格以保证积分精度。
- **关键参数**: `calculation` (scf), `basis_type` (lcao)

### Section 2.2: 关键控制参数设置
- **内容**: 详解 `INPUT` 文件中用于输出矩阵的特殊参数。这是本教程与普通 SCF 计算最大的区别。
- **关键参数**: 
    - `out_mat_hs2`: 设置为 1 (输出稀疏格式 H 和 S 矩阵)
    - `out_mat_r`: 设置为 1 (输出位置/偶极矩阵，计算跃迁偶极矩必备)
    - `out_chg`: 设置为 1 (输出电荷密度)

### Section 2.3: 运行计算与结果检查
- **内容**: 提交任务运行 ABACUS。检查输出日志 `running_scf.log`，**重点提取费米能级 (Fermi Energy)** 和占据带数目，并确认生成的 `.csr` 矩阵文件（`data-HR-sparse...`, `data-SR-sparse...`, `data-rR-sparse...`）是否存在。
- **关键参数**: `E_Fermi` (从 log 中读取)

<!-- CHAPTER_START -->
## 第三章：介电函数计算 (pyatb)
**本章逻辑**: 利用上一步生成的矩阵文件，使用 pyatb 模块进行非自洽的光学响应计算。本章的核心在于正确配置 pyatb 的输入接口，确保物理量的一致性。

### Section 3.1: 数据准备与环境配置
- **内容**: 将 ABACUS 生成的矩阵文件转移至 pyatb 工作目录。介绍 pyatb 的基本输入文件结构。
- **关键参数**: `HR_route`, `SR_route`, `rR_route`

### Section 3.2: 编写 pyatb 输入文件
- **内容**: 详细讲解 `Input` 文件的编写。**特别强调必须手动填入从 SCF 计算中获取的费米能级**，以及正确填写晶格常数和矢量。
- **关键参数**: 
    - `fermi_energy`: (必须与 SCF log 严格一致)
    - `occ_band`: (占据带数目)
    - `omega`, `domega`: (能量范围与步长)
    - `eta`: (展宽因子)
    - `grid`: (光学计算用的 K 点网格，通常需加密)

### Section 3.3: 运行 pyatb 与输出解析
- **内容**: 运行 pyatb 程序。解析输出文件 `dielectric_function_real_part.dat` 和 `dielectric_function_imag_part.dat` 的数据格式（能量 vs 张量分量 xx, yy, zz 等）。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第四章：后处理与线性光学性质分析
**本章逻辑**: 原始的介电函数数据往往不能直接对应实验光谱。本章通过 Python 脚本，演示如何将介电函数转化为折射率、吸收系数等实验可观测的物理量，并解决复杂的单位换算问题。

### Section 4.1: 介电函数的可视化
- **内容**: 使用 Python (Matplotlib) 读取并绘制介电函数的实部和虚部。分析张量分量（如 xx, yy, zz）的各向异性。
- **关键参数**: 无

### Section 4.2: 导出量的物理推导与计算
- **内容**: 根据公式计算折射率 $n(\omega)$、消光系数 $\kappa(\omega)$、能量损失函数 $L(\omega)$ 和反射率 $R(\omega)$。
- **关键参数**: 无

### Section 4.3: 吸收系数的单位换算（难点）
- **内容**: 详细推导吸收系数 $\alpha(\omega)$ 的计算公式。重点讲解如何处理公式中的 $\hbar$、光速 $c$ 以及能量单位 eV，将结果正确转换为实验常用的 $cm^{-1}$ 单位。
- **关键参数**: `absorption_coefficient` (Python 变量)

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **K 点收敛性**: 为什么光学性质计算需要比总能计算更密的 K 点？
- **空带数量**: 占据带与空带数量对高能区光谱的影响。
- **单位陷阱**: ABACUS 输出单位 (Ry/Bohr) 与 pyatb 输入单位配置的注意事项。
- **费米能级错误**: 如果 `fermi_energy` 填错会导致什么样的物理图像错误（如金属/绝缘体性质误判）。