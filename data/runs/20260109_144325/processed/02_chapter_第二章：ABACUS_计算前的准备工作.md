# 第二章：ABACUS 计算前的准备工作

在正式开始弹性常数的计算之前，需要对 ABACUS 的基本输入参数有所了解，并且准备好合适的初始结构。这部分内容将帮助读者熟悉 ABACUS 的工作环境，并确保他们具备进行下一步工作的条件。

## 2.1 关键输入参数解析

### 2.1.1 `cal_stress` 和 `cal_force`

在进行弹性常数计算时，我们需要开启应力和力的计算功能。具体参数名请查阅 ABACUS 官方文档以确认（例如 `cal_stress` 和 `cal_force`）。这些参数用于控制是否在自洽场迭代过程中计算应力张量和原子受力。

- **物理意义**：应力张量描述了晶体内部的应力状态，而原子受力则反映了原子间的相互作用。这些信息对于理解材料的力学行为至关重要。
- **推荐设置**：通常情况下，为了进行弹性常数计算，这两个参数都应该设置为 `1` 或 `true`。

### 2.1.2 `gamma_only`

- **物理意义**：该参数决定了是否只在 Γ 点进行 k 点采样。当设置为 `0` 时，表示使用完整的 k 点网格；设置为 `1` 时，仅在 Γ 点进行采样。
- **推荐值**：对于大多数情况，推荐设置为 `0`，因为这可以提高计算结果的精度。但在某些特定情况下，如小体系或测试阶段，可以考虑设置为 `1` 以减少计算量。

### 2.1.3 `smearing_method` 和 `smearing_sigma`

- **物理意义**：费米面展宽方法 (`smearing_method`) 用于处理金属系统的电子占据问题，避免出现不连续的电子态密度。`smearing_sigma` 则是展宽的宽度。
- **推荐值**：
  - `smearing_method`: 推荐使用 `gaussian` 方法，因为它在数学上更为平滑，有助于提高数值稳定性。
  - `smearing_sigma`: 推荐设置为 `0.002` (单位为 Hartree)，这是一个常用的值，适用于大多数金属系统。

### 示例 INPUT 文件
```plaintext
INPUT_PARAMETERS
cal_stress [PARAMETER_MISSING]  # 请查阅官方文档确认具体参数名
cal_force [PARAMETER_MISSING]   # 请查阅官方文档确认具体参数名
gamma_only 0
smearing_method gaussian
smearing_sigma 0.002
```

## 2.2 晶体结构优化

在进行弹性常数计算之前，必须先对晶胞进行优化，以消除残余应力并确保初始结构处于势能面的局部极小值点。这是因为未优化的结构可能包含不必要的应力，从而影响弹性常数的准确性。

### 2.2.1 为什么需要优化

- **消除残余应力**：未优化的结构可能包含内应力，这些应力会影响弹性常数的计算结果。
- **势能面局部极小值点**：优化后的结构处于势能面的局部极小值点，这有助于获得更准确的弹性常数。

### 2.2.2 如何准备 STRU 文件

STRU 文件包含了晶胞参数和原子位置信息。以下是一个示例：

```plaintext
ATOMIC_SPECIES
U 238.0508 U-5spdf.upf

LATTICE_CONSTANT
1.8897259886  # 1.8897259886 Bohr = 1.0 Angstrom

LATTICE_VECTORS
a1 a2 a3
b1 b2 b3
c1 c2 c3

ATOMIC_POSITIONS
U 0.0 0.0 0.0
```

- **晶格常数**：默认单位为 Bohr，可以通过 `LATTICE_CONSTANT` 设置。
- **晶格向量**：通过 `LATTICE_VECTORS` 设置三个晶格向量。
- **原子位置**：通过 `ATOMIC_POSITIONS` 设置原子的位置。

### 2.2.3 注意事项

- **K 点采样**：适当的 K 点采样对于应力张量的计算精度至关重要。建议使用足够密集的 K 点网格，特别是在计算弹性常数时。
- **基组截断**：选择合适的平面波截止能量 (`ecutwfc`) 也是关键。过低的截断能量会导致计算结果不准确，而过高的截断能量会增加计算成本。

### 示例 KPT 文件
```plaintext
K_POINTS
0
Gamma
```

### 示例优化脚本
```bash
#!/bin/bash

# 优化结构
abacus m=opt STRU=STRU OPT_STRU=OPTSTRU

# 检查优化结果
grep "Total energy" OUT.ABACUS/running_scf.log
```

通过以上步骤，您可以准备好进行弹性常数计算所需的初始结构和输入参数。确保在实际操作中查阅最新的 ABACUS 官方文档，以获取最准确的信息。