<!-- META_START -->
# ABACUS 实战教程：晶体弹性常数计算

## 前言
- **本书逻辑**: 本教程遵循“理论基础 -> 模型准备 -> 自动化工作流 -> 结果分析”的教学逻辑。从广义胡克定律出发，强调“零应力”初始结构的重要性，随后引入 `abacustest` 自动化工具处理复杂的形变任务，最后解析弹性张量数据的物理意义。
- **核心知识点**: 广义胡克定律、Voigt 记号、应力-应变法、内部弛豫 (Internal Relaxation)、`abacustest` 工作流、ABACUS 应力计算参数。

<!-- CHAPTER_START -->
## 第一章：弹性力学理论与计算原理
**本章逻辑**: 在动手计算前，必须理解物理本质。本章简述如何将宏观力学性质映射到微观的第一性原理计算中，解释为什么我们需要计算应力张量。

### Section 1.1: 广义胡克定律与应力-应变法
- **内容**: 介绍材料本构关系，解释应力 ($\sigma$) 与应变 ($\epsilon$) 的线性关系。阐述“应力-应变法”的核心思想：通过施加已知微小应变，计算第一性原理应力，从而反推弹性刚度张量 ($C$)。
- **关键参数**: 无

### Section 1.2: 对称性约化与 Voigt 记号
- **内容**: 解释如何利用晶体对称性将 81 个分量的四阶张量简化。介绍 Voigt 记号（$6 \times 6$ 矩阵表示法），重点说明立方晶系（如 Si, Cu）仅需计算 $C_{11}, C_{12}, C_{44}$ 三个独立分量的原理。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第二章：初始结构准备与零应力优化
**本章逻辑**: “垃圾进，垃圾出”。计算弹性常数对应力极其敏感，本章重点讲解如何获得一个完美的、无残余应力的初始构型，这是后续所有计算的基石。

### Section 2.1: 晶胞选择与标准化
- **内容**: 讨论原胞 (Primitive Cell) 与惯用胞 (Conventional Cell) 的选择对弹性常数定义的影响。建议使用惯用胞并将晶格矢量与笛卡尔坐标轴对齐（或遵循 IEEE 标准），以便直接对比 Materials Project 数据库。使用 ASE 生成 Si 结构作为案例。
- **关键参数**: 无（涉及 ASE 脚本）

### Section 2.2: 消除残余应力 (高精度弛豫)
- **内容**: 详述如何使用 ABACUS 进行变胞优化 (`cell-relax`)。强调此时必须将残余应力降至极低水平，否则会导致后续拟合的零点漂移。
- **关键参数**: 
    - `calculation`: `cell-relax`
    - `cal_stress`: `1` (必须开启)
    - `cal_force`: `1`
    - `relax_nmax`: (确保收敛的步数)
    - `press_conv`: (建议设置高精度，如 0.1 kbar 或更低，需查阅文档确认默认值)

<!-- CHAPTER_START -->
## 第三章：基于 abacustest 的自动化工作流
**本章逻辑**: 手动施加几十种应变并管理文件夹极易出错。本章引入 `abacustest` 工具，详解如何自动化生成形变任务、管理输入文件以及理解“内部弛豫”的关键物理意义。

### Section 3.1: 自动化生成形变结构
- **内容**: 演示使用 `abacustest` 里的 `lib-elastic` 模块生成形变任务。解释正应变 (Norm) 和剪切应变 (Shear) 的设置范围（通常 $\pm 1\%$），以及文件目录结构 (`deform-xxx`) 的含义。
- **关键参数**: 
    - `abacustest` 参数: `--norm` (推荐 0.01), `--shear` (推荐 0.01)

### Section 3.2: 关键物理设置：内部弛豫 (Internal Relaxation)
- **内容**: **（核心难点）** 解释在施加晶格形变后，为何必须固定晶胞但允许原子位置弛豫。对比“Clamped-ion”（无弛豫）与“Relaxed-ion”（有弛豫）的区别，明确本教程采用 Relaxed-ion 方法以符合实验值。配置 ABACUS 输入文件以适应此步骤。
- **关键参数**: 
    - `calculation`: `relax` (注意：此处不再是 cell-relax，而是固定晶格优化原子)
    - `cal_stress`: `1`
    - `abacustest` 参数: 避免使用 `--norelax` (除非特意需要 clamped 结果)

### Section 3.3: 任务提交与管理
- **内容**: 介绍如何批量生成 ABACUS 输入文件夹并提交计算。强调检查 `INPUT` 文件的一致性（如 K 点、基组、DFT+U 设置）。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第四章：数据后处理与结果分析
**本章逻辑**: 计算完成后，如何从海量的输出文件中提取有用的物理量？本章讲解拟合过程和宏观模量的推导。

### Section 4.1: 应力张量提取与拟合
- **内容**: 使用 `abacustest` 后处理命令自动提取每个形变任务的应力数据。简述最小二乘法拟合过程，输出弹性刚度矩阵 $C_{ij}$。
- **关键参数**: 无（`abacustest` 后处理命令）

### Section 4.2: 宏观力学模量计算
- **内容**: 基于拟合得到的 $C_{ij}$，计算体模量 ($B$)、剪切模量 ($G$)、杨氏模量 ($E$) 和泊松比 ($\nu$)。以 Si 案例为例，对比计算结果与文献/实验值，验证计算准确性。
- **关键参数**: 无

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **收敛性陷阱**: 提醒 K 点密度 (`KPT`) 和平面波截断/基组精度对应力计算的敏感性。
- **DFT+U 的必要性**: 针对强关联体系（如过渡金属氧化物），强调必须正确设置 `dft_plus_u`，否则力学性质可能完全错误。
- **对称性破缺**: 简述施加应变后对称性降低的问题，以及软件如何处理。
- **操作风险**: 提醒 `abacustest` 覆盖文件夹的风险，建议备份。