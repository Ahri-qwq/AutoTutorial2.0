<!-- META_START -->
# ABACUS 实战教程：态密度 (DOS/PDOS) 计算与轨道分析

## 前言
- **本书逻辑**: 本教程遵循“物理概念 -> 标准计算流程 -> 数据后处理与分析 -> 高阶方法”的递进逻辑。首先确立态密度与能带的物理对应关系，随后重点讲解基于 KS-DFT 的标准“两步法”计算流程，紧接着深入讲解如何处理数据（如费米能级对齐）和分析轨道贡献（PDOS），最后介绍针对大体系的随机波函数（SDFT）计算方法。
- **核心知识点**: 
    - 态密度（DOS）与分波态密度（PDOS）的物理含义。
    - 标准 KS-DFT 下的 SCF 到 NSCF 计算流程。
    - ABACUS 关键参数设置（能量窗口、高斯展宽、K点采样）。
    - 随机波函数 DFT (SDFT) 在 DOS 计算中的应用。
    - 结果数据的可视化与物理图像解读。

<!-- CHAPTER_START -->
## 第一章：物理基础与计算原理
**本章逻辑**: 在动手计算前，必须理解 DOS 的物理意义及其与材料性质的关联，这是判断计算结果是否合理的基石。

### Section 1.1: 态密度 (DOS) 的物理图景
- **内容**: 解释 DOS 的定义（单位能量范围内的量子态数目），阐述其与能带结构的关系（能带在能量空间的积分）。介绍“范霍夫奇点 (Van Hove Singularities)”的概念，即 DOS 峰值通常对应能带平坦区。
- **关键参数**: 无。

### Section 1.2: 分波态密度 (PDOS) 与轨道投影
- **内容**: 介绍 PDOS 的概念，即将波函数投影到原子轨道（s, p, d, f）上。解释如何通过 PDOS 分析成键性质（如杂化轨道）以及特定元素对总态密度的贡献。
- **关键参数**: 无。

### Section 1.3: 材料性质的判据
- **内容**: 讲解如何通过费米能级处的 DOS 值来区分金属（高 DOS）、半导体（低 DOS/带隙）和绝缘体（大带隙）。
- **关键参数**: 无。

<!-- CHAPTER_START -->
## 第二章：标准 KS-DFT 计算流程 (Standard Workflow)
**本章逻辑**: 这是绝大多数用户（初学者及进阶者）最常用的计算路径。本章将严格区分 SCF 和 NSCF 两个步骤，强调电荷密度的传递。

### Section 2.1: 流程概览与结构准备
- **内容**: 概述“结构弛豫 -> 自洽计算 (SCF) -> 非自洽计算 (NSCF)”的标准工作流。强调必须基于弛豫好的结构进行计算。
- **关键参数**: 无。

### Section 2.2: 第一步：自洽计算 (SCF)
- **内容**: 运行标准的 SCF 计算以获得收敛的基态电子密度。说明此步骤是 DOS 计算的基础，必须保证收敛精度。
- **关键参数**: `calculation` (设置为 scf)。

### Section 2.3: 第二步：非自洽计算 (NSCF) 设置
- **内容**: 详细讲解如何配置 NSCF 计算。重点在于读取上一步生成的电荷密度，并固定电荷密度进行非自洽迭代。
- **关键参数**: 
    - `calculation` (设置为 nscf 或类似非自洽模式)。
    - **电荷密度读取参数**: 待定(需查阅文档，通常涉及 `init_chg` 或类似指令)。

### Section 2.4: DOS 核心参数配置
- **内容**: 详解控制 DOS 输出的具体参数。指导如何根据体系能带范围选择能量窗口，以及如何平衡能量分辨率与文件大小。
- **关键参数**: 
    - `out_dos` (必须设为 1)。
    - `dos_emin_ev` (能量下限)。
    - `dos_emax_ev` (能量上限)。
    - `dos_edelta_ev` (能量间隔/分辨率)。

### Section 2.5: K 点网格与展宽设置
- **内容**: 讨论 NSCF 计算中 K 点设置的重要性（通常需比 SCF 更密以获得平滑曲线）。讲解高斯展宽因子的选择策略。
- **关键参数**: 
    - `K_POINTS` (文件设置)。
    - `dos_sigma` (高斯展宽因子)。

<!-- CHAPTER_START -->
## 第三章：数据处理与可视化分析
**本章逻辑**: 算出数据只是完成了一半。本章指导用户如何处理原始数据（特别是费米能级对齐），并利用工具生成可发表级别的图表。

### Section 3.1: 输出文件结构解析
- **内容**: 解析 `OUT` 文件夹中的内容，识别总态密度文件和分波态密度文件。说明文件各列数据的含义。
- **关键参数**: 无。

### Section 3.2: 数据后处理：费米能级对齐
- **内容**: 强调原始输出的能量标度通常相对于真空能级或平均静电势。演示如何从输出文件中读取费米能级（Fermi Energy），并在绘图数据中减去该值，将 $E_F$ 对齐到 0 eV。
- **关键参数**: 无。

### Section 3.3: 绘图实战与案例分析
- **内容**: 以硅（Si）或其他典型材料为例，展示 DOS/PDOS 的绘图结果。结合第一章的物理知识，分析图中的特征峰与能带的对应关系。
- **关键参数**: 无。

### Section 3.4: 自动化工具链 (Bohrium & Atomkit)
- **内容**: 简要介绍 ABACUS 生态中的辅助工具（如 Bohrium 平台的 `abacus_dos_run` 或 Atomkit），展示如何通过脚本自动化处理 DOS 数据。
- **关键参数**: 无。

<!-- CHAPTER_START -->
## 第四章：进阶方法：随机波函数 DFT (SDFT)
**本章逻辑**: 针对高温或超大体系，传统的 KS-DFT 可能效率不足。本章介绍 ABACUS 特有的随机波函数方法计算 DOS，作为高级选修内容。

### Section 4.1: SDFT 适用场景与原理
- **内容**: 简述 SDFT 适合处理大体系或高温条件的优势。明确指出其与标准 KS-DFT 参数设置的区别。
- **关键参数**: `esolver_type` (设置为 sdft)。

### Section 4.2: SDFT 计算参数详解
- **内容**: 讲解 SDFT 模式下特有的 DOS 计算参数，包括后处理模式的开启和切比雪夫展开阶数。
- **关键参数**: 
    - `method_sto` (设置为 2)。
    - `dos_nche` (切比雪夫展开阶数)。

### Section 4.3: 内存控制与性能优化
- **内容**: 针对大体系计算可能遇到的内存瓶颈，介绍如何通过参数降低内存消耗。
- **关键参数**: `npart_sto` (内存控制参数)。

<!-- APPENDIX_START -->
## 附录：常见问题与避坑指南
- **内存溢出 (OOM)**: 特别是在 SDFT 计算中的处理方案。
- **能量窗口截断风险**: `dos_emin/max_ev` 设置过窄导致深能级或高能级信息丢失。
- **展宽因子陷阱**: `dos_sigma` 过大导致特征消失，过小导致噪声过大。
- **两步法原则**: 再次强调不可跳过 SCF 直接跑 DOS。