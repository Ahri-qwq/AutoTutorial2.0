# 第一章：物理基础与计算原理

在真正开始编写 `INPUT` 文件和提交任务之前，我们需要先建立正确的物理直觉。态密度（Density of States, DOS）不仅仅是一条曲线，它是连接量子力学微观状态与宏观材料性质的桥梁。

本章将带你理解 DOS 背后的物理图景，并阐述在 ABACUS 中计算 DOS 的核心工作流逻辑。理解这些原理，是你判断计算结果是否“靠谱”的基石。

## 1.1 态密度 (DOS) 的物理图景

### 1.1.1 定义与直观理解
**态密度 (DOS)**，记为 $N(E)$，定义为在能量 $E$ 到 $E+dE$ 区间内，系统允许占据的量子态数目。

如果把电子比作住进大楼的住户，能带结构（Band Structure）告诉我们大楼每一层（能量）有哪些房间（k点），而 DOS 则直接统计每一层楼到底有多少个房间。
- **高 DOS 值**：意味着在该能量处有大量的量子态可供电子占据。
- **零 DOS 值**：意味着该能量处没有量子态（即禁带）。

### 1.1.2 范霍夫奇点 (Van Hove Singularities) —— 校验结果的利器
DOS 是能带结构在布里渊区（Brillouin Zone）的积分。数学上，DOS 与能带的梯度成反比：
$$ N(E) \propto \int \frac{dS}{|\nabla_k E(k)|} $$
这意味着：
- **能带越平坦（Flat Band）**：$\nabla_k E(k)$ 趋近于 0，DOS 会出现尖锐的峰值。
- **能带越陡峭（Dispersive Band）**：电子有效质量小，DOS 相对平缓且数值较低。

> **💡 锦囊妙计：如何一眼判断 DOS 是否合理？**
> 利用**范霍夫奇点**的概念。当你看到 DOS 图上有一个巨大的尖峰时，去对照能带图。如果该能量对应的是一条非常平坦的能带（例如 d 轨道或 f 轨道形成的窄带），那么这个峰是物理真实的。如果能带很陡峭却出现了尖峰，那可能是计算参数（如 K 点采样或展宽）设置有问题。

---

## 1.2 分波态密度 (PDOS) 与轨道投影

总态密度（Total DOS）反映了整体性质，但为了理解化学键，我们需要**分波态密度（Projected DOS, PDOS）**。

### 1.2.1 投影原理
PDOS 是将系统的总波函数 $|\psi_{nk}\rangle$ 投影到以原子为中心的局域轨道（Atomic Orbitals, 如 s, p, d, f）上。
$$ N_{\alpha}(E) = \sum_{n,k} |\langle \phi_{\alpha} | \psi_{nk} \rangle|^2 \delta(E - E_{nk}) $$
在 ABACUS 中，如果你使用 LCAO（原子轨道线性组合）基组（`basis_type = lcao`），这种投影是非常自然且高效的，因为波函数本身就是由原子轨道展开的。

### 1.2.2 化学分析应用
通过 PDOS，我们可以解析材料的“基因”：
1.  **元素贡献**：在这个能量范围内，是 A 原子贡献大，还是 B 原子贡献大？
2.  **轨道杂化**：如果 A 原子的 $d$ 轨道峰与 B 原子的 $p$ 轨道峰在同一能量位置重合，且形状相似，说明它们之间发生了强烈的 **$p-d$ 杂化**成键。

---

## 1.3 材料性质的判据

费米能级（$E_F$）是电子填充的最高水位线。通过观察 $E_F$ 处的 DOS 行为，我们可以一锤定音地判断材料属性：

| 材料类型 | DOS 特征 ($E_F$ 处) | 物理意义 |
| :--- | :--- | :--- |
| **金属 (Metal)** | $N(E_F) > 0$ | 费米面穿过能带，电子极易被激发导电。 |
| **半导体 (Semiconductor)** | $N(E_F) = 0$ | 存在较小的带隙（Band Gap），价带顶与导带底分开。 |
| **绝缘体 (Insulator)** | $N(E_F) = 0$ | 存在巨大的带隙。 |
| **半金属 (Half-metal)** | 自旋向上 $>0$，自旋向下 $=0$ | 对一种自旋是金属，对另一种是绝缘体（自旋电子学关键材料）。 |

---

## 1.4 ABACUS 计算原理与工作流

在动手操作前，必须澄清 ABACUS 中的两种计算路径以及标准的“两步法”流程。

### 1.4.1 关键区分：标准 KS-DFT vs. SDFT
ABACUS 提供了多种计算方法，初学者极易混淆：

1.  **标准 KS-DFT (Kohn-Sham DFT)**：
    *   **适用场景**：绝大多数材料计算（基态性质、能带、DOS）。
    *   **特征**：基于平面波（PW）或原子轨道（LCAO）基组，通过对角化哈密顿量求解。
    *   **本教程重点**：我们将专注于此路径。

2.  **SDFT (Stochastic DFT)**：
    *   **适用场景**：超大体系（数千/上万原子）或高温稠密物质（温稠密物质）。
    *   **特征**：基于随机波函数演化。
    *   **警示**：SDFT 涉及如 `method_sto`, `nche_sto` 等特殊参数。**如果你做的是常规材料分析，请忽略这些参数，不要在 INPUT 文件中添加它们，否则会导致计算模式错误。**

### 1.4.2 核心策略：SCF + NSCF 两步法
计算 DOS **绝不是**一次性完成的任务。为了获得平滑、准确的 DOS 曲线，必须遵循“两步走”策略：

#### **第一步：自洽场计算 (SCF)**
*   **目标**：寻找基态电子密度 $\rho(\mathbf{r})$ 和对应的势场 $V_{eff}(\mathbf{r})$。
*   **K 点设置**：相对稀疏（例如 $6 \times 6 \times 6$）。只要能保证总能量和电荷密度收敛即可。
*   **ABACUS 参数**：`calculation = scf`。

#### **第二步：非自洽场计算 (NSCF / Non-SCF)**
*   **目标**：在第一步得到的**固定**电荷密度和势场下，计算更精细的能级分布。
*   **为什么需要这一步？** DOS 的细节（如尖峰和精细结构）需要非常密的 K 点网格（例如 $12 \times 12 \times 12$ 或更密）才能解析出来。如果在如此密的网格上直接跑 SCF，计算成本将呈立方级增长且极难收敛。
*   **操作逻辑**：读取第一步生成的电荷密度文件（通常在 `OUT.suffix` 文件夹中），冻结它，然后仅进行一次哈密顿量对角化。
*   **ABACUS 参数**：`calculation = nscf` (或在某些版本配合 `out_dos = 1`)。

> **⚠️ 警告**
> 如果跳过 SCF 直接跑 DOS 计算（或者在 NSCF 步没有正确读取电荷密度），你得到的将是基于初始猜测（Initial Guess）的错误结果，毫无物理意义。

### 1.4.3 K 点采样的差异
*   **SCF**：关注能量积分的收敛。K 点过密是浪费。
*   **DOS (NSCF)**：关注能级在能量轴上的分布。K 点越密，DOS 曲线越平滑，噪音越小。
*   **结论**：在准备 DOS 计算的 `KPT` 文件时，务必大幅增加 K 点密度。

---
**下一章预告**：
理解了物理图景和“两步法”原理后，下一章我们将进入实战环节。我们将从零开始，手把手教你编写 ABACUS 的 `INPUT` 和 `KPT` 文件，计算硅（Si）的态密度。