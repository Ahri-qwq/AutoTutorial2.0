<!-- META_START -->
# 《ABACUS 实战教程：从 NVE 到 NPT 的 AIMD 演练》

## 前言
- **本书逻辑**: 本教程遵循“物理原理 -> 基础守恒 (NVE) -> 恒温模拟 (NVT) -> 进阶应用 (NPT/SDFT)”的认知路径。首先建立 AIMD 的基本概念与输入框架，通过微正则系综验证参数合理性，进而深入讲解最常用的正则系综及其热浴算法，最后介绍等温等压及随机 DFT 等高级功能。
- **核心知识点**: AIMD 原理、时间步长选择、NVE/NVT/NPT 系综设置、多种热浴算法（Langevin/Anderson/Berendsen）、断点续算、SDFT 简介。

<!-- CHAPTER_START -->
## 第一章：AIMD 基础与 ABACUS 输入框架
**本章逻辑**: 在开始跑动力学之前，必须理解 AIMD 与静态计算的区别，以及 ABACUS 处理 MD 的核心参数结构。本章旨在完成“从静态到动态”的思维转换。

### Section 1.1: 第一性原理分子动力学 (AIMD) 概论
- **内容**: 简述 AIMD 的物理本质（基于 DFT 势能面的牛顿运动方程），对比经典 MD (Force Field) 的精度优势与效率劣势。介绍 ABACUS 支持的能量求解器类型（KS-DFT, SDFT, DP, LJ）。
- **关键参数**: 
    - `calculation`: 设置为 `md`。
    - `esolver_type`: 默认为 `ksdft`，提及 `dp` (Deep Potential) 和 `lj` (Lennard-Jones) 的存在。

### Section 1.2: 结构文件与初始速度
- **内容**: 讲解 `STRU` 文件在 MD 中的特殊性。如何定义原子位置，以及如何通过 `init_vel` 控制初始速度的读取或随机生成。
- **关键参数**: 
    - `init_vel`: 控制是否读取初始速度。
    - `STRU` 文件格式: `v vx vy vz` (速度分量)。

### Section 1.3: 关键的时间参数
- **内容**: 强调 `md_dt` (时间步长) 的物理意义及其对积分误差和体系稳定性的决定性影响（“炸裂”风险）。介绍模拟总时长的控制。
- **关键参数**: 
    - `md_dt`: 时间步长 (fs)。
    - `md_nstep`: 总步数。

<!-- CHAPTER_START -->
## 第二章：微正则系综 (NVE) —— 能量守恒的试金石
**本章逻辑**: NVE 系综不通过热浴控制温度，是检验时间步长设置是否合理、SCF 收敛精度是否足够的最佳场景。任何复杂的 MD 模拟都应从 NVE 测试开始。

### Section 2.1: NVE 参数设置与运行
- **内容**: 配置 NVE 系综，解释总能量、粒子数、体积守恒的物理约束。以金刚石结构 Si 为例（参考 `INPUT_0`）。
- **关键参数**: 
    - `md_type`: 设置为 `nve`。

### Section 2.2: 守恒性分析与参数调优
- **内容**: 分析输出文件，检查总能量漂移（Drift）。讨论 `scf_thr` (SCF 收敛精度) 对 MD 能量守恒的影响，权衡精度与计算成本。
- **关键参数**: 
    - `scf_thr`: 电子步收敛阈值（建议严格，如 1e-5 或更低）。

<!-- CHAPTER_START -->
## 第三章：正则系综 (NVT) —— 恒温模拟实战
**本章逻辑**: 绝大多数材料模拟需要在恒定温度下进行。本章详细介绍 ABACUS 中的 NVT 功能及多种热浴算法的选择，这是实际科研中最常用的部分。

### Section 3.1: NVT 基础与温度初始化
- **内容**: 介绍 NVT 系综的物理意义。设置初始温度与目标温度，理解体系如何通过热浴与环境交换能量。
- **关键参数**: 
    - `md_type`: 设置为 `nvt`。
    - `md_tfirst`: 初始/目标温度 (K)。

### Section 3.2: 热浴算法详解 (Thermostats)
- **内容**: 深入解析 ABACUS 支持的多种控温机制（参考 `INPUT_1` 至 `INPUT_7`）。
    - **随机类**: Langevin, Anderson (适合模拟溶剂或破坏相关性)。
    - **标度类**: Velocity Rescaling, Berendsen (效率高，但非严格正则系综)。
    - *注意：需指导用户查阅文档，确认在 INPUT 中切换具体算法的参数名（如 `md_thermostat` 或其他具体开关）。*
- **关键参数**: 
    - 待定(需查阅文档): 用于区分 Langevin, Anderson, Berendsen 等具体算法的控制参数。

<!-- CHAPTER_START -->
## 第四章：进阶应用与特殊场景
**本章逻辑**: 针对相变研究（需变压）、温稠密物质（高温）等特殊需求，介绍 NPT 系综及高效的 SDFT 方法。

### Section 4.1: 等温等压系综 (NPT)
- **内容**: 介绍 NPT 系综在相变和密度弛豫研究中的应用。*风险提示：当前资料库缺乏 NPT 压强控制的具体参数（如目标压强、恒压器参数），需引导读者参考官方手册补充。*
- **关键参数**: 
    - `md_type`: 设置为 `npt`。
    - 待定(需查阅文档): 目标压强设置参数。

### Section 4.2: 高温模拟与 SDFT 加速
- **内容**: 针对高温、大体系模拟，介绍随机 DFT (Stochastic DFT) 如何通过随机采样降低计算量。
- **关键参数**: 
    - `esolver_type`: 设置为 `sdft`。
    - `nbands`: 设置为 `0` (SDFT 特有设置)。
    - `nbands_sto`: 随机波函数数量。

### Section 4.3: MSST 方法简介
- **内容**: 简述多尺度冲击技术 (MSST) 在冲击波模拟中的应用（参考 `INPUT_4`）。
- **关键参数**: 
    - 待定(需查阅文档): 触发 MSST 的具体参数。

<!-- CHAPTER_START -->
## 第五章：数据输出与断点续算
**本章逻辑**: MD 计算昂贵且耗时，学会管理输出数据和处理意外中断（断点续算）是必不可少的工程技能。

### Section 5.1: 轨迹文件与采样频率
- **内容**: 控制 `MD_dump` 和结构文件的输出频率，避免磁盘空间溢出，同时保证足够的统计采样。
- **关键参数**: 
    - `md_dumpfreq`: 轨迹输出频率。

### Section 5.2: 断点续算 (Restart)
- **内容**: 讲解如何利用 `Restart_md.dat` 和中间结构文件恢复中断的计算，确保核时不被浪费。
- **关键参数**: 
    - `md_restartfreq`: 重启文件写入频率。

<!-- APPENDIX_START -->
## 附录：常见报错与避坑指南
- **时间步长陷阱**: `md_dt` 设置过大导致原子“飞出”或能量不守恒。
- **资源估算**: 相比静态 SCF，MD 计算量呈千倍增长，如何预估所需核时。
- **接口扩展**: 简述 ABACUS MD 轨迹对接 DeePMD-kit 和 Hefei-NAMD 的可能性。