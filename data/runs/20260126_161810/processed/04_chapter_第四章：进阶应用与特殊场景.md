# 第四章：进阶应用与特殊场景

在掌握了基础的分子动力学（MD）跑通流程后，我们往往面临更复杂的物理需求：如何模拟材料在相变过程中的体积变化？如何处理温稠密物质（Warm Dense Matter）等极端高温体系？如何模拟冲击波压缩过程？

本章将深入探讨 ABACUS 在这些进阶场景下的解决方案。

> **⚠️ 核心提示：精度与效率的博弈**
> 
> 在进入进阶模拟前，必须再次强调：**AIMD（从头算分子动力学）极其昂贵**。
> *   **时间步长 (`md_dt`)**：过大导致积分发散，过小则浪费算力。通常建议在 0.5 fs ~ 2.0 fs 之间，取决于体系中最轻原子的振动频率。
> *   **总步数 (`md_nstep`)**：需根据物理过程的特征时间尺度设定。
> *   **系综选择**：`md_type` 参数直接决定了物理系综。不同的系综对应不同的守恒量和热浴/压浴算法，请务必根据研究目的谨慎选择。

---

## 4.1 等温等压系综 (NPT)

在 NVT（正则系综）中，晶格体积是固定的。然而，许多物理过程（如熔化、结晶、固-固相变）伴随着显著的体积或密度变化。如果强制固定体积，会导致体系内部产生非物理的压强。此时，我们需要使用 **NPT 系综**（粒子数 N、压强 P、温度 T 恒定），允许晶胞矢量发生变化以释放内应力。

### 4.1.1 核心参数设置

在 `INPUT` 文件中，启用 NPT 系综的关键是将 `md_type` 设置为 `npt`。

```bash
INPUT_PARAMETERS
# ... (基础自洽参数)

# --- MD Control ---
md_type     npt        # 开启等温等压系综
md_nstep    2000       # 模拟步数
md_dt       1.0        # 时间步长 (fs)
md_tfirst   300        # 初始温度 (K)
md_tlast    300        # 目标温度 (K)

# --- 注意：压强控制参数 ---
# ⚠️ 风险提示：
# NPT 模拟需要指定目标压强（Target Pressure）以及恒压器（Barostat）的耦合参数。
# 由于 ABACUS 版本迭代较快，具体的压强控制关键词（如 md_p_ref, md_p_coupling 等）
# 请务必查阅 ABACUS 官方在线文档的 "Input Keywords" 章节以获取最新准确写法。
```

### 4.1.2 应用场景与注意事项

1.  **密度弛豫**：当你搭建了一个新的非晶或液体模型，初始密度往往是不准确的。通过 NPT 模拟（通常设置 P=0 或 1 atm），可以让体系自动弛豫到平衡密度。
2.  **相变模拟**：在升温或降温过程中，NPT 允许晶胞“呼吸”，从而正确捕捉相变时的体积突变。
3.  **基组平面波截断**：由于晶胞体积在变化，如果使用平面波基组（PW），需要注意截断能（ecutwfc）对应的 G 矢量数量可能会随体积波动。在 ABACUS 的 LCAO 模式下，基组随原子移动，对体积变化的适应性相对较好，但仍需注意基组完备性。

---

## 4.2 高温模拟与 SDFT 加速

当模拟温度升高（例如 T > 10,000 K 的温稠密物质），传统的 KS-DFT 面临巨大挑战：
1.  **电子占据**：根据费米-狄拉克分布，高温导致大量高能级轨道被部分占据。
2.  **计算量爆炸**：为了包含这些部分占据态，必须计算成千上万条能带（Bands），计算量随能带数呈立方增长（$O(N^3)$）。

ABACUS 提供了 **随机 DFT (Stochastic DFT, SDFT)** 方法，利用随机向量迹估计技术，将计算复杂度降低，特别适合高温大体系。

### 4.2.1 SDFT 核心参数

使用 SDFT 需要改变电子求解器类型，并调整能带设置。

```bash
INPUT_PARAMETERS
# ... (基础参数)

# --- Electronic Solver ---
esolver_type    sdft       # 启用随机 DFT 求解器

# --- SDFT Specifics ---
nbands          0          # SDFT 模式下，传统能带数设为 0 或由程序自动接管
nbands_sto      128        # 随机波函数（Stochastic Orbitals）的数量
                           # 该值越大，随机误差越小，但计算量增加
                           
# --- Temperature ---
smearing_method fd         # 必须使用 Fermi-Dirac 展宽
smearing_sigma  0.1        # 电子温度 (Ry)，高温模拟中该值通常较大
```

### 4.2.2 精度与效率的权衡

*   **随机误差**：SDFT 的结果包含统计噪声。`nbands_sto` 类似于蒙特卡洛采样中的样本数。通常需要测试 `nbands_sto` 对总能量或力的收敛性。
*   **适用性**：SDFT 在低温下优势不明显，但在高温（电子分布弥散）时，它能以远少于传统 DFT 所需的能带数获得准确的物理性质（如态密度、径向分布函数）。

---

## 4.3 MSST 方法简介（冲击波模拟）

对于极端的冲击波物理研究，直接进行非平衡分子动力学（NEMD）模拟冲击波传播需要极大的模型尺寸。**多尺度冲击技术 (Multi-Scale Shock Technique, MSST)** 是一种高效的替代方案。

MSST 通过约束 MD 的运动方程，使体系始终演化在 Hugoniot 冲击绝热线上。这意味着你可以用较小的晶胞来模拟冲击波扫过后的状态。

### 4.3.1 启用方式

在 ABACUS 中，MSST 通常作为一种特殊的 MD 类型存在（具体实现依赖于版本）。

```bash
INPUT_PARAMETERS
# ... 
md_type     msst       # (需确认版本支持) 开启 MSST 模拟
# [PARAMETER_MISSING] 
# 触发 MSST 需要设定冲击波速度 (Shock Velocity) 或粒子速度等参数。
# 请在执行前查阅文档中关于 "Shock Compression" 或 "MSST" 的具体参数说明。
```

### 4.3.2 物理意义

MSST 模拟的是冲击波波后流体元素的拉格朗日演化过程。通过调整冲击速度参数，可以计算出材料的 Hugoniot 曲线（压力-密度关系），这对于研究材料在极端高压下的状态方程（EOS）至关重要。

---

**本章总结**：
从 NPT 的体积弛豫，到 SDFT 的高温加速，再到 MSST 的冲击波模拟，ABACUS 提供了丰富的工具箱来应对非标准环境下的材料模拟。使用这些功能时，**务必先进行小体系测试**，确认参数设置（特别是压强控制和随机采样数）符合物理预期后，再投入大规模生产性计算。