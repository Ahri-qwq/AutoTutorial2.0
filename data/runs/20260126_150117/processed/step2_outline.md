<!-- META_START -->
# 《ABACUS 电子结构分析：差分电荷密度实战指南》

## 前言
- **本书逻辑**: 本教程遵循“物理原理 -> 标准化流程 -> 后处理分析 -> 进阶应用”的教学逻辑。鉴于 ABACUS 并不直接输出差分电荷密度文件，本教程的核心在于教会读者如何通过严格控制的“分步计算”配合“外部数据处理”来实现这一目标。
- **核心知识点**:
    - 差分电荷密度（Charge Density Difference）的物理定义与构建策略。
    - ABACUS 中 `symmetry` 和 FFT 网格对空间数据一致性的关键影响。
    - 异质结/吸附体系的电荷转移可视化与定量分析。
    - 平面波（PW）与原子轨道（LCAO）基组在电荷分析中的操作差异。

<!-- CHAPTER_START -->
## 第一章：物理基础与计算策略
**本章逻辑**: 在动手操作前，必须先明确“算什么”以及“怎么算”。本章从物理定义出发，引出在 ABACUS 中实现差分电荷密度的通用“三步走”策略，为后续操作奠定理论框架。

### Section 1.1: 差分电荷密度的物理图景
- **内容**: 解释电荷密度重排（Charge Redistribution）的概念，阐述 $\Delta \rho = \rho_{AB} - \rho_A - \rho_B$ 的物理意义（揭示化学键形成、界面电荷转移）。
- **关键参数**: 无。

### Section 1.2: ABACUS 中的“三步走”构建策略
- **内容**: 详细说明由于 ABACUS 不直接输出差分文件，用户必须执行三次独立的 SCF 计算：
    1.  整体体系 AB。
    2.  孤立部分 A（保持 AB 中的晶胞和坐标）。
    3.  孤立部分 B（保持 AB 中的晶胞和坐标）。
    强调“晶胞固定”和“原子坐标冻结”的重要性。
- **关键参数**: 无。

<!-- CHAPTER_START -->
## 第二章：标准计算流程（Total Charge Density）
**本章逻辑**: 这是本教程的核心实战部分。重点讲解如何通过精确控制输入参数，确保三次计算输出的电荷密度网格（Grid）在空间上严格对齐，这是差分结果有效的先决条件。

### Section 2.1: 整体体系（AB）的 SCF 计算
- **内容**: 建立基准计算。重点讲解如何设置参数以输出全电子密度（Total Charge Density），并强调关闭对称性的必要性，防止后续步骤中网格定向发生改变。
- **关键参数**:
    - `calculation`: `scf`
    - `symmetry`: `-1` (核心参数，强制关闭对称性)
    - `basis_type`: `pw` 或 `lcao`
    - 电荷密度输出控制: `待定(需查阅文档)` (需确认控制 .cube 输出的具体参数)

### Section 2.2: 分体系（A 与 B）的独立计算
- **内容**: 讲解如何基于 AB 的 `STRU` 文件构建 A 和 B 的输入文件。
    - **原子处理**: 移除原子而非移动原子。
    - **网格一致性**: 警告软件自动优化 FFT 网格的风险，讲解如何手动固定 FFT 网格维度（`nr1`, `nr2`, `nr3`），确保与 Section 2.1 完全一致。
- **关键参数**:
    - `stru_file`: 需手动修改，移除对应原子。
    - FFT 网格固定参数: `待定(需查阅文档)` (需确认手动指定 FFT 网格大小的参数名)

### Section 2.3: 常见陷阱自检
- **内容**: 指导读者检查输出日志，确认三次计算的 FFT Grid 维度是否完全匹配，以及电子步是否正常收敛。
- **关键参数**: 无。

<!-- CHAPTER_START -->
## 第三章：数据后处理与可视化
**本章逻辑**: 获得原始数据（.cube 文件）后，需要进行数学运算和图形化展示。本章填补了从“计算结果”到“科研图表”的空白。

### Section 3.1: 数据的矩阵运算
- **内容**: 介绍如何处理 $\rho_{AB} - \rho_A - \rho_B$。由于 ABACUS 输出标准 `.cube` 格式，本节将介绍使用 Python 脚本或第三方工具（如 `vaspkit` 兼容模式）进行网格数据的逐点相减。
- **关键参数**: 无（涉及外部脚本编写）。

### Section 3.2: VESTA 可视化实战
- **内容**: 导入差分后的 `.cube` 文件到 VESTA。讲解等值面（Isosurface）的调整、正值（积聚）与负值（耗散）颜色的标定方法。
- **关键参数**: 无（VESTA 软件操作）。

### Section 3.3: 定量分析与单位换算
- **内容**: 
    - **单位陷阱**: 明确 ABACUS 输出单位为 **1/Bohr³**，在进行平面平均或体积积分时需注意单位换算。
    - **Bader 电荷分析前置**: 简述差分电荷密度如何辅助判断电荷转移方向。
- **关键参数**: 无。

<!-- CHAPTER_START -->
## 第四章：进阶应用——能带分解电荷密度
**本章逻辑**: 在掌握整体差分的基础上，进阶到“特定能带/轨道”的电荷分析。这对于分析 HOMO/LUMO 或特定缺陷态的空间分布至关重要，且 PW 与 LCAO 基组的操作流程存在显著差异。

### Section 4.1: 平面波（PW）基组下的能带分解
- **内容**: 介绍如何在 SCF 计算中直接指定输出特定能带的电荷密度。
- **关键参数**:
    - `bands_to_print`: 如 `2*1 2*0 1` (指定输出特定能带)
    - `basis_type`: `pw`

### Section 4.2: 原子轨道（LCAO）基组下的特殊流程
- **内容**: 针对 LCAO 基组，讲解“两步法”流程：先计算系数，再重构电荷密度。
- **关键参数**:
    - `calculation`: 第一步 `scf`，第二步 `get_pchg`
    - `basis_type`: `lcao`
    - `orbital_dir`: 指定轨道文件路径

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **网格不匹配（Grid Mismatch）**: 最致命错误，再次强调固定 FFT 参数的方法。
- **Ghost Atom（鬼原子）**: 简述在 LCAO 高精度计算（如 BSSE 修正）中，分体系计算可能需要保留基函数中心（Ghost Atom）而非直接删除原子。
- **收敛困难**: 针对表面/带电体系，建议调整 `mixing_type` 和 `mixing_beta`。