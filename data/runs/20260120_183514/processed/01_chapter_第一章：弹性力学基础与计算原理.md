# 第一章：弹性力学基础与计算原理

欢迎来到《ABACUS 实战教程》。作为计算材料学的从业者，我们经常需要回答这样一个问题：“这个材料硬不硬？受力后是否容易变形？”要定量回答这个问题，我们需要计算材料的**弹性常数（Elastic Constants）**。

在开始编写输入文件之前，我们必须先建立清晰的物理图像和计算逻辑。很多初学者计算失败（例如得到负的模量或完全不合理的值），往往是因为混淆了“变胞弛豫”与“固定晶胞弛豫”的使用场景，或者对张量的下标定义理解不清。

本章将带你深入理解基于密度泛函理论（DFT）计算弹性常数的物理本质，并确立我们将在后续章节中使用的**应力-应变（Stress-Strain）**工作流。

---

## 1.1 弹性常数与胡克定律

### 1.1.1 物理定义
在宏观力学中，胡克定律（Hooke's Law）描述了弹簧受力与伸长量的线性关系。在晶体微观尺度下，这一关系被推广为**应力张量（Stress, $\sigma$）**与**应变张量（Strain, $\varepsilon$）**之间的线性关系：

$$ \sigma_{ij} = \sum_{k,l} C_{ijkl} \varepsilon_{kl} $$

其中：
*   $\sigma_{ij}$ 是二阶应力张量（单位通常为 kbar 或 GPa）。
*   $\varepsilon_{kl}$ 是二阶应变张量（无量纲）。
*   $C_{ijkl}$ 是四阶弹性刚度张量（Elastic Stiffness Tensor），也就是我们要计算的目标。

### 1.1.2 Voigt 表示法：从张量到矩阵
$C_{ijkl}$ 理论上有 $3 \times 3 \times 3 \times 3 = 81$ 个分量。但在实际计算中，利用应力和应变的对称性以及晶体的热力学性质，我们可以将其简化。

为了便于数值计算，我们采用 **Voigt 表示法**，将双下标 $(i, j)$ 映射为单下标 $\alpha$：
*   $xx \rightarrow 1, \quad yy \rightarrow 2, \quad zz \rightarrow 3$
*   $yz \rightarrow 4, \quad xz \rightarrow 5, \quad xy \rightarrow 6$

由此，胡克定律可以写成更直观的 $6 \times 6$ 矩阵形式 $\sigma_{\alpha} = C_{\alpha\beta} \varepsilon_{\beta}$：

$$
\begin{bmatrix}
\sigma_1 \\ \sigma_2 \\ \sigma_3 \\ \sigma_4 \\ \sigma_5 \\ \sigma_6
\end{bmatrix}
=
\begin{bmatrix}
C_{11} & C_{12} & C_{13} & C_{14} & C_{15} & C_{16} \\
C_{12} & C_{22} & C_{23} & C_{24} & C_{25} & C_{26} \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
C_{16} & C_{26} & C_{36} & C_{46} & C_{56} & C_{66}
\end{bmatrix}
\begin{bmatrix}
\varepsilon_1 \\ \varepsilon_2 \\ \varepsilon_3 \\ \varepsilon_4 \\ \varepsilon_5 \\ \varepsilon_6
\end{bmatrix}
$$

> **实战注记**：
> 对于我们将要计算的 **金刚石（Diamond）** 结构（立方晶系），对称性极高，独立参数仅剩 3 个：$C_{11}$（轴向压缩）, $C_{12}$（泊松效应）, $C_{44}$（剪切模量）。
> 我们的计算目标就是通过 DFT 算出这三个数。

---

## 1.2 应力-应变法 (Stress-Strain Method)

计算弹性常数主要有两种流派：**能量-应变法**和**应力-应变法**。本教程采用**应力-应变法**，因为它是 ABACUS 结合 `pymatgen` 等后处理工具的主流做法，效率通常更高。

### 1.2.1 核心思想
该方法的核心逻辑是“**施加应变，测量应力**”：
1.  人为给晶胞施加一组微小的线性无关的应变 $\delta$（改变晶格矢量）。
2.  进行 DFT 自洽计算，得到对应的应力 $\sigma$。
3.  通过线性拟合 $\sigma - \delta$ 的斜率，解出 $C_{ij}$。

通常我们会施加一组正负扰动，例如 $\delta \in \{-0.01, -0.005, 0.005, 0.01\}$，以消除高阶非线性项的影响，确保结果处于线弹性区间。

### 1.2.2 关键计算流程（核心考点）

这是本章最重要的部分。很多用户的计算错误源于对步骤 2 和 3 的混淆。

#### 第一步：基态弛豫 (Relaxation of Perfect Cell)
在施加应变前，必须确保初始结构处于能量最低状态，即**应力为零**的状态。
*   **ABACUS 设置**: `calculation cell-relax` (或 `vc-relax`)。
*   **目的**: 获得平衡态的晶格常数和原子位置。如果这一步没做，初始存在的内应力会叠加到后续计算中，导致结果偏差。

#### 第二步：生成形变结构 (Generate Deformed Structures)
基于第一步得到的完美晶胞，通过数学变换生成一系列发生微小形变的结构文件 (`STRU`)。
*   **工具**: 我们将使用 `gene_dfm.py` 脚本（源自 ABACUS 用户指南仓库）。
*   **注意**: 这是一个预处理步骤，不涉及 DFT 计算。

#### 第三步：固定晶胞弛豫 (Relaxation of Atoms with Fixed Cell)
这是最容易出错的一步。我们需要计算形变后的应力，**必须固定晶胞形状，只允许原子内部弛豫**。
*   **ABACUS 设置**:
    *   `calculation relax` (**绝对不能**用 `cell-relax`)
    *   `cal_stress 1` (必须开启应力计算)
*   **物理原理**:
    如果我们使用了 `cell-relax`，ABACUS 会自动调整晶格矢量以释放我们施加的应力，最终让体系回到零压状态。这样我们测得的应力全是 0，无法拟合弹性常数。
    我们需要的是：在保持晶胞形变（Strain）被“卡住”的情况下，让原子受力平衡，测量此时晶胞壁上感受到的应力（Stress）。

#### 第四步：数据收集与拟合
*   **工具**: `compute_dfm.py`。
*   **过程**: 脚本会自动读取每个形变任务的 `OUT.ABACUS/running_scf.log` (或相应日志)，提取应力张量，利用最小二乘法拟合胡克定律公式，输出 $C_{ij}$ 矩阵。

---

## 1.3 必备工具与脚本说明

在进入下一章的实操前，请明确 ABACUS 核心程序与辅助脚本的分工：

1.  **ABACUS 可执行程序**:
    *   负责进行 DFT 计算（求解 Schrödinger 方程）。
    *   输入：`INPUT`, `STRU`, `KPT`, 赝势, 轨道文件。
    *   输出：能量、力、**应力 (`cal_stress 1`)**。

2.  **辅助 Python 脚本** (非内置，需自行下载):
    *   `gene_dfm.py`: 用于生成形变的 `STRU` 文件。
    *   `compute_dfm.py`: 用于后处理拟合数据。
    *   **来源**: 这些脚本位于 ABACUS 用户指南的 Gitee/GitHub 仓库中 (`examples/elastic` 目录)。在下一章中，我们将以 **8原子金刚石 (Diamond)** 为例，演示如何配置和运行这些脚本。

### 风险提示 (Risk Warning)
> **教授的黑板敲击声**：
> 在 `INPUT` 文件中，**`cal_stress 1`** 是计算弹性常数的**充要条件**。
> 默认情况下，ABACUS 为了节省计算资源，可能不会计算应力张量（或仅计算但不输出高精度应力）。如果漏写此参数，你跑完几十个任务后会发现，日志里全是能量和力，唯独没有应力数据，所有计算时间将付诸东流。

---

**下一章预告**：
理论准备完毕。在第二章中，我们将进入实战环节，从下载脚本开始，一步步配置金刚石的计算参数，并生成形变任务。请准备好你的 Linux 终端。