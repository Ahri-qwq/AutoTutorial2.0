<!-- META_START -->
# ABACUS 实战教程：晶体弹性常数与力学性质计算

## 前言
- **本书逻辑**: 本教程遵循“物理原理 -> 预备工作 -> 核心实战 -> 结果分析”的教学逻辑。首先确立应力-应变法的物理基础，随后以经典的 **Diamond（金刚石）** 体系为核心案例，详解利用 Python 脚本配合 ABACUS 进行高通量形变计算的全流程。重点在于厘清“固定晶胞弛豫原子”这一关键操作细节，以及如何利用 pymatgen 进行后处理拟合。
- **核心知识点**: 弹性常数 ($C_{ij}$) 定义、应力-应变法 (Stress-Strain Method)、Voigt 表示法、ABACUS 应力计算 (`cal_stress`)、pymatgen 接口使用、Born 稳定性准则。

<!-- CHAPTER_START -->
## 第一章：弹性力学基础与计算原理
**本章逻辑**: 在动手计算前，必须理解计算的目标是什么（$C_{ij}$ 张量）以及计算的方法论（施加应变求应力）。本章为后续的参数设置提供理论支撑。

### Section 1.1: 弹性常数与胡克定律
- **内容**: 介绍弹性常数 $C_{ijkl}$ 的物理定义，阐述胡克定律 ($\sigma = C\varepsilon$) 在晶体中的表达。解释如何利用晶体对称性（Voigt 表示法）将四阶张量简化为 $6 \times 6$ 矩阵。
- **关键参数**: 无

### Section 1.2: 应力-应变法 (Stress-Strain Method)
- **内容**: 对比能量-应变法，重点介绍本教程采用的应力-应变法。解析其核心思想：通过施加一组线性无关的微小应变 ($\delta$)，利用 DFT 计算对应的应力响应 ($\sigma$)，通过线性拟合求解 $C_{ij}$。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第二章：计算环境与前置准备
**本章逻辑**: 弹性常数计算属于高阶复合任务，依赖外部脚本和精确的初始结构。本章旨在搭建计算流水线，并确保起点的正确性。

### Section 2.1: 工具链准备
- **内容**: 介绍所需的软件环境。除了核心的 ABACUS 程序外，重点介绍 **pymatgen** 库的安装（用于结构形变和数据拟合）以及本教程专用的辅助脚本 `gene_dfm.py` 和 `compute_dfm.py` 的获取方式。
- **关键参数**: 无

### Section 2.2: 初始结构的几何优化
- **内容**: **关键步骤**。强调计算弹性常数前，必须对完美晶胞进行高精度的结构弛豫（VC-Relax）。解释残余应力对弹性常数计算的破坏性影响。
- **关键参数**: `calculation: cell-relax` (用于预处理), `cal_stress: 1`, `cal_force: 1`

<!-- CHAPTER_START -->
## 第三章：实战演练——金刚石弹性常数计算
**本章逻辑**: 本书的核心章节。基于 **Diamond (8原子金刚石)** 案例，完整复现“生成形变 -> 批量计算 -> 数据拟合”的标准工作流。

### Section 3.1: 生成形变结构 (Pre-processing)
- **内容**: 演示如何使用 `gene_dfm.py` 脚本。详细解析脚本如何调用 pymatgen 根据晶体对称性生成 24 个形变结构文件（6种应变模式 $\times$ 4种应变大小）。
- **关键参数**: 应变幅值 $\delta$ (通常取 $\pm 0.01, \pm 0.005$)

### Section 3.2: 核心计算参数配置 (The INPUT)
- **内容**: **核心难点解析**。详细讲解 ABACUS 的 `INPUT` 文件设置。必须强调在形变计算阶段，需**固定晶胞形状**但允许**原子弛豫**，同时开启应力张量计算。
- **关键参数**: 
    - `calculation: relax` (**至关重要**：不可使用 cell-relax，否则应变会被释放)
    - `cal_stress: 1` (必须开启，否则无法拟合)
    - `cal_force: 1` (用于原子弛豫)
    - `esolver_type: ks` (默认)
    - `mixing_type: broyden` (加速收敛)

### Section 3.3: 批量任务提交与管理
- **内容**: 介绍如何通过 Shell 脚本 (`run_task.sh`, `sub.sh`) 自动化管理 24 个计算任务。讲解目录结构的设计（每个形变一个独立文件夹）。
- **关键参数**: 无

### Section 3.4: 数据提取与拟合 (Post-processing)
- **内容**: 演示计算完成后，如何使用 `compute_dfm.py` 脚本批量读取所有子文件夹中的应力数据，并调用 pymatgen 进行线性回归拟合，最终输出弹性常数矩阵。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第四章：结果分析与性质评估
**本章逻辑**: 得到数据只是第一步，本章指导读者如何解读数据，判断结果的物理合理性，并计算衍生的力学模量。

### Section 4.1: 结果解读与稳定性判据
- **内容**: 分析输出的 $C_{ij}$ 矩阵（对于立方晶系金刚石，关注 $C_{11}, C_{12}, C_{44}$）。介绍 Born 稳定性准则（Born Stability Criteria），判断晶体结构是否具有机械稳定性。
- **关键参数**: 无

### Section 4.2: 宏观力学模量计算
- **内容**: 基于计算出的单晶弹性常数，利用 Voigt-Reuss-Hill 近似方法，计算多晶材料的体积模量 (Bulk Modulus, $B$)、剪切模量 (Shear Modulus, $G$)、杨氏模量 ($E$) 和泊松比 ($\nu$)。
- **关键参数**: 无

<!-- APPENDIX_START -->
## 附录：常见问题与进阶建议
- **精度陷阱**: 提醒用户关注 `ecutwfc` 和 K 点密度对弹性常数的收敛性影响（比常规能量计算要求更高）。
- **对称性问题**: 讨论当 `symmetry` 设置不当时，可能导致 pymatgen 识别出错误的独立弹性常数个数。
- **拟合误差**: 如何通过观察拟合的 $R^2$ 值判断应变范围是否选择了合适的线性区域。