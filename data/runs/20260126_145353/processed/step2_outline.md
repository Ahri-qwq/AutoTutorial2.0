<!-- META_START -->
# ABACUS 实战教程：静电势与功函数计算

## 前言
- **本书逻辑**: 本教程遵循“物理原理 -> 模型构建 -> 参数配置 -> 数据分析”的计算材料学标准研究范式。首先厘清静电势与交换关联势的区别，确立功函数的物理定义；进而指导如何构建合理的表面模型；随后深入 ABACUS 输入参数细节，特别是易错的电势输出类型与偶极修正；最后详解如何从输出文件中提取数据并完成单位换算，得出准确的物理量。
- **核心知识点**: 静电势 ($V_{static}$) 定义、功函数 ($\Phi$) 计算公式、`out_pot` 参数辨析、偶极修正 (Dipole Correction)、平面平均电势 (Planar Average Potential)、单位换算 (Hartree to eV)。

<!-- CHAPTER_START -->
## 第一章：物理基础：静电势与功函数的定义
**本章逻辑**: 在进行计算之前，必须明确“算什么”。本章旨在从 DFT 理论层面区分不同的“势”的概念，防止用户混淆静电势与总局域势，并推导功函数的计算公式，为后续操作奠定理论基础。

### Section 1.1: ABACUS 中的势场分类
- **内容**: 详细解析 ABACUS 中静电势 ($V_{static}$) 的构成（哈特里势 + 离子局域势 + 外场 + 偶极修正），重点强调其**不包含**交换关联势 ($V_{xc}$) 的特性。对比总局域势 ($V_{local}$) 的定义，说明为何计算功函数必须使用前者。
- **关键参数**: `out_pot` (理论层面介绍)

### Section 1.2: 功函数的物理定义与计算公式
- **内容**: 定义功函数 ($\Phi$) 为电子从材料内部逸出到真空能级所需的最小能量。引出核心计算公式 $\Phi = V_{vac} - E_F$，解释 $V_{vac}$（真空静电势）和 $E_F$（费米能级）的物理含义及在表面模型中的对应位置。
- **关键参数**: 无

<!-- CHAPTER_START -->
## 第二章：模型构建：表面体系与真空层设计
**本章逻辑**: 好的计算始于好的模型。表面计算对模型结构有特殊要求，本章指导用户如何构建符合物理规范的 Slab 模型，特别是真空层的设置与原子位置的选取，这直接关系到偶极修正的成败。

### Section 2.1: Slab 模型与真空层厚度
- **内容**: 讲解如何从体材料截取表面构建 Slab 模型。重点讨论真空层 (Vacuum layer) 的作用——隔绝周期性镜像相互作用并提供读取 $V_{vac}$ 的参考区域。强调真空层过薄会导致电势无法展平，从而无法准确定义真空能级。
- **关键参数**: 结构文件 (STRU) 中的晶胞矢量

### Section 2.2: 原子位置与偶极修正的几何考量
- **内容**: 探讨原子在超胞中的摆放策略。建议将原子层置于超胞中部，真空层留于两侧，或根据偶极修正锯齿势的位置调整原子，确保原子不处于电势突变区。
- **关键参数**: 结构文件 (STRU) 中的原子坐标

<!-- CHAPTER_START -->
## 第三章：参数设置：核心控制与偶极修正
**本章逻辑**: 这是 ABACUS 实操的核心环节。本章将详细拆解 `INPUT` 文件的设置，区分常规参数与修正参数，特别是解决“如何正确输出不含 XC 的静电势”这一关键痛点。

### Section 3.1: 激活静电势输出
- **内容**: 详解 `out_pot` 参数的取值含义。明确指出计算功函数必须设置 `out_pot 2`，并演示如果错误设置成 `1` 会带来的后果（包含 XC 势导致数值错误）。
- **关键参数**: `out_pot`

### Section 3.2: 偶极修正 (Dipole Correction) 设置
- **内容**: 解释为何非对称表面需要偶极修正（消除人工伪电场）。指导如何设置锯齿状电势的位置 (`efield_pos_max`) 和衰减区 (`efield_pos_dec`)。
- **关键参数**: `efield_pos_max`, `efield_pos_dec`, 偶极修正开关(待定，需查阅文档确认具体布尔值参数名)

<!-- CHAPTER_START -->
## 第四章：数据后处理：从三维势场到数值计算
**本章逻辑**: 计算结束得到原始数据后，如何将其转化为物理结论是新手的难点。本章涵盖从提取费米能级、处理 3D Cube 文件到最终单位换算的全流程。

### Section 4.1: 提取费米能级 ($E_F$)
- **内容**: 演示如何从 `running_scf.log` 或其他输出文件中定位并读取费米能级数值。
- **关键参数**: 无 (涉及输出文件解析)

### Section 4.2: 平面平均静电势的处理
- **内容**: 介绍如何利用 Python 脚本处理 `ElecStaticPot.cube` 文件，将 3D 数据转换为沿 Z 轴（表面法向）的平面平均电势 (Planar Average Potential)。指导如何使用可视化软件（如 VESTA）辅助检查电势分布。
- **关键参数**: 无 (涉及后处理脚本)

### Section 4.3: 确定真空能级与单位换算
- **内容**: 指导用户在平面平均电势图中识别“真空平台” (Plateau)，读取 $V_{vac}$ 数值。**关键步骤**：详细说明 Hartree (a.u.) 到 eV 的单位换算过程（乘以 27.2114），并结合 $E_F$ 计算最终的功函数值。
- **关键参数**: 无

<!-- APPENDIX_START -->
## 附录：常见报错与避坑指南
- **锯齿位置错误**: 警告 `efield_pos_max` 穿过原子层导致的非物理结果。
- **单位陷阱**: 再次提醒混淆 Hartree 和 eV 导致的数量级错误。
- **真空层不足**: 如何通过电势图判断真空层是否过薄（平台倾斜）。