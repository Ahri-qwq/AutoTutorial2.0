# 第二章：模型构建：表面体系与真空层设计

在第一章中，我们熟悉了 ABACUS 的基本运行流程。从本章开始，我们将进入实战的核心——如何构建一个物理上合理、计算上高效的模型。

对于表面科学（催化、腐蚀、薄膜生长等）研究而言，**Slab 模型（平板模型）** 是最常用的近似方法。好的计算始于好的模型，本章将指导你如何在 ABACUS 的 `STRU` 文件中构建 Slab，并深入探讨真空层与原子位置的微妙关系，这直接决定了后续功函数（Work Function）计算和偶极修正的成败。

---

## 2.1 Slab 模型与真空层厚度

### 2.1.1 为什么需要真空层？

ABACUS 基于周期性边界条件（Periodic Boundary Conditions, PBC）。这意味着，当你定义一个晶胞时，软件会在三维空间中无限复制它。

如果你直接从体材料（Bulk）中切出一个表面，而不做特殊处理，PBC 会导致你的表面与上方镜像晶胞的“底部”紧密接触，这实际上模拟的是层状体材料，而非表面。

为了模拟真实的表面，我们必须在垂直于表面（通常设为 Z 轴）的方向上人为引入一段“空无一物”的区域，这就是**真空层（Vacuum Layer）**。它的作用有两个：
1.  **隔绝相互作用**：防止 Slab 上表面的电子云与上方镜像 Slab 的下表面发生重叠或静电相互作用。
2.  **提供能量参考**：为计算功函数提供一个静电势为常数的真空参考能级（$V_{vac}$）。

### 2.1.2 在 STRU 文件中设置真空层

在 ABACUS 的 `STRU` 文件中，真空层的大小并不是通过某个参数直接设置的，而是通过**拉长晶胞矢量**来实现的。

假设我们有一个 FCC 金属的 (111) 表面，原本的层厚约为 6 Å。为了添加 15 Å 的真空层，我们需要将 `LATTICE_VECTORS` 中的第三个矢量（Z方向）长度增加。

**示例：STRU 文件片段**

```abacus
ATOMIC_SPECIES
Ag 107.868 Ag_ONCV_PBE-1.0.upf

LATTICE_CONSTANT
1.889726125  # 1.0 Angstrom in Bohr (ABACUS 默认单位可能为 Bohr，此处需注意转换)

LATTICE_VECTORS
2.889 0.000 0.000    # X 方向
1.445 2.502 0.000    # Y 方向
0.000 0.000 25.000   # Z 方向：Slab厚度 + 真空层厚度

ATOMIC_POSITIONS
Direct
...
```

> **经验法则**：
> 对于大多数金属和半导体表面，**15 Å - 20 Å** 的真空层通常是安全的。
> *   **过薄**：电子云溢出，镜像相互作用显著，总能计算不准，静电势无法展平。
> *   **过厚**：平面波基组计算量显著增加（因为需要填充更多的平面波来描述真空）。

---

## 2.2 原子位置与偶极修正的几何考量

构建好“盒子”后，原子的摆放位置大有讲究。这不仅是为了美观，更是为了物理结果的正确性，特别是在涉及**偶极修正（Dipole Correction）**时。

### 2.2.1 表面偶极矩问题

当 Slab 的上下表面不对称（例如：一面吸附了分子，另一面是洁净表面）时，体系会在 Z 方向产生净偶极矩。在周期性边界条件下，这会导致穿过真空层的静电势出现人为的梯度（倾斜），导致真空能级无法定义，总能收敛困难。

此时，我们需要在 `INPUT` 文件中开启偶极修正（通常涉及 `dipole_correction` 相关参数，具体请查阅文档）。

### 2.2.2 原子摆放策略

为了配合偶极修正，并确保计算稳定，原子在 Z 轴上的位置推荐采用以下两种策略之一：

1.  **居中放置（Centering）**：
    将 Slab 置于 Z 轴方向的中间，上下各留出一半的真空层。
    *   *优点*：几何对称性好，便于观察。
    *   *适用*：对称 Slab 或无偶极修正的计算。

2.  **特定区间放置（避免边界）**：
    ABACUS（以及大多数平面波 DFT 软件）的偶极修正通常是在真空层的某处引入一个“锯齿状电势突变”来抵消偶极场。
    *   **核心原则**：**绝对不要让原子跨越晶胞边界（Z=0 或 Z=1）**，也不要让原子位于真空层的正中央（如果偶极修正势阶跃点设在那里的化）。
    *   **推荐做法**：将 Slab 放置在 `0.1 < Z_frac < 0.9` 的区间内，确保 Z=0 附近是纯粹的真空。

---

## 2.3 实战核心：功函数（Work Function）计算流程

这是本章的重中之重。很多初学者在计算功函数时，因选错输出势文件而导致结果谬以千里。

**功函数定义**：
$$ \Phi = V_{vac} - E_F $$
其中：
*   $V_{vac}$：真空静电势（Vacuum Electrostatic Potential）。
*   $E_F$：费米能级（Fermi Energy）。

### 2.3.1 关键参数设置 (INPUT)

在 `INPUT` 文件中，必须正确设置 `out_pot` 参数。

*   **`out_pot 1` (CRITICAL)**: 输出**静电势 (Electrostatic Potential)**。包含离子实局域势和 Hartree 势。**这是计算功函数唯一正确的选择。**
*   `out_pot 2`: 输出总局域势 (Total Local Potential)。它在静电势的基础上，还包含了交换关联势 ($V_{xc}$)。**绝对不要用这个计算功函数**，因为 $V_{xc}$ 在真空中衰减行为复杂，会导致错误的真空能级读数。

**INPUT 文件示例：**

```abacus
INPUT_PARAMETERS
# ... 其他参数 ...
calculation  scf       # 自洽计算
out_pot      1         # 【核心】输出静电势用于功函数计算
# ... 其他参数 ...
```

### 2.3.2 数据提取与计算步骤

计算完成后，按以下步骤操作：

**Step 1: 获取费米能 ($E_F$)**
从输出的日志文件（如 `running_scf.log` 或 `OUT.suffix/running_scf.log`）中读取。
```bash
grep "Fermi Energy" OUT.suffix/running_scf.log
# 输出示例: Fermi Energy is 5.1234 eV
```
*注意：ABACUS 输出的费米能通常单位已经是 eV。*

**Step 2: 获取真空静电势 ($V_{vac}$)**
1.  找到输出的势文件，通常命名为 `ElecStaticPot.cube`（对应 `out_pot 1`）。
2.  **平面平均（Planar Average）**：使用后处理工具（如 Python 脚本、VESTA 或专门的 planar average code）将三维势场沿 XY 平面积分，得到沿 Z 轴的一维电势分布 $V(z)$。
3.  **读取平台值**：绘制 $V(z)$ 曲线。在真空层区域，你应该看到一段平坦的直线（Plateau）。读取该平台处的数值即为 $V_{vac}$。

> **锦囊妙计 (Tips) - 如何判断结果可靠性？**
> *   **看平台**：如果真空层区域的电势不是水平的，而是倾斜的，说明偶极修正未开启或设置不当，或者真空层太薄导致镜像相互作用未消除。此时读取的 $V_{vac}$ 是无意义的。
> *   **单位陷阱**：`ElecStaticPot.cube` 文件中的原始数据单位通常是 **Hartree (a.u.)**。
>     *   1 Hartree $\approx$ 27.2114 eV。
>     *   在代入公式 $\Phi = V_{vac} - E_F$ 前，务必将 $V_{vac}$ 乘以 27.2114 转换为 eV（假设 $E_F$ 已经是 eV）。

**Step 3: 计算**
$$ \Phi (\text{eV}) = (V_{vac}^{\text{Hartree}} \times 27.2114) - E_F^{\text{eV}} $$

---

## 2.4 本章小结

构建表面模型不仅仅是切出一个 Slab，更在于对真空层的精心设计。
1.  **真空层**：厚度要足以隔绝镜像，通常 15 Å 起步。
2.  **原子位置**：避免跨越边界，为偶极修正留出空间。
3.  **功函数计算**：
    *   **严禁**使用 `out_pot 2`。
    *   **必须**使用 `out_pot 1`。
    *   **切记** Hartree 到 eV 的单位转换。

下一章，我们将讨论表面计算中的 k 点取样与收敛性测试，这是平衡计算精度与成本的关键。