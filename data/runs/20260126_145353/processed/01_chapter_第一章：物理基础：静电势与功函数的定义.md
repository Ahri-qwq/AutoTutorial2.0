# 第一章：物理基础：静电势与功函数的定义

在开始任何实际计算之前，我们必须先厘清物理概念。对于表面科学计算（如催化、半导体异质结能带对齐等），**功函数（Work Function）** 是最基础也是最重要的物理量之一。

很多初学者在使用 DFT 软件时，往往能跑通计算，却在数据提取环节犯错——最典型的错误就是混淆了“总局域势”与“静电势”，导致计算出的功函数数值完全偏离物理直觉。作为 ABACUS 的开发者，本章将带你从代码实现的底层逻辑出发，彻底理解我们需要“算什么”。

---

## 1.1 ABACUS 中的势场分类

在 Kohn-Sham DFT 框架下，电子感受到的有效势场（Effective Potential, $V_{eff}$）通常由以下几部分构成：

$$
V_{eff}(\mathbf{r}) = V_{H}(\mathbf{r}) + V_{ion}(\mathbf{r}) + V_{xc}(\mathbf{r}) + V_{ext}(\mathbf{r})
$$

其中：
*   $V_{H}$：哈特里势（Hartree Potential），源于电子密度的经典静电相互作用。
*   $V_{ion}$：离子实产生的局域势（Local Pseudopotential）。
*   $V_{xc}$：交换关联势（Exchange-Correlation Potential），包含量子力学效应。
*   $V_{ext}$：外场（如外加电场或偶极修正引入的势）。

### 核心概念：静电势 ($V_{static}$)
在计算功函数时，我们需要关注的是**静电势（Electrostatic Potential）**。在 ABACUS 的定义中，静电势**不包含**交换关联势。其数学表达为：

$$
V_{static}(\mathbf{r}) = V_{H}(\mathbf{r}) + V_{ion}(\mathbf{r}) + V_{ext}(\mathbf{r})
$$

### 关键参数：`out_pot`

在 ABACUS 的 `INPUT` 输入文件中，`out_pot` 参数控制势场文件的输出。这是本章最关键的设置，请务必区分：

*   **`out_pot 1` (Total Local Potential)**:
    *   输出内容：$V_{local} = V_{static} + V_{xc}$
    *   物理含义：电子在 KS 方程中感受到的总有效局域势。
    *   **警告**：虽然在真空中 $V_{xc}$ 趋于 0，但在表面附近及材料内部，$V_{xc}$ 贡献显著。**严禁使用此项计算功函数**，否则会引入非静电项的干扰。

*   **`out_pot 2` (Electrostatic Potential)**:
    *   输出内容：$V_{static} = V_{H} + V_{ion} + V_{ext}$
    *   物理含义：纯粹的经典静电势场。
    *   **用途**：**这是计算功函数、能带对齐（Band Alignment）的正确选项。**

> **开发者提示 (Developer's Note)**: 
> 当你设置 `out_pot 2` 后，ABACUS 会在计算结束后输出一个名为 `ElecStaticPot.cube` 的文件。这个文件包含了三维空间的静电势分布数据，是我们后续分析的基础。

---

## 1.2 功函数的物理定义与计算公式

### 物理定义
功函数 ($\Phi$) 定义为将一个电子从材料内部的费米能级（Fermi Level）移动到材料表面外的真空能级（Vacuum Level）所需的最小能量。

### 计算公式
在实际的 DFT 表面模型计算中，功函数通过以下公式计算：

$$
\Phi = V_{vac} - E_F
$$

其中：
1.  **$V_{vac}$ (真空静电势)**:
    *   这是电子刚刚脱离材料表面，处于静止状态时的静电势能。
    *   **获取方式**: 通过处理 `ElecStaticPot.cube` 文件，计算沿表面法线方向（通常为 Z 轴）的平面平均静电势（Planar-averaged Potential），在真空层区域读取到的**平台值（Plateau）**。
    
2.  **$E_F$ (费米能级)**:
    *   材料内部电子填充的最高能级（对于金属）或价带顶（对于半导体，需视具体定义而定，通常 DFT 输出的 $E_F$ 位于带隙中）。
    *   **获取方式**: 直接从 ABACUS 的自洽计算日志文件（如 `running_scf.log`）或输出文件（如 `OUT.suffix/running_scf.log`）中读取 `Fermi Energy`。

### 势场分布示意图
为了直观理解，我们通常会绘制“平面平均静电势 vs. Z轴坐标”的曲线图：

*   **材料内部区域**: 电势呈现周期性振荡，反映了原子层的排列结构。
*   **真空层区域**: 电势逐渐趋于平缓，形成一个平台。这个平台的高度就是 $V_{vac}$。

---

## 1.3 专家锦囊 (Tips & Tricks)

在实战中，以下细节决定了计算的成败：

### 1. 单位陷阱 (Unit Conversion)
ABACUS 作为一款物理导向的软件，其底层输出（包括 `.cube` 文件和 Log 中的能量）默认使用 **Hartree (Atomic Unit, a.u.)** 单位，而不是化学家常用的 eV。
*   **换算关系**: $1 \text{ Hartree} \approx 27.2114 \text{ eV}$
*   **实战建议**: 在作图或计算 $\Phi$ 时，务必将 $V_{vac}$ 和 $E_F$ 都乘以 27.2114 转换为 eV。如果你算出的功函数只有 0.15 左右，那一定是忘了单位换算（$0.15 \text{ Ha} \approx 4.08 \text{ eV}$）。

### 2. 偶极修正的判断 (Dipole Correction Check)
对于非对称表面（Slab 上下表面原子结构不同），必须在 `INPUT` 中开启偶极修正（通常设置 `dipole_correction 1`，具体参数将在后续章节详解）。
*   **如何检查修正是否正确？**
    观察静电势分布图的真空区域。
    *   **正确**: 真空区电势是平坦的（Flat Plateau）。
    *   **错误**: 真空区电势呈现倾斜（Slope），说明偶极场未被完全抵消，或者真空层太薄导致周期性镜像相互作用。此时读取的 $V_{vac}$ 是无意义的。

### 3. 费米能级的读取时机
确保读取的是**自洽迭代（SCF）完全收敛后**的费米能级。如果在弛豫（Relax）过程中，应读取最后一步离子步的 SCF 结果。

---

**下一章预告**：
明白了“算什么”，下一章我们将进入“怎么算”。我们将手把手教你如何构建表面模型（Slab Model），以及如何编写正确的 `INPUT` 文件来开启静电势输出。