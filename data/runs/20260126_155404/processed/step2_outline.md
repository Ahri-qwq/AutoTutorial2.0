<!-- META_START -->
# ABACUS 实战教程：晶格动力学与热力学性质计算

## 前言
- **本书逻辑**: 本教程遵循从“微观机制”到“宏观性质”的物理认知过程。首先建立晶格振动与热力学函数之间的理论桥梁，随后详解基于 ABACUS + Phonopy 的标准计算流程，特别针对接口限制设计了进阶操作方案，最后落脚于数据分析与误差排查。
- **核心知识点**: 准谐近似(QHA)、吉布斯自由能构成($E_{\text{static}}/E_{\text{ZPE}}/F_{\text{vib}}$)、有限位移法、声子态密度积分、ABACUS 力常数计算接口、手动局部振动分析。

<!-- CHAPTER_START -->
## 第一章：物理基础与热力学桥梁
**本章逻辑**: 在动手计算前，必须理解“为什么算声子能得到热力学性质”。本章不堆砌公式，而是厘清静态能量、零点能与温度相关自由能之间的物理图像，为后续参数设置提供理论依据。

### Section 1.1: 从微观振动到宏观热力学
- **内容**: 阐述吉布斯自由能 $G(T)$ 在第一性原理计算中的拆解形式。重点解释 $E_{\text{static}}$（DFT 静态能）、$E_{\text{ZPE}}$（零点能）与 $F_{\text{vib}}(T)$（振动自由能）的物理来源，以及它们如何通过声子态密度（Phonon DOS）进行积分。
- **关键参数**: 无（理论概念）。

### Section 1.2: 准谐近似与有限位移法
- **内容**: 介绍计算声子谱的主流方法——有限位移法（Finite Displacement Method）。解释如何通过构建超胞、引入微小位移来计算力常数矩阵，进而求解动力学矩阵。
- **关键参数**: 无（方法论）。

<!-- CHAPTER_START -->
## 第二章：标准计算流程 (ABACUS + Phonopy)
**本章逻辑**: 这是核心实战章节。按照“前处理 -> 自洽计算 -> 后处理”的工业化流程，详细指导如何使用 ABACUS 配合 Phonopy 获取标准体相材料的热力学数据。

### Section 2.1: 结构优化与前处理
- **内容**: 强调高精度结构弛豫的重要性（残余力对声子谱的影响）。演示如何使用 Phonopy 生成扩胞（Supercell）及微扰结构文件。
- **关键参数**: 
    - Phonopy: `DIM` (超胞维度，如 `2 2 2`)。
    - ABACUS: `stru_file` (初始结构)。

### Section 2.2: ABACUS 力场计算配置
- **内容**: 配置 ABACUS 的输入文件以计算微扰结构的原子受力。重点讲解如何确保输出文件包含 Phonopy 可读取的 Force 信息。
- **关键参数**: 
    - ABACUS: `calculation` (或 `cal_force`，待定需查阅文档确认开启力输出的具体参数), `basis_type` (PW 或 LCAO)。
    - 输出检查: `running_scf.log` (必须包含 FORCE 字段)。

### Section 2.3: 后处理与热力学性质计算
- **内容**: 使用 Phonopy 从 ABACUS 日志中提取力常数，并计算热力学函数。详细讲解核心配置文件 `mesh.conf` 的设置策略。
- **关键参数**: 
    - Phonopy 命令: `-f` (读取力), `-p` (计算性质), `--abacus` (指定接口)。
    - `mesh.conf`: `DIM` (同前处理), `MESH` (q点网格，如 `31 31 31`), `TMAX`/`TMIN`/`TSTEP` (温度范围与步长)。

<!-- CHAPTER_START -->
## 第三章：进阶操作：局部振动与手动选区分析
**本章逻辑**: 针对 ABACUS 接口目前不支持自动 `selective dynamics` 的限制，提供一套高阶“手动替代方案”。这对于表面吸附、缺陷位点等只需关注特定原子振动的场景至关重要。

### Section 3.1: 接口限制与手动方案设计
- **内容**: 分析为何不能直接使用 Phonopy 的自动固定功能。详解“提取原子 -> 生成微扰 -> 拼接回超胞”的手动工作流逻辑。
- **关键参数**: 无（操作逻辑）。

### Section 3.2: 结构重组与索引一致性实战
- **内容**: 逐步演示如何手动操作结构文件：从超胞中剥离目标原子 A，生成微扰后，再将背景原子 B 拼回。**特别强调**在此过程中保持原子索引（Index）一致性的技巧与风险控制。
- **关键参数**: 
    - 文本处理: 原子坐标行号与元素种类的对应关系。

### Section 3.3: 结果解析与力数据清洗
- **内容**: 运行 ABACUS 后，如何从输出中手动提取或清洗数据，仅保留目标原子的受力信息，以便生成正确的 `FORCE_SETS`。
- **关键参数**: 
    - Phonopy: `FORCE_SETS` (文件格式理解)。

<!-- CHAPTER_START -->
## 第四章：数据解读与结果分析
**本章逻辑**: 算出数据只是第一步，读懂数据才算完成。本章聚焦于输出文件的物理意义解读、单位换算以及数据的科学呈现。

### Section 4.1: 解读 thermal_properties.yaml
- **内容**: 逐行解析输出文件。明确各物理量的定义与单位，特别是自由能（Free Energy）包含的项（ZPE+振动熵，通常忽略 PV）。
- **关键参数**: 
    - 单位: `kJ/mol` (能量), `J/K/mol` (熵/热容), `K` (温度)。

### Section 4.2: 稳定性判据与相变分析
- **内容**: 如何利用 $\Delta G$ 判断反应自发性或相变温度。如何通过声子谱中的虚频（Imaginary Frequency）判断结构的不稳定性。
- **关键参数**: 
    - 判据: $\Delta G < 0$, 频率 $v < 0$ (虚频)。

<!-- APPENDIX_START -->
## 附录：常见问题与避坑指南
- **虚频处理**: 出现虚频的常见原因（结构未优化好、扩胞不够大）及解决方案。
- **力读取失败**: `phonopy -f` 报错的排查清单（ABACUS 是否正常结束、日志是否完整）。
- **单位陷阱**: 警惕 kJ/mol 与 eV/atom 之间的换算错误。
- **MD 方法辨析**: 简要说明 MD 方法与声子法计算热力学性质的区别（本教程聚焦声子法）。